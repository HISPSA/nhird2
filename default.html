<!DOCTYPE html>
<html>
<head>

    <title>NHIRD 2.0</title>

	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">

	<link rel="icon" href="img/logo.png">

	<link rel="stylesheet" type="text/css" href="css/leaflet.css" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto" >
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">

<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

	<link rel="stylesheet" type="text/css" href="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.css" /> 
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/w2ui.min.css" />
	<link rel="stylesheet" type="text/css" href="css/nhird.css" />

	<script type="text/javascript" src="js/leaflet.js"></script>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="js/w2ui.min.js"></script>
	
	<script type="text/javascript" src="js/jquery.marquee.min.js"></script>
	<script type="text/javascript" src="js/gistfile1.js"></script>
	<script type="text/javascript" src="js/blowfish.js"></script>

	<script type="text/javascript" src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js"></script> 
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sparklines/2.1.2/jquery.sparkline.min.js"></script>

	<style>

		#orgunitSelector {color:#274967;font-size:14px;border:1px solid #fafafa;border-radius:2px; width:100%;height:20px;}
		#periodSelector  {color:#274967;font-size:14px;border:1px solid #fafafa;border-radius:2px; width:100%;height:20px;}

		td.material-selector 	{display:none;}

		.material-button 			{opacity:0.5;cursor:pointer;cursor:hand;font-size:32px;position:relative;top:10px;color:inerit}
		.material-button:hover		{}

		.material-small, .material-small-fixed 	 {opacity:0.5;cursor:pointer;cursor:hand;font-size:16px;}
		.material-medium, .material-medium-fixed {opacity:0.5;cursor:pointer;cursor:hand;font-size:20px;}
		.material-small:hover, .material-medium:hover {opacity:1}

		.material-medium-fixed {opacity:0.5;cursor:default;font-size:24px;}
		.material-secured-list {opacity:0.85; color:#337ab7;cursor:default;font-size:18px; background:-webkit-linear-gradient(#337ab7,#333);-webkit-background-clip:text;-webkit-text-fill-color:transparent; }

		.material-instance 			{opacity:0.25; color:#000;   cursor:pointer;cursor:hand; font-size:24px;}
		.material-instance-connected{opacity:0.85; color:#337ab7;cursor:default;			 font-size:24px; background:-webkit-linear-gradient(#337ab7,#333);-webkit-background-clip:text;-webkit-text-fill-color:transparent; }
		.material-instance-disabled {opacity:0.25; color:#337ab7;cursor:default; 			 font-size:24px;}
		/*.material-instance:hover 	{opacity:0.5;}*/

		.material-connecting 		{opacity:0.85; color:#337ab7;cursor:default;			 font-size:24px; background:-webkit-linear-gradient(#337ab7,#333);-webkit-background-clip:text;-webkit-text-fill-color:transparent; }
		.material-connecting-error 	{opacity:0.75;color:#FFFB14;cursor:default;background:-webkit-linear-gradient(#FF0000,#524F49);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

		.instance-ready, .instance-refresh{opacity:1; color:#337ab7;cursor:pointer;cursor:hand;}
		.instance-protected {opacity:1; color:#8A1246;cursor:pointer;cursor:hand;}
		.instance-ready:hover, .instance-refresh:hover, .instance-protected:hover		{opacity:0.5;}

		.material-meta-dx 			{opacity:0.9; color:#f5f5f5;}
		.material-meta-dx:hover 	{opacity:0.75; color:#367ea6;}
		.material-meta-dx-selected  {opacity:1;background:-webkit-linear-gradient(#006600,#888888);-webkit-background-clip:text;-webkit-text-fill-color:transparent; }
		.dxExplorerItem:hover>.material-meta-dx {color:#367ea6;}
		
		.material-inst-item 		{opacity:0.25; color:#367ea6;}
		.material-inst-item:hover 	{opacity:0.75; color:#367ea6;}


		label.text 	{color: #1f7995;}
		span.dud	{color: #C4C4C4;}

		.instance-security-unprotected 	{opacity:0.25;color:#469DD6;font-size:22px;background:-webkit-linear-gradient(#469DD6,#333);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
		.instance-security-protected 	{opacity:0.75;color:#469DD6;font-size:22px;background:-webkit-linear-gradient(#469DD6,#333);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
		.instance-security-unprotected:hover, .instance-security-protected:hover {opacity:1;}

		.instance-security-popup-icon 	{opacity:1;color:#469DD6;cursor:pointer;cursor:hand;}
		.instance-td 		{border-bottom:1px solid #edf2f6;}
		.instance-tr 		{background-Color:#fff;}
		.instance-tr:hover 	{background-Color:#CFD8DC;}

		.grid, .timeline {opacity:0.35; color:#367ea6;cursor:pointer;cursor:hand;font-size:18px}
		.grid:hover, .timeline:hover { color:#359ABF;}
		.favourite 	{opacity:1; 	background:-webkit-linear-gradient(#337ab7,#575d6d);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:22px; cursor:pointer;cursor:hand;}
		.star  		{opacity:0.5;		color:#298F8B; font-size:22px; cursor:pointer;cursor:hand; }
		.star:hover {opacity:1; 	color:#337ab7;}
		.close 		{opacity:0.65; 	color:#367ea6;cursor:pointer;cursor:hand;font-size:22px}
		.close:hover{opacity:1; 	color:#367ea6;}

		.warning {border:2px dotted #5E83F2; background-Color:#fff;font-size:12px;padding:8px;border-radius:4px}

		td.popup-security-title {font-size:14px;font-weight:400;cursor:pointer;cursor:hand;opacity:0.75;vertical-align:middle;padding:0;}

		#searchMetaExplore {
			width: 130px;
			box-sizing: border-box;
			border: 2px solid #ccc;
			border-radius: 4px;
			font-size: 14px;
			background-color: white;
			background-image: url('img/searchicon.png');
			background-position: 10px 10px; 
			background-repeat: no-repeat;
			padding: 12px 20px 12px 40px;
			-webkit-transition: width 0.25s ease-in-out;
			transition: width 0.25s ease-in-out;
		}
		#metaSearch:focus {
			width: 100%;
		}
		#formVault, #formVault>div {opacity:1;color:#337ab7;cursor:default;background-Color:#fff}

		.fixed {
		  position: fixed;
		  top:20; /*left:10;*/
		  width: 100%; 
		}

		.dxRowItem, dxExplorerItem	 {background-Color:#fff; cursor:default;}
		.dxRowItem:hover {background-Color:#CFD8DC;}
		.dxExplorerItem:hover {background-Color:#DDE3E5;}

		a.enterprise-server-button {font-size:16px;padding:6px 30px 6px 30px;border:2px solid rgb(205,205,205);border-radius:8px;text-decoration:none;}
		a.enterprise-server-button:hover {background-Color:#FAFAFA; color:#2185DB;text-decoration:none;}

        #mapContainer {  position:absolute;top:0;left:280px;padding:0; margin:0;border:0;border-radius:0;background-image:-webkit-linear-gradient(top, #ffffff 0%, #ffffff 100%);cursor: default;} /*width: 100%; height: 100%;*/
		#mapsidebarLeft { padding: 0; overflow:hidden;width:280px;}
		#mapsidebarRight { padding: 0; overflow:auto;display:none;}
		#legendMapBottom { padding: 0; overflow:hidden;background-Color:#f5f5f5;}

		/* Bootstrap box-sizing causing tooltip issues #89 */
		.jqstooltip{ box-sizing: content-box; }

	</style>

</head>

<body>

<div id="layout" style="padding:0;"></div>

<script type="text/javascript">


/* General Settings */
var myAppData = [];
var g_Instances;
var g_dpk = ''; 
var g_prtcl = (window.location.origin).split('://')[0];
var g_PGurl = '277b5ac0.ngrok.io';
var g_sourceDB = ''; 

var g_pingOn = true;
var g_pingTime = 60000;
var g_pingTobj = null;
var g_bInstancesLoaded = false;

	/* period options */
	var g_pe = new Date().getFullYear() ;
	var g_peCompare = (g_pe-1);
	var g_peFilterType = 'yearly';
	var g_peTypeIn = 'monthly';
	var g_peTypeOut = 'monthly';
	
	/* orgunit options */
	var g_ou = 'JLA7wl59oN3';


var g_sentimentIconSize = 13;
var g_sparklineHeight = 22;
var g_sparklineWidth = 150;

/* Marquee */
var g_ouGSname = '';
var g_dxGid = '';


/* TAB: Explore */
var g_Meta_dxObject = 'indicators';
var g_Meta_dxGroup = 'localGroups';
var g_Meta_dxObjGrp = 'indicatorGroups';
var g_Meta_SORT_ARRAY_DESC = false;
var g_Meta_GROUP_COLUMNS = 2;
var g_Meta_Data = [];


/* TAB: Maps */
var g_mapBrowse;
var g_baseLayer;
var g_baseMapLayerOpacity = 1;
var g_mapPadding = 10; // increases width of map to ensure dragging of map results in loaded base-tiles
var g_clickedLatLong;
var g_geoJSONlayerObj;
var g_ObjSidebarLeft,g_ObjSidebarRight;

var g_ZoomLev = 0;
var g_CurrentLayerOpacity = [];
var g_baseMapLayerOpacity = 1;
var g_baseImageOverlayOpacity = 0.5;
var g_iPointRadiusDefaultSize = 4;
var g_iPointRadiusInflateFactor = 100; // inflation factor for points displayed as circles (in relation to num/den/outcome)

g_CurrentLayerOpacity[0] = 0.75; 	// Outcome Layer Opacity
g_CurrentLayerOpacity[1] = 0;		// Voronoi Layer Opacity
g_CurrentLayerOpacity[2] = 1;	// Fixed Layer (border color) Opacity

var g_heatRadius = 20;
var g_bShowNonReportingOrgUnits = false;






/* TAB: Instruments */
var g_instr_dxGroup = 'All';
var g_instr_Data = [];

$(function () {

	var dxAPI = g_prtcl + '://' + g_PGurl + '/instance?select=instanceid,uid,name,address,master,active,type,instanceresource{*},instanceaccess{*},instancesetting{*},instancetype{instancetypeid,name}&order=master.desc,name.asc';

	 $.ajax({
		url: dxAPI,
		error: function (xhr, ajaxOptions, thrownError) {
			console.log('Unable to start up application: API services (instance{*}) unavailable at location [' + dxAPI + ']');
		},
		success : function(dataInstances){


			for (var i = 0; i < dataInstances.length; i++){
				if (dataInstances[i].master > 0){
					dataInstances[i].connecting = 1;
					dataInstances[i].connected = 0;
					dataInstances[i].connectionattempt = 1;
					g_sourceDB = btoa(dataInstances[i].address);
					for (var p = 0; p < dataInstances[i].instanceaccess.length; p++){
						if (dataInstances[i].instanceaccess[p].master > 0){
							g_dpk = dataInstances[i].instanceaccess[p].value;
						}
					}
				}
			}

			g_Instances = dataInstances;

			//URL for (current) User-Account
			var sUAC = (atob(g_sourceDB) + '/api/me.json?fields=*');

			 $.ajax({
				url: sUAC,headers: { "Authorization": 'Basic ' + g_dpk},
				error: function (xhr, ajaxOptions, thrownError) {
					console.log('Error:  unable to verify (default) user login: incorrect credentials for [' + atob(g_sourceDB) + ']');
				},
				success : function(data0){

					myAppData.push ( {user: data0 } );
					myAppData[0].instances = g_Instances;

					InitialiseInstanceVars();

					setConnectingInstanceAttributeValue('user',JSON.parse(JSON.stringify(data0)));

					//URL for System-Info
					var sUAC = (atob(g_sourceDB) + '/api/system/info.json');
					setConnectingInstanceStatus('loading [systemSettings]');

					 $.ajax({
						url: sUAC,headers: { "Authorization": 'Basic ' + g_dpk},
						error: function (xhr, ajaxOptions, thrownError) {
							console.log('error: unable to verify systemSettings info on [' + atob(g_sourceDB) + ']');
						},
						success : function(data1){

							setConnectingInstanceAttributeValue('system',JSON.parse(JSON.stringify(data1)));

							//URL for user-OU 
							var sOU = (atob(g_sourceDB) + '/api/organisationUnits/' + myAppData[0].user.organisationUnits[0].id + '.json?fields=id,name,level,code,parent');
							setConnectingInstanceStatus('loading [current-user organisationUnits]');

							 $.ajax({
								url: sOU,headers: { "Authorization": 'Basic ' + g_dpk},
								error: function (xhr, ajaxOptions, thrownError) {
									console.log('error: unable to verify organisationUnits info on [' + atob(g_sourceDB) + ']');
								},
								success : function(data2){
								
									setConnectingInstanceAttributeValue('organisationUnits',JSON.parse(JSON.stringify(data2)));

									//URL for OU-groupsets
									var sOU = (atob(g_sourceDB) + '/api/organisationUnitGroupSets.json?fields=id,name,shortName,displayName,description,compulsory');
									setConnectingInstanceStatus('loading [organisationUnitGroupSets]');

									 $.ajax({
										url: sOU,headers: { "Authorization": 'Basic ' + g_dpk},
										error: function (xhr, ajaxOptions, thrownError) {
											console.log('error: unable to verify organisationUnitGroupSets info on [' + atob(g_sourceDB) + ']');
										},
										success : function(data3){
											
											setConnectingInstanceAttributeValue('organisationUnitGroupSets',JSON.parse(JSON.stringify(data3.organisationUnitGroupSets)));
											myAppData[0].organisationUnitGroupSets = JSON.parse(JSON.stringify(data3.organisationUnitGroupSets));

											//URL for IND-groups
											var sOU = (atob(g_sourceDB) + '/api/indicatorGroups.json?fields=id,name,indicators[id,name,shortName,description,attributeValues[value,attribute[id,name]]]');
											setConnectingInstanceStatus('loading [indicatorGroups]');

											 $.ajax({
												url: sOU,headers: { "Authorization": 'Basic ' + g_dpk},
												error: function (xhr, ajaxOptions, thrownError) {
													console.log('error: unable to verify indicatorGroups info on [' + atob(g_sourceDB) + ']');
												},
												success : function(data4){

													setConnectingInstanceAttributeValue('indicatorGroups',JSON.parse(JSON.stringify(data4.indicatorGroups)));
													myAppData[0].indicatorGroups = JSON.parse(JSON.stringify(data4.indicatorGroups));

													//URL for IND-groups
													var sOU = (atob(g_sourceDB) + '/api/dataElementGroups.json?fields=id,name,dataElements[id,name,shortName,attributeValues[value,attribute[id,name]]]');
													setConnectingInstanceStatus('loading [dataElementGroups]');

													 $.ajax({
														url: sOU,headers: { "Authorization": 'Basic ' + g_dpk},
														error: function (xhr, ajaxOptions, thrownError) {
															console.log('error: unable to verify dataElementGroups info on [' + atob(g_sourceDB) + ']');
														},
														success : function(data5){

															setConnectingInstanceAttributeValue('dataElementGroups',JSON.parse(JSON.stringify(data5.dataElementGroups)));
															myAppData[0].dataElementGroups = JSON.parse(JSON.stringify(data5.dataElementGroups));

															//URL for organisationUnitLevels
															var sRep = (atob(g_sourceDB) + '/api/organisationUnitLevels.json?fields=level,name');
															setConnectingInstanceStatus('loading [organisationUnitLevels]');

															 $.ajax({
																url: sRep,headers: { "Authorization": 'Basic ' + g_dpk},
																error: function (xhr, ajaxOptions, thrownError) {
																	console.log('error: unable to verify reports info on [' + atob(g_sourceDB) + ']');
																},
																success : function(data5){

																	setConnectingInstanceAttributeValue('organisationUnitLevels',JSON.parse(JSON.stringify(data5.organisationUnitLevels)));
																	myAppData[0].organisationUnitLevels = JSON.parse(JSON.stringify(data5.organisationUnitLevels));


																	//URL for Reports
																	var sRep = (atob(g_sourceDB) + '/api/reports.json?fields=id,name,reportParams[*],user[name,created,lastUpdated]');
																	setConnectingInstanceStatus('loading [Reports]');

																	 $.ajax({
																		url: sRep,headers: { "Authorization": 'Basic ' + g_dpk},
																		error: function (xhr, ajaxOptions, thrownError) {
																			console.log('error: unable to verify reports info on [' + atob(g_sourceDB) + ']');
																		},
																		success : function(data6){

																			setConnectingInstanceAttributeValue('reports',JSON.parse(JSON.stringify(data6.reports)));
																			myAppData[0].reports = JSON.parse(JSON.stringify(data6.reports));

																			setConnectingInstanceStatus('success');
																			setConnectingInstanceConnected();

																			var pstyle = 'background-color: #ffffff; border: 0; padding: 0;overflow:hidden; color:#ffffff;';
																			var pHeaderstyle = 'background-color: #373a3c; border: 1px solid #373a3c; padding: 5px 0 0 0;overflow:hidden; color:#ffffff;';

																			$('#layout').w2layout({
																				name: 'layout',
																				panels: [
																					{ type: 'top', size: 65, resizable: false, style: pHeaderstyle, content: getTopContent() },
																					{ type: 'left', size: 200, resizable: false, hidden: true, style: pHeaderstyle, content: 'LEFT' },
																					{ type: 'main', style: 'background-color: white;', overflow: 'hidden', content: 'MAIN' },
																					{ type: 'preview', size: '50%', resizable: false, hidden: true, style: pstyle, content: 'PREVIEW' },
																					{ type: 'right', size: 200, resizable: false, hidden: true, style: pstyle, content: 'RIGHT' },
																					{ type: 'bottom', size: 34, resizable: false, hidden: true, style: pstyle, content: 'BOTTOM' }
																				]
																			});

																			$().w2layout({
																				name: 'layout2',
																				panels: [
																					{ type: 'top', size: 30, resizable: false, hidden: false, style: 'background-Color:#000;color:#fff;border:0;font-size:16px;overflow:hidden;', content: 'top II' },
																					{ type: 'left', size: 250, resizable: false, hidden: true, style: pstyle, content: getInnerLeftContent() },
																					{ type: 'main', style: pstyle, content: '<div id="nhirdTabContainer" style="width:100%;height:100%;"></div>' },
																					{ type: 'preview', size: '50%', resizable: false, hidden: true, style: pstyle, content: 'preview II' },
																					{ type: 'right', size: 80, resizable: false, hidden: true, style: pstyle, content: 'right II' },
																					{ type: 'bottom', size: 40, resizable: false, hidden: true, style: pstyle, content: 'bottom II' }
																				]
																			});

																			w2ui['layout'].content('main', w2ui['layout2']);

																			setTimeout(function () {

																				$('#nhirdTabContainer').w2form({
																					name   : 'form',
																					url    : 'server/post',
																					tabs: [
																						{ id: 'tab1', caption: 'Home', style: '' }, //<table style="vertical-align:top;border-bottom:0;"><tr><td><i style="font-size:18px;" class="material-icons">home</i></td><td style="font-size:16px;padding:0 0 0 8px">Home</td></tr></table>
																						{ id: 'tab2', caption: '<table style="vertical-align:top;border-bottom:0;"><tr><td><i class="material-icons"></i></td><td style="font-size:16px;padding:0 0 0 4px">Enterprise</td></tr></table>', style: ''}, //font-weight:400;background-Color:#68272D;color:#fff
																						{ id: 'tab3', caption: 'Explore', style: ''}, //font-weight:400;background-Color:#68272D;color:#fff
																						{ id: 'tab4', caption: 'Maps', style: ''}, //font-weight:400;background-Color:#276469;color:#fff
																						{ id: 'tab5', caption: 'Planning', style: 'color:#999'}, //font-weight:400;background-Color:#68272D;color:#fff
																						{ id: 'tab6', caption: 'Instruments', style: 'color:#999'}, //font-weight:400;background-Color:#68272D;color:#fff
																						{ id: 'tab7', caption: 'Favourites', style: 'color:#999'}, //font-weight:400;background-Color:#276469;color:#fff
																						{ id: 'tab8', caption: '<table style="vertical-align:top;border-bottom:0;"><tr><td><i class="material-icons">perm_identity</i></td><td style="font-size:16px;padding:0 0 0 4px">Account</td></tr></table>', style: 'color:#999'} //font-weight:400;background-Color:#68272D;color:#fff
																					],
																					actions: {
																					}
																				});

																				initialiseDefaults()
																				initialiseMarqueeHeaderArea()
																				initialiseMarqueeContextMenu();
																				initialiseTabs();
																				InitialiseMapBrowser();
																				IntialiseMyConnectorTokens();

																				pingInstances(0);
																				setPingCycle();


																			}, 100);


																			setTimeout(function () {
																				loadMarquee(1);
																				//loadPeriodOptions();
																			}, 200);


																			function initialiseTabs(){

																				var tabStyle = 'display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;padding:0;background-Color:#fff;';

																				$('.page-0')[0].childNodes[0].style=tabStyle;
																				$('.page-1')[0].childNodes[0].style=tabStyle;
																				$('.page-2')[0].childNodes[0].style=tabStyle;
																				$('.page-3')[0].childNodes[0].style=tabStyle; //="display:-webkit-flex;display:flex;width:100%;height:100%;padding:10px;";
																				$('.page-4')[0].childNodes[0].style=tabStyle;
																				$('.page-5')[0].childNodes[0].style=tabStyle;
																				$('.page-6')[0].childNodes[0].style=tabStyle;
																				$('.page-7')[0].childNodes[0].style=tabStyle;
																				
																				/*w2ui.form_tabs.click( function() { 
																					switch (w2ui.form_tabs.active) {
																						case 'tab1':
																							console.log('XXXXXXXXXXXXXXXXXXXXXXXXX');
																							break;
																						case 'tab2':
																							console.log('YYYYYYYYYYYYYYYYYYYYYYYYY');
																							break;
																						default:
																							x
																							break;
																					}
																				});*/


																				var dvP = document.createElement('div');
																				dvP.setAttribute('style', 'display: -webkit-flex; display: flex; -webkit-flex: 1; -ms-flex: 1; flex: 1; -webkit-flex-direction: column; flex-direction: column;');
																				dvP.innerHTML = document.getElementById('welcomeContentLayout').innerHTML;
																				$('.page-0')[0].childNodes[0].appendChild(dvP);

/*
																				var dvP = document.createElement('div');
																				dvP.setAttribute('id', 'metaTabs');
																				$('.page-2')[0].childNodes[0].appendChild(dvP);
																				
																				$(function () {
																					$('#metaTabs').w2tabs({
																						name: 'metaTabs',
																						active: 'metaFirst',
																						tabs: [
																							{ id: 'metaFirst', text: 'First Tab' }
																						]
																					});
																				});
*/
																				var exploreHeader = document.getElementById('metaExplore');
																				$('.page-2')[0].childNodes[0].appendChild(exploreHeader.children[0]);
																				//$('.page-2')[0].childNodes[0].appendChild(exploreHeader);
																				//$('#tabs_metaTabs_tab_metaFirst')[0].appendChild(exploreHeader.children[0]);

																				//var dv = document.createElement('div');
																				//dv.setAttribute('id', 'meta-data-browse');
																				//dv.setAttribute('data-source', g_sourceDB);
																				//$('.page-2')[0].childNodes[0].appendChild(dv);


																				var tbl = document.createElement('table');
																				tbl.setAttribute('style', 'width:100%;height:100%;');
																				var tr = document.createElement('tr');
																				var td = document.createElement('td');
																				td.setAttribute('style', 'width:280px;');
																				td.setAttribute('rowspan', '2');
																				tbl.appendChild(tr);
																				tr.appendChild(td);

																				var dv = document.createElement('div');
																				dv.setAttribute('id', 'mapsidebarLeft');
																				td.appendChild(dv);

																				var td = document.createElement('td');
																				td.setAttribute('style', '');
																				td.setAttribute('id', 'mapContainer');
																				tr.appendChild(td);

																				/*var dv = document.createElement('div');
																				//dv.setAttribute('style', 'position:relative;width:100%;');
																				dv.setAttribute('id', 'mapContainer');
																				td.appendChild(dv);*/

																				var td = document.createElement('td');
																				tr.appendChild(td);

																				var dv = document.createElement('div');
																				dv.setAttribute('id', 'mapsidebarRight');
																				td.appendChild(dv);

																				/*var tr = document.createElement('tr');
																				var td = document.createElement('td');
																				td.setAttribute('style', 'width:100%;height:50px');
																				td.setAttribute('colspan', 2);

																				tbl.appendChild(tr);
																				tr.appendChild(td);*/

																				/*var dv = document.createElement('div');
																				//dv.setAttribute('style', 'position:relative;width:100%;');
																				dv.setAttribute('id', 'legendMapBottom');
																				dv.innerHTML = 'hellow world, i am here';
																				td.appendChild(dv);*/

																				$('.page-3')[0].childNodes[0].appendChild(tbl);

																				var dvP = document.createElement('div');
																				dvP.setAttribute('style', 'display: -webkit-flex; display: flex; -webkit-flex: 1; -ms-flex: 1; flex: 1; -webkit-flex-direction: column; flex-direction: column;');
																				dvP.innerHTML = document.getElementById('planningContentLayout').innerHTML;
																				$('.page-4')[0].childNodes[0].appendChild(dvP);
																				document.getElementById('planningContentLayout').innerHTML = '';

																				var instrHeader = document.getElementById('instrLayout');
																				$('.page-5')[0].childNodes[0].appendChild(instrHeader.children[0]);

																				
																				/* TAB Click-Events */

																				$('#tabs_form_tabs_tab_tab2').click(function (e) {
																					e.preventDefault();
																					initialiseInstanceLayout();
																				});

																				$('#explorerGroupColumnCount')[0].innerHTML = (g_Meta_GROUP_COLUMNS + ' Cols');

																				$('#tabs_form_tabs_tab_tab3').click(function (e) {
																					e.preventDefault();
																					if ($('#meta-data-browse')[0].innerHTML == ""){
																						intialiseMetaExplorerLayout();
																					} else {
																						if ( ($('#meta-data-browse')).attr("data-source") != g_sourceDB ) {
																							intialiseMetaExplorerLayout();
																						}
																					}
																				});

																				$('#tabs_form_tabs_tab_tab4').click(function (e) {
																					e.preventDefault();
																					//$('#mapContainer').height($('.page-3').height() - $('#legendMapBottom').height());
																					$('#mapContainer').height($('.page-3').height());
																					$('#mapContainer').width($('.page-3').width() - 280);
																					g_mapBrowse.invalidateSize();
																					$('#mapsidebarLeft')[0].innerHTML = getmapLeftMenuContent();
																				});


																				$('#tabs_form_tabs_tab_tab5').click(function (e) {
																					e.preventDefault();
																					loadSVGHierarchyStructure();
																				});

																				$('#tabs_form_tabs_tab_tab7').click(function (e) {
																					e.preventDefault();
																					initialiseFavouritesLayout();
																				});

																				$('#tabs_form_tabs_tab_tab8').click(function (e) {
																					e.preventDefault();
																					initialiseAccountLayout(7);
																				});

																			}
																		}
																	})
																}
															})
														}
													})
												}
											})
										}
									})

								}
							})

						}
					})
				}
			})
		}
	})
});

function InitialiseInstanceVars(){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connecting == undefined){
			myAppData[0].instances[i].connecting = 0;
		}
		if (myAppData[0].instances[i].connectionattempt == undefined){
			myAppData[0].instances[i].connectionattempt = 0;
		}
		myAppData[0].instances[i].connected = 0;
		myAppData[0].instances[i].connectionsuccess = 0;
		myAppData[0].instances[i].connectionstatus = '';
		//myAppData[0].instances[i].user = {id: myAppData[0].user.id, username: myAppData[0].user.name};
		myAppData[0].instances[i].favourites = [];
	}
}

function InitialiseInstance(thisObj,id){

	var trydpk = '', trysourceDB = '';

	thisObj.innerHTML = 'play_arrow';
	thisObj.className = 'material-icons material-connecting';

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (id == myAppData[0].instances[i].instanceid){
			trysourceDB = btoa(myAppData[0].instances[i].address)
			if (myAppData[0].instances[i].token){
				trydpk = blowfish.decrypt(myAppData[0].instances[i].token.message, blowfish.encrypt(myAppData[0].user.id, myAppData[0].instances[i].uid, {outputType: 1, cipherMode: 5}), {outputType: 0, cipherMode: 3});
				myAppData[0].instances[i].connecting = 1;
				myAppData[0].instances[i].connectionattempt += 1;
				myAppData[0].instances[i].connectionstatus = 'Connecting';
			} else {
				myAppData[0].instances[i].connecting = 1;
				myAppData[0].instances[i].connectionattempt += 1;
				myAppData[0].instances[i].connectionstatus = 'Connecting';
				//myAppData[0].instances[i].user = {id: myAppData[0].user.id, username: myAppData[0].user.name};
				for (var p = 0; p < myAppData[0].instances[i].instanceaccess.length; p++){
					if (myAppData[0].instances[i].instanceaccess[p].master > 0){
						trydpk = myAppData[0].instances[i].instanceaccess[p].value;
					}
				}
			}
		} else {
			myAppData[0].instances[i].connecting = 0;
		}
	}

	$('#instance_status_' + id)[0].innerHTML = 'Connecting';

	//URL for (current) User-Account
	var sUAC = (atob(trysourceDB) + '/api/me.json?fields=*');

	 $.ajax({
		url: sUAC,headers: { "Authorization": 'Basic ' + trydpk},
		success : function(data0){
			g_dpk = trydpk;
			g_sourceDB = trysourceDB;
			//myAppData[0].user =  JSON.parse(JSON.stringify(data0));
			setConnectingInstanceAttributeValue('user',JSON.parse(JSON.stringify(data0)));
			$('#marqueeContainer')[0].innerHTML = '<div class="progress"><div class="indeterminate"></div></div>'; 
			initialiseInstancemyAppData(thisObj,id);
		},
		error: function (jqXHR, ajaxOptions, thrownError) {
			console.log('got here');
			thisObj.innerHTML = 'error';
			thisObj.className = 'material-icons material-connecting-error';
			thisObj.title = 'verify (me) user-account failure on [' + atob(g_sourceDB) + ']'
			setConnectingInstanceStatus('error: unable to connect: access denied');
			setConnectingInstanceAttributeValue('pingicon','error')
			setConnectingInstanceConnectionFailure();
			$('#instance_status_' + id)[0].innerHTML = 'error: unable to connect: access denied';
			//refreshInstanceList();
		},
		timeout: 30000 //15sec
	});

}

function IntialiseMyConnectorTokens(){
	var Inst = myAppData[0].instances;
	Inst.forEach(function(svr) {
		if (svr.active == 1){
			if (svr.token == undefined){
				var connector = blowfish.encrypt(myAppData[0].user.id, svr.uid, {outputType: 1, cipherMode: 5});
				svr.tokenConnector = connector;
				var dxAPI = g_prtcl + '://' + g_PGurl + '/vault?subject=eq.'+connector;
				 $.ajax({
					url: dxAPI,
					error: function (xhr, ajaxOptions, thrownError) {
						console.log('Unable to start up application: API services (instance{*}) unavailable at location [' + dxAPI + ']');
					},
					success : function(questionSuccess){
						svr.token = questionSuccess[0];
					}
				});
			} else {
			
			}
		}
	});
}

function addFavourite(thisObj,objName,id,nameVal){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connected > 0){
			myAppData[0].instances[i].favourites.push ({ "instanceid": getConnectedInstanceAttributeValue('instanceid'), "objName": objName, "id": id, "name": nameVal, "collection": g_Meta_dxObject  });
			$(thisObj).removeClass('star');
			$(thisObj).addClass('favourite');
		} 
	}

}

function removeFavourite(thisObj,objName,id){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connected > 0){
			for (var p = 0; p < myAppData[0].instances[i].favourites.length; p++){
				if ( (myAppData[0].instances[i].favourites[p].instanceid == getConnectedInstanceAttributeValue('instanceid')) && (myAppData[0].instances[i].favourites[p].objName == objName) && (myAppData[0].instances[i].favourites[p].id == id) ){
					myAppData[0].instances[i].favourites.splice(p,1);
					$(thisObj).removeClass('favourite');
					$(thisObj).addClass('star');
					break;
				}
			}
		} 
	}

}

function getAllInstanceItemsBelowObj(objColl,itemColl,itemParent){

	var Obj = getConnectedInstanceAttributeValue(itemParent);
	var Items = [];

	for (var i = 0; i < Obj.length; i++){
		for (var p = 0; p < Obj[i][itemColl].length; p++){
			Items.push ({ id: Obj[i][itemColl][p] })
		}
	}

	return Items;

}

function getConnectedInstanceAttributeValue(attr){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connected > 0){
			return myAppData[0].instances[i][attr];
			break;
		} 
	}
}

function setConnectedInstanceAttributeValue(sText){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connected > 0){
			myAppData[0].instances[i].connectionstatus = sText;
		} 
	}
}

function getConnectedInstanceDxgroupAttribute(g_Meta_dxObjGrp,grpId,attrName,defVal){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connected > 0){
			if ( myAppData[0].instances[i][g_Meta_dxObjGrp] != undefined){
				for (var p = 0; p < myAppData[0].instances[i][g_Meta_dxObjGrp].length; p++){
					if (myAppData[0].instances[i][g_Meta_dxObjGrp][p].id == grpId){
						if (myAppData[0].instances[i][g_Meta_dxObjGrp][p][attrName] != undefined){
							return myAppData[0].instances[i][g_Meta_dxObjGrp][p][attrName];
						} else {
							return defVal;
						}
						break;
					}
				}
			} 
		}
	}
}

function setConnectedInstanceDxgroupAttribute(g_Meta_dxObjGrp,grpId,attrName,attrVal){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connected > 0){
			if ( myAppData[0].instances[i][g_Meta_dxObjGrp] != undefined){
				for (var p = 0; p < myAppData[0].instances[i][g_Meta_dxObjGrp].length; p++){
					if (myAppData[0].instances[i][g_Meta_dxObjGrp][p].id == grpId){

						myAppData[0].instances[i][g_Meta_dxObjGrp][p][attrName] = attrVal;

					}
				}
			} 
		}
	}
}

function setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,grpId,refObj,refObjId,attrName,attrVal){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connected > 0){
			if ( myAppData[0].instances[i][g_Meta_dxObjGrp] != undefined){
				for (var p = 0; p < myAppData[0].instances[i][g_Meta_dxObjGrp].length; p++){
					if (myAppData[0].instances[i][g_Meta_dxObjGrp][p].id == grpId){
						if (myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj] != undefined){
							for (var n = 0; n < myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj].length; n++){
								if (myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj][n].id == refObjId){

									myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj][n][attrName] = attrVal;

								}
							}
						}
					}
				}
			} 
		}
	}
}

function setConnectingInstanceStatus(sText){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connecting > 0){
			myAppData[0].instances[i].connectionstatus = sText;
		} 
	}
}

function getConnectingInstanceStatus(){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connecting > 0){
			return myAppData[0].instances[i].connectionstatus;
			break;
		} 
	}
}

function setConnectingInstanceConnected(){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connecting > 0){
			myAppData[0].instances[i].connected = 1;
			myAppData[0].instances[i].connectionsuccess += 1;
			myAppData[0].instances[i].connecting = 0;
		} else {
			if (myAppData[0].instances[i].connected > 0){
				myAppData[0].instances[i].connected = 0;
			}
		}
	}
}

function setConnectingInstanceConnectionFailure(){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connecting > 0){
			myAppData[0].instances[i].connected = -1;
			myAppData[0].instances[i].connecting = 0;
		}
	}
}

function setConnectingInstanceAttributeValue(Objname,Objdata){
	
	/* ### WARNING!! If-Test added to only set attribute value if attribute doesn't already exist (CAUTION) */

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].connecting > 0){
			if (myAppData[0].instances[i][Objname] == undefined){
				myAppData[0].instances[i][Objname] = Objdata;
			}
		} 
	}
}

function getInstanceDxgroupAttribute(instId,g_Meta_dxObjGrp,grpId,attrName,defVal){

	for (var i = 0; i < myAppData[0].instances.length; i++){
		if (myAppData[0].instances[i].instanceid == instId){
			if ( myAppData[0].instances[i][g_Meta_dxObjGrp] != undefined){
				for (var p = 0; p < myAppData[0].instances[i][g_Meta_dxObjGrp].length; p++){
					if (myAppData[0].instances[i][g_Meta_dxObjGrp][p].id == grpId){
						if (myAppData[0].instances[i][g_Meta_dxObjGrp][p][attrName] != undefined){
							return myAppData[0].instances[i][g_Meta_dxObjGrp][p][attrName];
						} else {
							return defVal;
						}
						break;
					}
				}
			} 
		}
	}
}


function initialiseInstancemyAppData(thisObj,id){

	//URL for System-Info
	var sUAC = (atob(g_sourceDB) + '/api/system/info.json');
	setConnectingInstanceStatus('loading [systemSettings]');
	$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
	
	 $.ajax({
		url: sUAC,headers: { "Authorization": 'Basic ' + g_dpk},
		error: function (xhr, ajaxOptions, thrownError) {
			thisObj.innerHTML = 'error';
			thisObj.className = 'material-icons material-connecting-error';
			setConnectingInstanceStatus('error: unable to verify systemSettings info');
			setConnectingInstanceConnectionFailure();
			$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
		},
		success : function(data0){

			myAppData[0].system = data0;
			setConnectingInstanceAttributeValue('system',JSON.parse(JSON.stringify(data0)));

			//URL for user-OU 
			var sOU = (atob(g_sourceDB) + '/api/organisationUnits/' + myAppData[0].user.organisationUnits[0].id + '.json?fields=id,name,level,code,parent');
			setConnectingInstanceStatus('loading [current-user organisationUnits]');
			$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();

			 $.ajax({
				url: sOU,headers: { "Authorization": 'Basic ' + g_dpk},
				error: function (xhr, ajaxOptions, thrownError) {
					thisObj.innerHTML = 'error';
					thisObj.className = 'material-icons material-connecting-error';
					setConnectingInstanceStatus('error: unable to verify organisationUnits info');
					setConnectingInstanceConnectionFailure();
					$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
				},
				success : function(data1){

					setConnectingInstanceAttributeValue('organisationUnits',JSON.parse(JSON.stringify(data1)));

					//URL for OU-groupsets
					var sOUgs = (atob(g_sourceDB) + '/api/organisationUnitGroupSets.json?fields=id,name,shortName,displayName,description,compulsory');
					setConnectingInstanceStatus('loading [organisationUnitGroupSets]');
					$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();

					 $.ajax({
						url: sOUgs,headers: { "Authorization": 'Basic ' + g_dpk},
						error: function (xhr, ajaxOptions, thrownError) {
							thisObj.innerHTML = 'error';
							thisObj.className = 'material-icons material-connecting-error';
							setConnectingInstanceStatus('error: unable to verify organisationUnitGroupSets info');
							setConnectingInstanceConnectionFailure();
							$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
						},
						success : function(data2){

							setConnectingInstanceAttributeValue('organisationUnitGroupSets',JSON.parse(JSON.stringify(data2.organisationUnitGroupSets)));
							myAppData[0].organisationUnitGroupSets = JSON.parse(JSON.stringify(data2.organisationUnitGroupSets));

							//URL for IND-groups
							var sIndgp = (atob(g_sourceDB) + '/api/indicatorGroups.json?fields=id,name,indicators[id,name,shortName,description,attributeValues[value,attribute[id,name]]]');
							setConnectingInstanceStatus('loading [indicatorGroups]');
							$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();

							 $.ajax({
								url: sIndgp,headers: { "Authorization": 'Basic ' + g_dpk},
								error: function (xhr, ajaxOptions, thrownError) {
									thisObj.innerHTML = 'error';
									thisObj.className = 'material-icons material-connecting-error';
									setConnectingInstanceStatus('error: unable to verify indicatorGroups info');
									setConnectingInstanceConnectionFailure();
									$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
								},
								success : function(data3){

									setConnectingInstanceAttributeValue('indicatorGroups',JSON.parse(JSON.stringify(data3.indicatorGroups)));
									myAppData[0].indicatorGroups = JSON.parse(JSON.stringify(data3.indicatorGroups));

									//URL for DE-groups
									var sDEgp = (atob(g_sourceDB) + '/api/dataElementGroups.json?fields=id,name,dataElements[id,name,shortName,attributeValues[value,attribute[id,name]]]');
									setConnectingInstanceStatus('loading [dataElementGroups]');
									$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();

									 $.ajax({
										url: sDEgp,headers: { "Authorization": 'Basic ' + g_dpk},
										error: function (xhr, ajaxOptions, thrownError) {
											thisObj.innerHTML = 'error';
											thisObj.className = 'material-icons material-connecting-error';
											setConnectingInstanceStatus('error: unable to verify dataElementGroups info');
											setConnectingInstanceConnectionFailure();
											$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
										},
										success : function(data4){

											setConnectingInstanceAttributeValue('dataElementGroups',JSON.parse(JSON.stringify(data4.dataElementGroups)));
											myAppData[0].dataElementGroups = JSON.parse(JSON.stringify(data4.dataElementGroups));
											$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();


											//URL for organisationUnitLevels
											var sOUl = (atob(g_sourceDB) + '/api/organisationUnitLevels.json?fields=level,name');
											setConnectingInstanceStatus('loading [organisationUnitLevels]');

											 $.ajax({
												url: sOUl,headers: { "Authorization": 'Basic ' + g_dpk},
												error: function (xhr, ajaxOptions, thrownError) {
													thisObj.innerHTML = 'error';
													thisObj.className = 'material-icons material-connecting-error';
													setConnectingInstanceStatus('error: unable to verify organisationUnitLevels info');
													setConnectingInstanceConnectionFailure();
													$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
												},
												error: function (xhr, ajaxOptions, thrownError) {
													console.log('error: unable to verify organisationUnitLevels info on [' + atob(g_sourceDB) + ']');
												},
												success : function(data5){

													setConnectingInstanceAttributeValue('organisationUnitLevels',JSON.parse(JSON.stringify(data5.organisationUnitLevels)));
													myAppData[0].organisationUnitLevels = JSON.parse(JSON.stringify(data5.organisationUnitLevels));
													$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();

													//URL for Reports
													var sRep = (atob(g_sourceDB) + '/api/reports.json?fields=id,name,reportParams[*],user[name,created,lastUpdated]');
													setConnectingInstanceStatus('loading [Reports]');
													$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();

													 $.ajax({
														url: sRep,headers: { "Authorization": 'Basic ' + g_dpk},
														error: function (xhr, ajaxOptions, thrownError) {
															thisObj.innerHTML = 'error';
															thisObj.className = 'material-icons material-connecting-error';
															setConnectingInstanceStatus('error: unable to verify Reports info');
															setConnectingInstanceConnectionFailure();
															$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();
														},
														success : function(data6){

															setConnectingInstanceAttributeValue('reports',JSON.parse(JSON.stringify(data6.reports)));
															myAppData[0].reports = JSON.parse(JSON.stringify(data6.reports));
															setConnectingInstanceStatus('success');
															$('#instance_status_' + id)[0].innerHTML = getConnectingInstanceStatus();

															setConnectingInstanceConnected();
															initialiseDefaults();
															loadMarquee(1);

															$('#IndCount').html('');
															$('#DeCount').html('');

															pingInstances(0);
															
															setTimeout(function () {
																refreshInstanceList();
															}, 1500);

															$('#explorerExpandCollapseInner').html('keyboard_arrow_up');

															loadSVGHierarchyStructure();

														}
													});
												}
											});
										}
									});
								}
							});
						}
					});
				}
			});
		}
	});

}

function loadPeriodOptions(){

	var periods = [];

	for (var i = (g_pe-3); i <= g_pe; i++){
		periods.push (i.toString());
	}

	console.log(periods);
	console.log(JSON.stringify(periods));
	
	$('input[type=list]').w2field('list', { items: periods });

	//$('input[type=list]').w2field().setIndex(periods.length)
/*
	setTimeout(function () {
		$('#list').w2field().set({ id: g_pe.toString(), text: g_pe.toString() })
	}, 100);
*/
}

function ClearExistingElements(className){
	var elements = document.getElementsByClassName(className);
	while(elements.length > 0){
		elements[0].parentNode.removeChild(elements[0]);
	}
}

function returnInstanceContextItems(){

	var sOugs = '';
	var sIndg = '';
	var sDeg = '';
	var sJstr = '';
	var indC = 0;
	var instInd = getAllInstanceItemsBelowObj(getConnectedInstanceAttributeValue('indicatorGroups'),'indicators','indicatorGroups');

	if (instInd.length < 40) {
		sJstr = ' "ind_all": {"name": "Indicators", "icon": ""}, ';
	}

	sJstr += ' "fold1": { "name": "Indicator groups", "items": { ';

	var instIG = getConnectedInstanceAttributeValue('indicatorGroups');

	for (var i = 0; i < instIG.length; i++){
		if (instIG[i].indicators.length > 0){
			sIndg += ' "indg_' + instIG[i].id + '": {"name": "' + instIG[i].name + '", "icon": "' + ((isFavourite(instIG[i].id)) ? 'star' : 'none') + '" },';
		}
	}

	if (sIndg.length){ 
		sIndg = sIndg.slice(0,-1)
	} ;

	sJstr += sIndg + " }}, "

	sJstr += ' "sep0":  "---------", ';

	var instDe = getAllInstanceItemsBelowObj(getConnectedInstanceAttributeValue('dataElementGroups'),'dataElements','dataElementGroups');

	if (instDe.length < 40) {
		sJstr += ' "de_all": {"name": "Data Elements", "icon": ""}, ';
	}

	sJstr += ' "fold2": { "name": "Elements groups", "items": { ';

	var instDG = getConnectedInstanceAttributeValue('dataElementGroups');

	for (var i = 0; i < instDG.length; i++){
		if (instDG[i].dataElements.length > 0){
			sDeg += ' "de_' + instDG[i].id + '": {"name": "' + instDG[i].name + '", "icon": "' + ((isFavourite(instDG[i].id)) ? 'star' : 'none') + '" },';
		}
	}

	if (sDeg.length){ 
		sDeg = sDeg.slice(0,-1)
	} ;

	sJstr += sDeg + " }}, "

	sJstr += ' "sep1":  "---------", ';
	sJstr += ' "fold3": { "name": "OrgUnit group sets", "items": { ';

	var instOUG = getConnectedInstanceAttributeValue('organisationUnitGroupSets');

	for (var i = 0; i < instOUG.length; i++){
		if (instOUG[i].compulsory){
			sOugs += ' "ougs_' + instOUG[i].name + '": {"name": "' + instOUG[i].name + '", "id": "' + instOUG[i].id + '" },';
		}
	}

	if (sOugs.length){ 
		sOugs = sOugs.slice(0,-1)
	} ;

	sJstr += sOugs + " }} "

	return sJstr;

}


function initialiseMarqueeContextMenu(){

	//ClearExistingElements('css-titleInfoReel');

	$.contextMenu({
			selector: '.context-menu-sliderSettings',
			trigger: 'left',
			className: 'css-titleInfoReel',
			build: function($trigger, e) {
				// this callback is executed every time the menu is to be shown
				// its results are destroyed every time the menu is hidden
				// e is the original contextmenu event, containing e.pageX and e.pageY (amongst other data)
				return {
					callback: function(key, options) {
							var ArrItm = key.split('_');
							g_dxGid = '';
							if (ArrItm[0] == 'ougs'){
								g_ouGSname = ((ArrItm[1] == 'all') ? '' : ArrItm[1]);
								loadMarquee(1);
							} else {
								if (ArrItm[0] == 'indg'){
									g_dxGid = ((ArrItm[1] == 'all') ? '' : ArrItm[1]);
									loadMarquee(2);
								} else {
									if (ArrItm[0] == 'de'){
										g_dxGid = ((ArrItm[1] == 'all') ? '' : ArrItm[1]);
										loadMarquee(3);
									} else {
										g_dxGid = '';
										loadMarquee(2);
									}
								}
							}
					},
					items: JSON.parse('{ ' + returnInstanceContextItems() + ' }')
				};
			}
		});
}

	function setCurrentOuGs(val){
		g_ouGSname = val;
	}

	function getTopContent(){
		return '<nav class="navbar navbar-static-top navbar-dark bg-inverse" style="padding:10px 0px 2px 22px;overflow:hidden;scroll:no;font-size:24px;color:#fff;border-radius:0;height:100%;">\
				<img src="img/logo.png" class="context-menu-instanceSettings" style="width:20px;height:25px;position:relative;top:-2px;left:-2px;">&nbsp;&nbsp;&nbsp;NHIRD: <span id="instanceHeaderTitle">NHIRD 2.0</span><span style="position:absolute;left:60px;top:42px;font-size:11px;color:#808080;text-shadow: 1px 1px #101010;">National Health Information Repository & Data Warehouse</span></nav>';
				//National Health Information Repository & Data Warehouse
	}

	function getInnerLeftContent(){

		return '<table class="" style="background-Color:#fafafa;padding:0;overflow:hidden;scroll:no;height:100%;width:100%"><tr><td style="overflow:hidden;scroll:no;height:32px;width:100%;">\
				<div id="orgunitSelector" >orgunit</div>\
				<div id="periodSelector" >period</div>\
				</td></tr><tr><td style="overflow:hidden;scroll:no;width:100%">\
				<div id="dxSandbox" style="padding:2px;height:100%;width:100%;border:2px solid #f5f5f5;border-radius:4px;background-Color:#fafafa">orgunit</div>\
				</td></tr></table>';
	}

	function InitialiseSiema(){
		var myDataURL = ('data' + '/' + 'ougs_count.json');
		$.ajax({
			url: myDataURL,
			success : function(data){
				loadMarqueeOUGroupdata(data);
			}
		});
	}

	function loadMarquee(iType){

		$('#marqueeContainer')[0].innerHTML = '<div class="progress"><div class="indeterminate"></div></div>'; 

		switch (iType) {
			case 1:
				var myDataURL = (atob(g_sourceDB) + '/api/sqlViews/' + getCurrentInstanceSQLview('nhird_dyn_pe_ougroup_count') + '/data?var=idlevel:idlevel' + getCurrentInstanceSetting('agg_ou_source_level') + '&var=parentidlevel:idlevel1&var=pe:' + g_pe + '&var=ougroupset:' + g_ouGSname + '&var=ou:' + g_ou + '');
				$.ajax({
					url: myDataURL,headers: { "Authorization": 'Basic ' + g_dpk},
					success : function(data){
						loadMarqueeOUGroupdata(data);
					}
				});
				break;
			case 2:
				var dxUID = '';
				g_Meta_dxObjGrp = 'indicatorGroups';
				g_Meta_dxObject = 'indicators'
				var IndGdata = getCurrentInstanceAttribute(g_Meta_dxObjGrp);
				var Usr = getCurrentInstanceAttribute('user');
				var Sys = getCurrentInstanceAttribute('system');
				var refObj = 'indicators'; //g_Meta_dxObject
				for (var i = 0; i < IndGdata.length; i++){
					if (g_dxGid.length){
						if (IndGdata[i].id == g_dxGid){
							for (var p = 0; p < IndGdata[i][g_Meta_dxObject].length; p++){
								if (dxUID.indexOf(IndGdata[i][g_Meta_dxObject][p].id + ';') < 0){
									dxUID += IndGdata[i][g_Meta_dxObject][p].id + ';';
								}
							}
						}
					} else {
						for (var p = 0; p < IndGdata[i][g_Meta_dxObject].length; p++){
							if (dxUID.indexOf(IndGdata[i][g_Meta_dxObject][p].id + ';') < 0){
								dxUID += IndGdata[i][g_Meta_dxObject][p].id + ';';
							}
						}
					}
				}
				if (dxUID.length > 0){
					dxUID = dxUID.slice(0,-1);
					var myDataURL = (atob(g_sourceDB) + '/api/' + ((getConnectedInstanceAttributeValue('system').version > '2.24') ? '25/' : '') + 'analytics.json?dimension=pe:' + g_pe + ';' + g_peCompare + '&dimension=dx:' + dxUID + '&filter=ou:' + g_ou + '&displayProperty=NAME&outputIdScheme=UID' + ((getConnectedInstanceAttributeValue('system').version > '2.24') ? '&includeNumDen=true' : ''));
					$.ajax({
						url: myDataURL,headers: { "Authorization": 'Basic ' + g_dpk},
						success : function(data){
							loadMarqueeDxGroups(data,IndGdata,g_dxGid,g_Meta_dxObject);
						},
						error: function (xhr, ajaxOptions, thrownError) {
							setConnectedInstanceAttributeValue('marquee error returning data: ' + xhr.statusText);
							$('#marqueeContainer')[0].innerHTML = getConnectedInstanceAttributeValue('connectionstatus');
						},
						timeout: 60000 //15sec
					});
				} else {
					
				}
				break;
			case 3:
				//var myDataURL = (atob(g_sourceDB) + '/api/dataElementGroups.json?fields=id,name,dataElements[id,name,shortName,description,numberType,attributeValues[attribute[name],value]]&paging=false' + ( (g_dxGid.length) ? '&filter=id:eq:' + g_dxGid : ''));
				var dxUID = '';
				g_Meta_dxObjGrp = 'dataElementGroups';
				g_Meta_dxObject = 'dataElements'
				var deGdata = getCurrentInstanceAttribute(g_Meta_dxObjGrp);
				var Usr = getCurrentInstanceAttribute('user');
				var Sys = getCurrentInstanceAttribute('system');
				var refObj = 'dataElements'; //g_Meta_dxObject
				for (var i = 0; i < deGdata.length; i++){
					if (g_dxGid.length){
						if (deGdata[i].id == g_dxGid){
							for (var p = 0; p < deGdata[i][g_Meta_dxObject].length; p++){
								if (dxUID.indexOf(deGdata[i][g_Meta_dxObject][p].id + ';') < 0){
									dxUID += deGdata[i][g_Meta_dxObject][p].id + ';';
								}
							}
						}
					} else {
						for (var p = 0; p < deGdata[i][g_Meta_dxObject].length; p++){
							if (dxUID.indexOf(deGdata[i][g_Meta_dxObject][p].id + ';') < 0){
								dxUID += deGdata[i][g_Meta_dxObject][p].id + ';';
							}
						}
					}
				}
				if (dxUID.length > 0){
					dxUID = dxUID.slice(0,-1);
					var myDataURL = (atob(g_sourceDB) + '/api/' + ((getConnectedInstanceAttributeValue('system').version > '2.24') ? '25/' : '') + 'analytics.json?dimension=pe:' + g_pe + ';' + g_peCompare + '&dimension=dx:' + dxUID + '&filter=ou:' + g_ou + '&displayProperty=NAME&outputIdScheme=UID'+((getConnectedInstanceAttributeValue('system').version > '2.24') ? '&includeNumDen=true' : ''));
					$.ajax({
						url: myDataURL,headers: { "Authorization": 'Basic ' + g_dpk},
						success : function(data){
							loadMarqueeDxGroups(data,deGdata,g_dxGid,g_Meta_dxObject);
						},
						error: function (xhr, ajaxOptions, thrownError) {
							setConnectedInstanceAttributeValue('marquee error returning data: ' + xhr.statusText);
							$('#marqueeContainer')[0].innerHTML = getConnectedInstanceAttributeValue('connectionstatus');
						},
						timeout: 60000 //15sec
					});
				} else {
				
				}
				break;
			case 3:
			default:
				break;
		}

	}

	function getCurrentInstanceSetting(settingName){
		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].connected > 0){
				var instmyAppData = myAppData[0].instances[i].instancesetting;
				for (var p = 0; p < instmyAppData.length; p++){
					if (instmyAppData[p].name == settingName){
						return instmyAppData[p].value;
						break;
					}
				}
			}
		}
	}

	function getCurrentInstanceSQLview(sqlView){
		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].connected > 0){
				var instmyAppData = myAppData[0].instances[i].instanceresource;
				for (var p = 0; p < instmyAppData.length; p++){
					if (instmyAppData[p].type == 'sqlview'){
						if (instmyAppData[p].name == sqlView){
							return instmyAppData[p].uid;
							break;
						}
					}
				}
			}
		}
	}

	function getCurrentInstance(){
		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].connected > 0){
				return myAppData[0].instances[i];
				break;
			}
		}
	}

	function getCurrentInstanceAttribute(attr){
		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].connected > 0){
				return myAppData[0].instances[i][attr];
				break;
			}
		}
	}

	function getInstance(id){

		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].instanceid == id){
				return myAppData[0].instances[i];
				break;
			}
		}

	}

	function getInstanceAttribute(attr,id){

		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].instanceid == id){
				return myAppData[0].instances[i][attr];
				break;
			}
		}

	}

	function setInstanceAttribute(attr,id,val){

		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].instanceid == id){
				myAppData[0].instances[i][attr] = val;
				break;
			}
		}

	}

	function initialiseDefaults(){

		/* Period options + filters */

		/* OU structure options + filters */
		
		$('#instanceHeaderTitle')[0].innerHTML = getConnectedInstanceAttributeValue('name');

		/* OU groupsets options + filters */
		setCurrentOuGs('');

		var OUgs = getConnectedInstanceAttributeValue('organisationUnitGroupSets');

		for (var i = 0; i < OUgs.length; i++){
			if (OUgs[i].compulsory){
				setCurrentOuGs(OUgs[i].name);
				break;
			}
		}
		
		if ( (g_ouGSname.length == 0) && (OUgs.length) ) {
			setCurrentOuGs(OUgs[0].name);
		}

		/* Other options + filters */

	}

	function initialiseMarqueeHeaderArea(){

		var dvParent = document.createElement('div');

		var tbl = document.createElement('table');
		tbl.setAttribute('style', 'height:inherit;border:0;padding:0;background-Color:inherit;');
		dvParent.appendChild(tbl);
		var tr = document.createElement('tr');
		tbl.appendChild(tr);

		var td = document.createElement('td');
		td.setAttribute('id', 'homeSettings');
		td.setAttribute('onselectstart', 'return false');
		tr.appendChild(td);

		var imgHome = document.createElement('i');
		imgHome.setAttribute('class', 'material-icons context-menu-Settings');
		imgHome.setAttribute('style', 'width:22px;');
		imgHome.setAttribute('onclick', 'showHideLeftMenu()');
		imgHome.innerHTML = 'menu';
		td.appendChild(imgHome);

		var td = document.createElement('td');
		td.setAttribute('id', 'marqueeSettings');
		td.setAttribute('onselectstart', 'return false');
		tr.appendChild(td);


		var imgSettings = document.createElement('i');
		imgSettings.setAttribute('class', 'material-icons context-menu-sliderSettings');
		imgSettings.setAttribute('style', 'width:22px;');
		imgSettings.innerHTML = 'play_circle_outline';
		td.appendChild(imgSettings);

		var td = document.createElement('td');
		td.setAttribute('style', 'height:inherit;border:0;padding:0;background-Color:inherit;');
		tr.appendChild(td);

		var dv = document.createElement('div');
		dv.setAttribute('id', 'marqueeContainer');
		dv.setAttribute('style', 'height:inherit;border:0;padding:0;background-Color:inherit;');
		td.appendChild(dv);

		$('#layout_layout2_panel_top')[0].innerHTML = dvParent.innerHTML;

	}

	function loadMarqueeOUGroupdata(data){

		var dvParent = document.createElement('div');

		var dvmarq = document.createElement('div');
		dvmarq.setAttribute('class', 'slider');
		dvmarq.setAttribute('id', 'marqueeSlider');
		dvmarq.setAttribute('behavior', 'scroll');
		dvmarq.setAttribute('direction', 'left');
		dvmarq.setAttribute('scrollamount', '2');
		dvmarq.setAttribute('onmouseover', 'this.stop();');
		dvmarq.setAttribute('onmouseout', 'this.start();');
		dvmarq.setAttribute('style', 'width:' + ($('#layout_layout2_panel_top').width() - $('#homeSettings').width() - $('#marqueeSettings').width()) + 'px;border:0;padding:0;height:' + $('#layout_layout2_panel_top').height() + 'px');
		dvParent.appendChild(dvmarq);

		var dv = document.createElement('div');
		dvmarq.appendChild(dv);

		var tbl = document.createElement('table');
		tbl.setAttribute('style', 'position:relative;top:-2px;');
		dv.appendChild(tbl);
		var tr = document.createElement('tr');
		tbl.appendChild(tr);

		if (data.rows.length <= 0){

			var td = document.createElement('td');
			td.setAttribute('class', 'scrollGroup negative');
			tr.appendChild(td);

			var chkIc = document.createElement('i');
			chkIc.setAttribute('class', "material-icons material-connecting-error material-small");
			chkIc.innerHTML = 'warning';
			td.appendChild(chkIc);

			var txt = document.createTextNode(' *** no Grouping structures ');
			td.appendChild(txt);

		} else {

			var td = document.createElement('td');
			td.setAttribute('class', 'scrollGroup');
			tr.appendChild(td);

			var txt = document.createTextNode('Health structure [' + g_ouGSname.replace('OrgUnit','') + '] classifications for ' + g_pe + ': ');
			td.appendChild(txt);

			for (var i = 0; i < data.rows.length; i++){

				var td = document.createElement('td');
				td.setAttribute('class', 'scrollItemValue');
				tr.appendChild(td);

				var td = document.createElement('td');
				td.setAttribute('class', 'scrollItemName');
				tr.appendChild(td);
				td.innerHTML = (data.rows[i][2]);

				var td = document.createElement('td');
				td.setAttribute('class', 'scrollItemValue');
				tr.appendChild(td);

				var tblIn = document.createElement('table');
				td.appendChild(tblIn);
				var trIn = document.createElement('tr');
				tblIn.appendChild(trIn);

				var tdIn = document.createElement('td');
				tdIn.setAttribute('class', 'scrollItemValue');
				trIn.appendChild(tdIn);
				tdIn.innerHTML = (formatNumber(data.rows[i][3]) + ' ');

				if ( (data.rows[i][4] > 0) || (data.rows[i][5] > 0) ){

					var tdIn = document.createElement('td');
					tdIn.setAttribute('class', 'scrollFiller');
					trIn.appendChild(tdIn);
					tdIn.innerHTML = (' (');

					if (data.rows[i][4] > 0){
						var tdIn = document.createElement('td');
						tdIn.setAttribute('class', 'OUopened');
						tdIn.setAttribute('title', '[' + data.rows[i][2] + ']: ' + formatNumber(data.rows[i][4]) + ' opened/new in ' + g_pe);
						tdIn.innerHTML = ('+'+formatNumber(data.rows[i][4]) + '');
						trIn.appendChild(tdIn);
					}

					if (data.rows[i][5] > 0){
						var tdIn = document.createElement('td');
						tdIn.setAttribute('class', 'OUclosed');
						tdIn.setAttribute('title', '[' + data.rows[i][2] + ']: ' + formatNumber(data.rows[i][5]) + ' closed in ' + g_pe);
						tdIn.innerHTML = ('-'+formatNumber(data.rows[i][5]) + '');
						trIn.appendChild(tdIn);				
					}

					var tdIn = document.createElement('td');
					tdIn.setAttribute('class', 'scrollFiller');
					trIn.appendChild(tdIn);
					tdIn.innerHTML = (')');

				}

				if (i < (data.rows.length-1) ){
					var td = document.createElement('td');
					td.setAttribute('class', 'scrollPadding');
					tr.appendChild(td);
					var txt = document.createTextNode(' | ');
					td.appendChild(txt);
				} 

			}

		}

		$('#marqueeContainer')[0].innerHTML = dvParent.innerHTML;

		$(function () {
			$('.slider').marquee('slider').mouseover(function () {
				$(this).trigger('stop');
			}).mouseout(function () {
				$(this).trigger('start');
			}).mousemove(function (event) {
				if ($(this).data('drag') == true) {
					this.scrollLeft = $(this).data('scrollX') + ($(this).data('x') - event.clientX);
				}
			}).mousedown(function (event) {
				$(this).data('drag', true).data('x', event.clientX).data('scrollX', this.scrollLeft);
			}).mouseup(function () {
				$(this).data('drag', false);
			});
		});

	}

	function loadMarqueeDxGroups(data,dxGrpData,grpFilterId,refObj){

		var dvParent = document.createElement('div');

		var dvmarq = document.createElement('div');
		dvmarq.setAttribute('class', 'slider');
		dvmarq.setAttribute('id', 'marqueeSlider');
		dvmarq.setAttribute('behavior', 'scroll');
		dvmarq.setAttribute('direction', 'left');
		dvmarq.setAttribute('scrollamount', '2');
		dvmarq.setAttribute('onmouseover', 'this.stop();');
		dvmarq.setAttribute('onmouseout', 'this.start();');
		dvmarq.setAttribute('style', 'width:' + ($('#layout_layout2_panel_top').width() - $('#homeSettings').width() - $('#marqueeSettings').width()) + 'px;border:0;padding:0;height:' + $('#layout_layout2_panel_top').height() + 'px');
		dvParent.appendChild(dvmarq);

		var dv = document.createElement('div');
		dvmarq.appendChild(dv);

		var tbl = document.createElement('table');
		dv.appendChild(tbl);
		var tr = document.createElement('tr');
		tbl.appendChild(tr);

		if (dxGrpData.length <= 0){

			var td = document.createElement('td');
			td.setAttribute('class', 'scrollGroup negative');
			tr.appendChild(td);

			var chkIc = document.createElement('i');
			chkIc.setAttribute('class', "material-icons material-connecting-error material-small");
			chkIc.innerHTML = 'warning';
			td.appendChild(chkIc);

			var txt = document.createTextNode(' *** no Grouping structures ');
			td.appendChild(txt);

		} else {

			if (data.rows.length == 0){

				var td = document.createElement('td');
				td.setAttribute('class', 'scrollGroup negative');
				tr.appendChild(td);

				var chkIc = document.createElement('i');
				chkIc.setAttribute('class', "material-icons material-connecting-error material-small");
				chkIc.innerHTML = 'warning';
				td.appendChild(chkIc);

				var txt = document.createTextNode(' *** no analytics Data (' + g_pe + ' or ' + g_peCompare + ')');
				td.appendChild(txt);

			} else {

				for (var i = 0; i < dxGrpData.length; i++){

					if (grpFilterId.length) {

						if ( (dxGrpData[i].id == grpFilterId) && (dxGrpData[i][refObj].length)) {

							var td = document.createElement('td');
							td.setAttribute('class', 'scrollGroup');
							tr.appendChild(td);

							var txt = document.createTextNode(dxGrpData[i].name + ': ');
							td.appendChild(txt);

							for (var p = 0; p < dxGrpData[i][refObj].length; p++){

								var tdC = document.createElement('td');
								tdC.setAttribute('id', dxGrpData[i][refObj][p].id);
								tdC.setAttribute('class', 'scrollItemName');
								tr.appendChild(tdC);

								var txt = document.createTextNode(dxGrpData[i][refObj][p].name);
								tdC.appendChild(txt);

								var tdV = document.createElement('td');
								tdV.setAttribute('class', 'scrollItemValue');
								tr.appendChild(tdV);

								var InnHTML = analyticsPeriodComparisonHTML(dxGrpData[i][refObj][p],data,g_pe,g_peCompare);
								var InnData = analyticsPeriodComparisonData(dxGrpData[i][refObj][p],data,g_pe,g_peCompare);

								tdV.innerHTML = InnHTML;
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.compare.pe.html.ou:' + g_ou + '.pe.'+g_pe+':'+g_peCompare,InnHTML);
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.compare.pe.data.ou:' + g_ou + '.pe.'+g_pe+':'+g_peCompare,InnData);
								
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_pe,analyticsHistoryLookup(dxGrpData[i][refObj][p],(data.rows),g_pe));
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_peCompare,analyticsHistoryLookup(dxGrpData[i][refObj][p],(data.rows),g_peCompare));

								//setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_pe,InnData.split(';')[0]);

								if (p < (dxGrpData[i][refObj].length-1) ){
									var tdPadd = document.createElement('td');
									tdPadd.setAttribute('class', 'scrollPadding');
									tr.appendChild(tdPadd);
									var txt = document.createTextNode(' | ');
									tdPadd.appendChild(txt);
								}

							}

						}

					} else {

						if (dxGrpData[i][refObj].length){

							var td = document.createElement('td');
							td.setAttribute('class', 'scrollGroup');
							tr.appendChild(td);

							var txt = document.createTextNode(dxGrpData[i].name + ': ');
							td.appendChild(txt);

							for (var p = 0; p < dxGrpData[i][refObj].length; p++){

								var tdC = document.createElement('td');
								tdC.setAttribute('id', dxGrpData[i][refObj][p].id);
								tdC.setAttribute('class', 'scrollItemName');
								tr.appendChild(tdC);

								var txt = document.createTextNode(dxGrpData[i][refObj][p].name);
								tdC.appendChild(txt);

								var tdV = document.createElement('td');
								tdV.setAttribute('class', 'scrollItemValue');
								tr.appendChild(tdV);

								var InnHTML = analyticsPeriodComparisonHTML(dxGrpData[i][refObj][p],data,g_pe,g_peCompare);
								var InnData = analyticsPeriodComparisonData(dxGrpData[i][refObj][p],data,g_pe,g_peCompare);
								tdV.innerHTML = InnHTML;
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.compare.pe.html.ou:' + g_ou + '.pe.'+g_pe+':'+g_peCompare,InnHTML);
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.compare.pe.data.ou:' + g_ou + '.pe.'+g_pe+':'+g_peCompare,InnData);
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_pe,InnData.split(';')[0]);

								if (p < (dxGrpData[i][refObj].length-1) ){
									var tdPadd = document.createElement('td');
									tdPadd.setAttribute('class', 'scrollPadding');
									tr.appendChild(tdPadd);
									var txt = document.createTextNode(' | ');
									tdPadd.appendChild(txt);
								}

							}

						}
					}

				}
				
			}

		}

		$('#marqueeContainer')[0].innerHTML = dvParent.innerHTML;

		$(function () {
			$('.slider').marquee('slider').mouseover(function () {
				$(this).trigger('stop');
			}).mouseout(function () {
				$(this).trigger('start');
			}).mousemove(function (event) {
				if ($(this).data('drag') == true) {
					this.scrollLeft = $(this).data('scrollX') + ($(this).data('x') - event.clientX);
				}
			}).mousedown(function (event) {
				$(this).data('drag', true).data('x', event.clientX).data('scrollX', this.scrollLeft);
			}).mouseup(function () {
				$(this).data('drag', false);
			});
		});
		
		refreshDeterminedMetaExploreAnalyticsBlocks();

	}
	
	function paintanalyticsComparisonStrings(refObj,objIDprefix,attrName){
		//'analyticsHTML.pe.'+g_pe+':'+g_peCompare
		for (var i = 0; i < myAppData[0].instances.length; i++){
			if (myAppData[0].instances[i].connected > 0){
				if ( myAppData[0].instances[i][g_Meta_dxObjGrp] != undefined){
					for (var p = 0; p < myAppData[0].instances[i][g_Meta_dxObjGrp].length; p++){
						if (myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj] != undefined){
							for (var n = 0; n < myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj].length; n++){
								if (  $('#' + objIDprefix + myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj][n].id).length && (myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj][n][attrName] != undefined) ){
									$('#' + objIDprefix + myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj][n].id)[0].innerHTML = myAppData[0].instances[i][g_Meta_dxObjGrp][p][refObj][n][attrName];
								}
							}
						}
					}
				}
			}
		}

	}

	function analyticsHistoryLookup(obj,data,pe){

		var sReturn = '';

		var tmpData = data.filter(function (el) {
		  return el[0] == obj.id;
		});

		var val = '';
		for (var r = 0; r < tmpData.length; r++){
			if (tmpData[r][1] == pe){
				val = parseFloat(tmpData[r][2]);
				break;
			}
		}

		return val;
	}

	function analyticsHistoryData(obj,data,pe){

		var sReturn = '';
		var peItems = getPeriodTrendItems(pe).split(';');
		var thisData = [];

		var tmpData = data.filter(function (el) {
		  return el[0] == obj.id;
		});

		for (var p = 0; p < peItems.length; p++){
			var val = '';
			for (var r = 0; r < tmpData.length; r++){
				if (tmpData[r][1] == peItems[p]){
					val = parseFloat(tmpData[r][2]);
					break;
				}
			}
			thisData.push ( { pe: peItems[p], value: val } )
		}
		return thisData;
	}

	function analyticsPeriodComparisonData(obj,data,pe,peCompare){

		var sReturn = '';
		var iVal = 0, icompVal = 0, calcDiff = 0;
		var gS = 0;

		for (var r = 0; r < data.rows.length; r++){
			if (data.rows[r][0] == obj.id){
				if (data.rows[r][1] == pe){
					iVal = parseFloat(data.rows[r][2]);
				}
				if (data.rows[r][1] == peCompare){
					icompVal = parseFloat(data.rows[r][2]);
				}
			}
		}

		for (var i = 0; i < obj.attributeValues.length; i++){
			if (obj.attributeValues[i].attribute.name == 'GrowthSentiment'){
				gS = obj.attributeValues[i].value;
			}
		}

		if (g_Meta_dxObject != 'indicators'){
			if (icompVal > 0){
				calcDiff = parseFloat((iVal / icompVal * 100) - 100).toFixed(1);
			} 
		} else {
			calcDiff = parseFloat(iVal - icompVal).toFixed(1);
		}

		sReturn += iVal + ';';
		sReturn += gS + ';';
		sReturn += calcDiff + '';

		return sReturn;

	}

	function analyticsPeriodComparisonHTML(obj,data,pe,peCompare){

		var sReturn = '';
		var iVal = 0, icompVal = 0, calcDiff = 0;
		var gS = 0, diffClass = 'neutral', diffPrefix = '', diffSuffix = '';

		for (var r = 0; r < data.rows.length; r++){

			if (data.rows[r][0] == obj.id){

				if (data.rows[r][1] == pe){
					iVal = data.rows[r][2];
				}

				if (data.rows[r][1] == peCompare){
					icompVal = data.rows[r][2];
				}

			}
		}
		
		for (var i = 0; i < obj.attributeValues.length; i++){
			if (obj.attributeValues[i].attribute.name == 'GrowthSentiment'){
				gS = obj.attributeValues[i].value;
			}
		}

		if (g_Meta_dxObject != 'indicators'){
			if (icompVal > 0){
				calcDiff = ((iVal / icompVal * 100) - 100).toFixed(1);
				diffSuffix = '%';
			} 
		} else {
			calcDiff = (iVal - icompVal).toFixed(1);
		}

		var tbl = document.createElement('table');
		tbl.setAttribute('align', 'right');
		tbl.title = gS;
		var tr = document.createElement('tr');
		tbl.appendChild(tr);

		var td = document.createElement('td');
		tr.appendChild(td);
		td.title = ('' + peCompare + ': ' + formatNumber(icompVal));
		td.innerHTML = (formatNumber(iVal).toString().replace('.0',''));

		var td = document.createElement('td');
		td.setAttribute('class', 'scrollFiller');
		tr.appendChild(td);
		td.innerHTML = (' (');


		var td = document.createElement('td');
		td.setAttribute('style', 'vertical-align:middle;');
		tr.appendChild(td);

		var tdDv = document.createElement('div');
		tdDv.setAttribute('style', 'width:'+g_sentimentIconSize+'px;height:'+g_sentimentIconSize+'px;vertical-align:middle;padding:0;');

		if (calcDiff < 0){
			diffPrefix = '';
			if (gS < 0){
				tdDv.setAttribute('class', 'growthDownPositive');
				diffClass = 'positive';
			} else {
				if (gS > 0){
					tdDv.setAttribute('class', 'growthDownNegative');
					diffClass = 'negative';
				} else {
					tdDv.setAttribute('class', 'growthDownNeutral');
				}
			}
		} else {
			if (calcDiff > 0){
				diffPrefix = '+';
				if (gS < 0){
					tdDv.setAttribute('class', 'growthUpNegative');
					diffClass = 'negative';
				} else {
					if (gS > 0){
						tdDv.setAttribute('class', 'growthUpPositive');
						diffClass = 'positive';
					} else {
						tdDv.setAttribute('class', 'growthUpNeutral');
					}
				}
			} else {
				
				var IcNeur = document.createElement('i');
				IcNeur.setAttribute('class', 'material-icons material-small neutral');
				IcNeur.setAttribute('style', 'font-size:14px;');
				IcNeur.innerHTML = 'remove';
				tdDv.appendChild(IcNeur);
				
			}
		}

		td.appendChild(tdDv);

		var td = document.createElement('td');
		td.setAttribute('class', diffClass);
		tr.appendChild(td);
		td.innerHTML = (diffPrefix + formatNumber(calcDiff)).toString().replace('.0','') + diffSuffix;

		var td = document.createElement('td');
		td.setAttribute('class', 'scrollFiller');
		tr.appendChild(td);
		td.innerHTML = (')');

		return tbl.outerHTML;

	}

	function InitialiseMapBrowser(){

		g_mapBrowse = new L.map('mapContainer', { renderer: L.svg({ padding: g_mapPadding }) }).setView([-27, 24], 5);
		g_mapBrowse.on('click', function(e) {
			g_clickedLatLong = ((e.latlng.lng).toFixed(6) + "," + (e.latlng.lat).toFixed(6));
		});

		var OpenStreetMap_Mapnik = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {opacity: g_baseMapLayerOpacity, maxZoom: 19,attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});
		var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {opacity: g_baseMapLayerOpacity, attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'});
		var Esri_WorldStreetMap = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {opacity: g_baseMapLayerOpacity, attribution: 'Tiles &copy; Esri &mdash; Source: Esri'});

		g_baseMapCollection = {
			"OpenStreetMap.": OpenStreetMap_Mapnik,
			"EsriWorldImagery": Esri_WorldImagery,
			"EsriWorldStreetMap": Esri_WorldStreetMap
		};

		var layerControl = L.control.layers(g_baseMapCollection, null, {position:'bottomright', opacitySlider: true}).addTo(g_mapBrowse);
		g_baseLayer = OpenStreetMap_Mapnik.addTo(g_mapBrowse);

		g_mapBrowse.on('resize', function(e) {
			//$('#mapContainer').height($('.page-3').height() - $('#legendMapBottom').height());
			$('#mapContainer').height($('.page-3').height());
			$('#mapContainer').width($('.page-3').width() - 280);
		});

		/*
		g_ObjSidebarLeft = L.control.sidebar('mapsidebarLeft', {
			closeButton: false,
			position: 'left'
		});

		g_mapBrowse.addControl(g_ObjSidebarLeft);
		document.getElementById('mapsidebarLeft').innerHTML = getmapLeftMenuContent();	
		g_ObjSidebarLeft.show();
		*/

		$('#mapsidebarLeft')[0].innerHTML = getmapLeftMenuContent();	

		ToggleFloatMenuGroup(document.getElementById('imggrp1Labels'),"grp1Labels")
		ToggleFloatMenuGroup(document.getElementById('imggrp1Options'),"grp1Options")
		ToggleFloatMenuGroup(document.getElementById('imggrp3sub2'),"grp3sub2")
		ToggleFloatMenuGroup(document.getElementById('imggrp3sub3'),"grp3sub3")

	}


	function loadSiemaMarquee(data){

		var dvParent = document.createElement('div');

		var dvSiema = document.createElement('div');
		dvSiema.setAttribute('class', 'siema');
		dvSiema.setAttribute('id', 'siema');
		dvSiema.setAttribute('style', 'overflow:hidden;padding:0;scroll:no;');
		dvParent.appendChild(dvSiema);

		for (var i = 0; i < data.indicatorGroups.length; i++){

			if (data.indicatorGroups[i].indicators.length){

				var tbl = document.createElement('table');
				dvSiema.appendChild(tbl);
				var tr = document.createElement('tr');
				tbl.appendChild(tr);
				var td = document.createElement('td');
				tr.appendChild(td);

				td.setAttribute('id', data.indicatorGroups[i].id);
				td.setAttribute('style', 'font-weight:700;padding:4px;font-size:12px;');

				var tdC = document.createElement('div');
				tdC.setAttribute('id', data.indicatorGroups[i].id);
				tdC.setAttribute('style', 'display:-webkit-flex;display:flex;font-weight:700;padding:0;font-size:12px;white-space: nowrap;vertical-align:middle;');
				tdC.style.flexDirection ="row";
				td.appendChild(tdC);

				var txt = document.createTextNode(data.indicatorGroups[i].name);
				tdC.appendChild(txt);

				for (var p = 0; p < data.indicatorGroups[i].indicators.length; p++){
	/*

					var tdC = document.createElement('td');
					tdC.setAttribute('id', data.indicatorGroups[i].indicators[p].id);
					tdC.setAttribute('style', 'display:-webkit-flex;display:flex;font-weight:400;padding:0;font-size:12px;white-space: nowrap;vertical-align:middle;');
					tdC.style.flexDirection ="column";
					tr.appendChild(tdC);
	*/

					var tdC = document.createElement('div');
					tdC.setAttribute('id', data.indicatorGroups[i].indicators[p].id);
					tdC.setAttribute('style', 'display:-webkit-flex;display:flex;font-weight:400;padding:0;font-size:12px;white-space: nowrap;vertical-align:middle;');
					tdC.style.flexDirection ="row";
					td.appendChild(tdC);

					var txt = document.createTextNode(data.indicatorGroups[i].indicators[p].name + ( (p < (data.indicatorGroups[i].indicators.length-1) ) ? ' | ' : '') );
					tdC.appendChild(txt);

				}

			}

		}

		$('#layout_layout2_panel_top')[0].childNodes[7].innerHTML = dvParent.innerHTML;
	/*
		setTimeout(function () {
			const mySiema = new Siema({
							  selector: '.siema',
							  duration: 500,
							  easing: 'ease',
							  perPage: 1,
							  startIndex: 0,
							  draggable: true,
							  threshold: 5000,
							  loop: true,
							  onInit: () => {  setTimeout(function () { mySiema.next() },5000); },
							  onChange: () => { setTimeout(function () { mySiema.next() },5000); }
			});
		}, 100);
	*/
	}

	function getMainContent(){
		var dvParent = document.createElement('div');
		dvParent.setAttribute('id', 'mainPage');
		return dvParent.outerHTML;
	}

	function showHideLeftMenu(){
		//w2ui['layout'].toggle('left', window.instant);
		//w2ui['layout'].sizeTo('left',201);
		w2ui['layout2'].toggle('left', window.instant)
	}
	
	function paddnumeric(val,chars){
		var sReturn = '';
		for(i = parseInt(val.toString().length); i < parseInt(chars); i++) {
			sReturn += '0';
		}
		return (sReturn.toString()+val.toString());
	}

	function formatNumber(num) {
		return ("" + num).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, function($1) { return $1 + "," });
	}

	function getPeriodTrendItems(pe){

		var sReturn = '';

		switch ((g_peTypeOut).toLowerCase()) {
			case 'monthly':
				for(var m = 1; m <= 12; m++) {
					sReturn+=(pe.toString()+paddnumeric((m).toString(),2)+';');
				}
				sReturn = sReturn.substring(0, sReturn.length-1)
				//do something
				break;
			case -1:
				//do something
				break;
			case 0:
				//do something
				break;
			default:
				break;
		}

		return sReturn;

		//var g_pe = 2017;
		//var g_peCompare = 2016;
		//var g_peTypeOut = 'Month';
	}
	
	
	function initialiseFavouritesLayout(){

		//if ( ($('.page-6')[0].childNodes[0].innerHTML).toString().trim().length == 0 )
		{

			var Inst = myAppData[0].instances;

			var dvParent = document.createElement('div');

			var dv = document.createElement('dv');
			dv.setAttribute('style', 'margin:10px;padding:8px;');
			dvParent.appendChild(dv);
			
				var lbl = document.createElement('label');
				lbl.setAttribute('style', 'opacity:0.9;font-weight:400;font-size:13px;vertical-align:middle;color:#000000;width:inherit;');
				dv.appendChild(lbl);

				var txt = document.createTextNode('The following favourites are available:');
				lbl.appendChild(txt);

			var dv = document.createElement('dv');
			dv.setAttribute('style', 'margin:0 10px 0 10px;');
			dvParent.appendChild(dv);

			var tbl = document.createElement('table');
			tbl.setAttribute('style', 'border: 1px solid #E9E9E9;width:100%;border-radius:4px;background-Color:#fff;');
			dv.appendChild(tbl);

			var tr = document.createElement('tr');
			tr.setAttribute('style', 'height:50px;');
			tbl.appendChild(tr);

			var td = document.createElement('td');
			td.setAttribute('style', 'font-weight:400;padding:8px 8px 8px 18px;font-size:16px;color:#1f7995;letter-spacing: 1px;width:400px;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;');
			tr.appendChild(td);

			var txt = document.createTextNode('Favourite');
			td.appendChild(txt);

			var td = document.createElement('td');
			td.setAttribute('style', 'width:50px;text-align:left;font-size:12px;width:80px;color:#1f7995;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;');
			td.setAttribute('colspan', 1);
			tr.appendChild(td);
			var txt = document.createTextNode('collection');
			td.appendChild(txt);

			var td = document.createElement('td');
			td.setAttribute('style', ';border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;min-width:10%;max-width:75%;');
			td.setAttribute('colspan', 1);
			var txt = document.createTextNode('action');
			td.appendChild(txt);
			tr.appendChild(td);

			Inst.forEach(function(element) {
			
				var Fav = element.favourites;
				
				Fav.forEach(function(favourite) {

					var tr = document.createElement('tr');
					tr.setAttribute('class', 'instance-tr');
					tbl.appendChild(tr);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:400px;overflow:hidden;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);


						var tblIn = document.createElement('table');
						tblIn.setAttribute('style', "width:100%;");
						td.appendChild(tblIn);

						var trIn = document.createElement('tr');
						tblIn.appendChild(trIn);

						var tdIn = document.createElement('td');
						tdIn.setAttribute('style', 'padding:4px;width:32px;text-align:center;');
						/*tdIn.setAttribute('id', 'favourite_icon_holder' + element.instanceid);
						tdIn.setAttribute('onmouseover', "evalInstanceStatus(" + element.instanceid + ");");
						tdIn.setAttribute('onclick', "evalInstanceEvent(" + element.instanceid + ");");*/
						trIn.appendChild(tdIn);
					
						var chkIc = document.createElement('i');
						chkIc.setAttribute('id', 'favourite_icon_' + element.instanceid +'_'+ favourite.id);
						chkIc.setAttribute('class', "material-icons favourite");
						chkIc.setAttribute('style', "opacity:0.75;");
						chkIc.innerHTML = 'star';
						tdIn.appendChild(chkIc);

						var tdIn = document.createElement('td');
						tdIn.setAttribute('style', 'padding:4px;width:135px;');
						trIn.appendChild(tdIn);

						var tdC = document.createElement('div');
						tdC.setAttribute('style', 'text-align:left;font-weight:400;font-size:13px;vertical-align:middle;color:#000;opacity:0.75;width:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;');
						tdC.setAttribute('class', '.material-instance-connected');
						tdIn.appendChild(tdC);

						var txt = document.createTextNode((element.name).toString().trim());
						tdC.appendChild(txt);

						var tdIn = document.createElement('td');
						tdIn.setAttribute('style', 'padding:4px;width:242px;');
						trIn.appendChild(tdIn);

						var tdC = document.createElement('div');
						tdC.setAttribute('style', 'text-align:left;cursor:default;padding:2px;font-weight:400;font-size:13px;vertical-align:middle;color:#669999;width:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;');
						tdC.setAttribute('title', favourite.name);

						tdIn.appendChild(tdC);

						var txt = document.createTextNode(favourite.name);
						tdC.appendChild(txt);


					var td = document.createElement('td');
					td.setAttribute('class', 'instance-td');
					//td.setAttribute('width', 'instance-td');
					tr.appendChild(td);

					var tdC = document.createElement('div');
					tdC.setAttribute('style', 'font-weight:400;font-size:13px;vertical-align:middle;color:#525252;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0.65');
					tdC.innerHTML = favourite.collection;
					td.appendChild(tdC);

					var td = document.createElement('td');
					td.setAttribute('style', '');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var imgMI = document.createElement('i');
					imgMI.setAttribute('class', 'material-icons material-medium');
					//imgMI.setAttribute('id', 'explorer-icon-toggle-close-' + favourite.collection[i].groupid);
					imgMI.setAttribute('onclick', 'removeFavourite(this,"' + favourite.objName + '","' + favourite.id + '");');
					imgMI.innerHTML = 'delete'; //((bClosed) ? 'keyboard_arrow_down' : 'keyboard_arrow_up');
					td.appendChild(imgMI);

				});

			});

			var tr = document.createElement('tr');
			tr.setAttribute('style', 'height:50px;');
			tbl.appendChild(tr);

			var td = document.createElement('td');
			td.setAttribute('style', 'font-weight:400;padding:10px 10px 10px 8px;font-size:16px;color:#1f7995;letter-spacing: 1px;width:400px;');
			td.setAttribute('colspan', 3);
			tr.appendChild(td);


			$('.page-6')[0].childNodes[0].innerHTML = dvParent.innerHTML;

		}
	
	}


	/*  Display USER-ACCOUNT Summary  */

	function initialiseAccountLayout(pg){

		{

			var User = myAppData[0].user;

			var dvParent = document.createElement('div');

			var dv = document.createElement('dv');
			dv.setAttribute('style', 'margin:10px;padding:8px;');
			dvParent.appendChild(dv);
			
				var lbl = document.createElement('label');
				lbl.setAttribute('style', 'opacity:0.9;font-weight:400;font-size:13px;vertical-align:middle;color:#000000;width:inherit;');
				dv.appendChild(lbl);

				var txt = document.createTextNode('Your known account information is as follows:');
				lbl.appendChild(txt);

			var dv = document.createElement('dv');
			dv.setAttribute('style', 'margin:0 10px 0 10px;');
			dvParent.appendChild(dv);

			var tbl = document.createElement('table');
			tbl.setAttribute('style', 'border: 1px solid #E9E9E9;max-width:800px;border-radius:4px;background-Color:#fff;');
			dv.appendChild(tbl);

			var tr = document.createElement('tr');
			tr.setAttribute('style', 'height:50px;');
			tbl.appendChild(tr);

			var td = document.createElement('td');
			td.setAttribute('style', 'font-weight:400;padding:8px;font-size:16px;color:#1f7995;letter-spacing:1px;width:400px;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;text-align:center;');
			td.setAttribute('colspan', 2);
			tr.appendChild(td);

			var txt = document.createTextNode(User.displayName); //userCredentials.code
			td.appendChild(txt);

			var td = document.createElement('td');
			td.setAttribute('style', 'font-weight:400;padding:8px;font-size:16px;color:#1f7995;letter-spacing:1px;width:400px;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;text-align:center;');
			td.setAttribute('colspan', 1);
			tr.appendChild(td);

					var tr = document.createElement('tr');
					tr.setAttribute('class', 'instance-tr');
					tr.setAttribute('style', 'height:30px;');
					tbl.appendChild(tr);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;text-align:right;background-Color:#f7f7f7;padding:4px;border-right:1px solid #edf2f6;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode('First Name:');
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;overflow:hidden;padding:4px');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode(User.firstName);
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'overflow:hidden;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);


					var tr = document.createElement('tr');
					tr.setAttribute('class', 'instance-tr');
					tr.setAttribute('style', 'height:30px;');
					tbl.appendChild(tr);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;text-align:right;background-Color:#f7f7f7;padding:4px;border-right:1px solid #edf2f6;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode('Surname:');
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;overflow:hidden;padding:4px');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode(User.surname);
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'overflow:hidden;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);


					var tr = document.createElement('tr');
					tr.setAttribute('class', 'instance-tr');
					tr.setAttribute('style', 'height:30px;');
					tbl.appendChild(tr);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;text-align:right;background-Color:#f7f7f7;padding:4px;border-right:1px solid #edf2f6;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode('view data below:');
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;overflow:hidden;padding:4px');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode(((User.dataViewOrganisationUnits[0].name) ? User.dataViewOrganisationUnits[0].name : User.dataViewOrganisationUnits[0].id));
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'overflow:hidden;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);
	

					var tr = document.createElement('tr');
					tr.setAttribute('class', 'instance-tr');
					tr.setAttribute('style', 'height:30px;');
					tbl.appendChild(tr);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;text-align:right;background-Color:#fff;color:#1f7995;padding:4px;vertical-align:top;font-weight:800;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode('Enterprise Accounts:');
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'width:200px;height:200px;overflow:hidden;padding:4px;vertical-align:top;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

					var txt = document.createTextNode(User.dataViewOrganisationUnits);
					td.appendChild(txt);

					var td = document.createElement('td');
					td.setAttribute('style', 'overflow:hidden;');
					td.setAttribute('class', 'instance-td');
					tr.appendChild(td);

			var tr = document.createElement('tr');
			tr.setAttribute('style', 'height:50px;');
			tbl.appendChild(tr);

			var td = document.createElement('td');
			td.setAttribute('style', 'font-weight:400;padding:10px 10px 10px 8px;font-size:16px;color:#1f7995;letter-spacing: 1px;width:400px;');
			td.setAttribute('colspan', 3);
			tr.appendChild(td);

			$('.page-'+pg)[0].childNodes[0].innerHTML = dvParent.innerHTML;

		}

	}

	/*  Display META-DATA Browser  */

	function intialiseMetaExplorerLayout() {

		var obj = g_Meta_dxObject;
		var grp = g_Meta_dxGroup;
		
		if (obj == 'organisationUnitGroups'){
			var sJurl = (atob(g_sourceDB) + '/api/organisationUnitGroups.json?fields=id,name,description,organisationUnitGroupSet[id,name,compulsory]&pageSize=20000');
		} else {
			var sJurl = (atob(g_sourceDB) + '/api/' + obj + '.json?fields=id,name,description,' + ((grp == 'localGroups') ? ((obj == 'indicators') ? 'indicatorGroups' : 'dataElementGroups') : grp) + '[id,name],' + ((obj == 'indicators') ? 'indicatorType[name]' : 'numberType,domainType') + '&pageSize=20000');
		}

		$('#ExplorerTitle')[0].innerHTML = getCurrentInstanceAttribute('name');
		$('#meta-data-browse')[0].innerHTML = '<div style="width:32px;height:32px;position:relative;right:95%;" data-source="' + g_sourceDB + '" class="infiniteSpinner">&nbsp;</div>'; //<img src="img/loading.gif" style="width:50px;height:50px;">

		$.ajax({
			url: sJurl,headers: { "Authorization": 'Basic ' + g_dpk},
			success: function (data) {
				constructDXlayout(data,'meta-data-browse',obj,grp);
				$('#meta-data-browse').attr("data-source",g_sourceDB);
			}
		});
	}

	function constructDXlayout(myData,sDestination,obj,grp){

		var myArr = [];
		var sReturn = '';
		var i;

		if (obj == 'indicators'){
			for(i = 0; i < myData.indicators.length; i++) {
				if (grp == 'localGroups'){
					myArr.push({
							id: myData.indicators[i].id,
							name: myData.indicators[i].name,
							description: myData.indicators[i].description,
							group: ((myData.indicators[i].indicatorGroups.length == 0) ? '** Unkown' : myData.indicators[i].indicatorGroups[0].name),
							groupid: ((myData.indicators[i].indicatorGroups.length == 0) ? '0' : myData.indicators[i].indicatorGroups[0].id),
							groupwithname: ((myData.indicators[i].indicatorGroups.length == 0) ? 'zzzz' + ';' + myData.indicators[i].name : myData.indicators[i].indicatorGroups[0].name + ';' + myData.indicators[i].name).toLowerCase(),
							type: ((myData.indicators[i].indicatorType.length == 0) ? '** unknown' : myData.indicators[i].indicatorType.name),
							compulsory: 0
						});
				}
				else{
					if (grp == 'dataSets'){
						myArr.push({
								id: myData.indicators[i].id,
								name: myData.indicators[i].name,
								description: myData.indicators[i].description,
								group: ((myData.indicators[i].dataSets.length == 0) ? '** Unkown' : myData.indicators[i].dataSets[0].name),
								groupid: ((myData.indicators[i].dataSets.length == 0) ? '0' : myData.indicators[i].dataSets[0].id),
								groupwithname: ((myData.indicators[i].dataSets.length == 0) ? 'zzzz' + ';' + myData.indicators[i].name : myData.indicators[i].dataSets[0].name + ';' + myData.indicators[i].name).toLowerCase(),
								type: ((myData.indicators[i].indicatorType.length == 0) ? '** unknown' : myData.indicators[i].indicatorType.name),
								compulsory: 0
							});
					}
					else{
						
					}
				}
			}
		}
		else{
		
			if (obj == 'dataElements'){

				for(i = 0; i < myData.dataElements.length; i++) {
					if (grp == 'localGroups'){
						if (myData.dataElements[i].domainType == 'AGGREGATE'){
							myArr.push({
									id: myData.dataElements[i].id,
									name: myData.dataElements[i].name,
									description: myData.dataElements[i].description,
									group: ((myData.dataElements[i].dataElementGroups.length == 0) ? '** Unkown' : myData.dataElements[i].dataElementGroups[0].name),
									groupid: ((myData.dataElements[i].dataElementGroups.length == 0) ? '0' : myData.dataElements[i].dataElementGroups[0].id),
									groupwithname: ((myData.dataElements[i].dataElementGroups.length == 0) ? 'zzzz' + ';' + myData.dataElements[i].name : myData.dataElements[i].dataElementGroups[0].name + ';' + myData.dataElements[i].name).toLowerCase(),
									type: myData.dataElements[i].numberType,
									compulsory: 0
								});
						}
					}
					else{
						if (grp == 'dataSets'){
							if (myData.dataElements[i].dataSets != undefined){
								if (myData.dataElements[i].domainType == 'AGGREGATE'){
									myArr.push({
											id: myData.dataElements[i].id,
											name: myData.dataElements[i].name,
											description: myData.dataElements[i].description,
											group: ((myData.dataElements[i].dataSets.length == 0) ? '** Unkown' : myData.dataElements[i].dataSets[0].name),
											groupid: ((myData.dataElements[i].dataSets.length == 0) ? '0' : myData.dataElements[i].dataSets[0].id),
											groupwithname: ((myData.dataElements[i].dataSets.length == 0) ? 'zzzz' + ';' + myData.dataElements[i].name : myData.dataElements[i].dataSets[0].name + ';' + myData.dataElements[i].name).toLowerCase(),
											type: myData.dataElements[i].numberType,
											compulsory: 0
										});
								}
							} else {
								if (myData.dataElements[i].domainType == 'AGGREGATE'){
									myArr.push({
											id: myData.dataElements[i].id,
											name: myData.dataElements[i].name,
											description: myData.dataElements[i].description,
											group: '** Unkown',
											groupid: '0',
											groupwithname: ('zzzz;' + myData.dataElements[i].name).toLowerCase(),
											type: myData.dataElements[i].numberType,
											compulsory: 0
										});
								}
							}
						}
						else{
							
						}
					}
				}
				
			} else {

				for(i = 0; i < myData.organisationUnitGroups.length; i++) {
					if (grp == 'localGroups'){
						myArr.push({
								id: myData.organisationUnitGroups[i].id,
								name: myData.organisationUnitGroups[i].name,
								description: myData.organisationUnitGroups[i].description,
								group: ((myData.organisationUnitGroups[i].organisationUnitGroupSet == undefined) ? '** Unkown' : myData.organisationUnitGroups[i].organisationUnitGroupSet.name),
								groupid: ((myData.organisationUnitGroups[i].organisationUnitGroupSet == undefined) ? '0' : myData.organisationUnitGroups[i].organisationUnitGroupSet.id),
								groupwithname: ((myData.organisationUnitGroups[i].organisationUnitGroupSet == undefined) ? 'zzzz' + ';' + (myData.organisationUnitGroups[i].name).toLowerCase() : (myData.organisationUnitGroups[i].organisationUnitGroupSet.name).toLowerCase() + ';' + myData.organisationUnitGroups[i].name).toLowerCase(),
								type: 'groupset',
								compulsory: ((myData.organisationUnitGroups[i].organisationUnitGroupSet == undefined) ? 0 : myData.organisationUnitGroups[i].organisationUnitGroupSet.compulsory)
							});
					}
				}

			}
		}

		g_Meta_Data = JSON.parse(JSON.stringify(myArr));

		generateMetaDataLayout(sDestination);

	}
	
	function isFavourite(id){
		var myFav = getConnectedInstanceAttributeValue('favourites');
		var bFav = false;
		for(var f = 0; f < myFav.length; f++) {
			if (myFav[f].id == id) {
				bFav = true;
				break;
			}
		}
		return bFav;
	}
	
	function shuffleMetaDataExplorerLayout(){

		if (g_Meta_GROUP_COLUMNS == 1){
			$( "#meta-data-browse-Layout" ).css("flex-direction", ( (g_Meta_SORT_ARRAY_DESC) ? "column-reverse" : "column") ) 
			$( "#meta-data-browse-Layout" ).css("-webkit-flex-direction", ( (g_Meta_SORT_ARRAY_DESC) ? "column-reverse" : "column") ) 
		} else {
			$( "#meta-data-browse-Layout" ).css("flex-direction", ( (g_Meta_SORT_ARRAY_DESC) ? "row-reverse" : "row") ) 
			$( "#meta-data-browse-Layout" ).css("-webkit-flex-direction", ( (g_Meta_SORT_ARRAY_DESC) ? "row-reverse" : "row") ) 		
		}
		
		var iContainerW = $('#metaExploreHeader').width();

		$( ".dxPanel" ).css( "width", Math.floor(parseFloat(((iContainerW)/g_Meta_GROUP_COLUMNS)-(g_Meta_GROUP_COLUMNS*6))).toFixed(0) + 'px'); //(1/g_Meta_GROUP_COLUMNS)
		$( ".dxPanel" ).css( "height", "inherit");
	}

	function shuffleMetaDataExplorerExpandCollapse(){

		var ObjGrp = getConnectedInstanceAttributeValue(g_Meta_dxObjGrp);
		var bClosed = (($('#explorerExpandCollapseInner').html() == 'keyboard_arrow_up') ? true : false);

		ObjGrp.forEach(function(grp) {
			if (grp[g_Meta_dxObject] != undefined){
				if ($("#explorer-icon-toggle-close-" + grp.id)[0] != undefined){
					//if ($("#explorer-icon-toggle-close-" + grp.id)[0].html() != $('#explorerExpandCollapseInner').html())
					{
					//thisObj.innerHTML = ( (bClosed) ? "keyboard_arrow_down" : "keyboard_arrow_up" );
						ToggleHideGroup($("#explorer-icon-toggle-close-" + grp.id)[0],grp.id);
					}
				}
			}
		});

		// group '0' = Unknown: Greg - we need a solution for "Ungrouped"
		if ($("#explorer-icon-toggle-close-" + 0)[0] != undefined){
			ToggleHideGroup($("#explorer-icon-toggle-close-" + grp.id)[0],grp.id)
		}

		$('#explorerExpandCollapseInner').html((($('#explorerExpandCollapseInner').html() == 'keyboard_arrow_up') ? 'keyboard_arrow_down' : 'keyboard_arrow_up'));

	}

	function getMetaDataDxList(newArr,sGroup){

		var sReturn = '';
		var objFilter = newArr.filter(function(newArr) {
			return newArr.groupid.indexOf(sGroup) !== -1;
		});

		objFilter.forEach(function(element) {
			sReturn += element.id+';';
		});

		return sReturn.substring(0, sReturn.length-1);

	}

	function generateMetaDataLayout(sDestination){

		var myFav = getConnectedInstanceAttributeValue('favourites');
		var Alt = '';

		var sort_by = function(field, reverse, primer){

		   var key = primer ? 
			   function(x) {return primer(x[field])} : 
			   function(x) {return x[field]};

		   reverse = !reverse ? 1 : -1;

		   return function (a, b) {
			   return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
			 } 
		}

		var text_filter = document.getElementById('searchMetaExplore').value;
		var meta_data = g_Meta_Data.slice(0); //slice method creates CLONE of array

		if (text_filter.length){
			meta_data = meta_data.filter(function(objArr) {
				return objArr.name.indexOf(text_filter) !== -1;
			});
		}

		meta_data.sort(sort_by('groupwithname', g_Meta_SORT_ARRAY_DESC));

		var lsGroup = '';
		var iCols = 0, iContainerW = 0;
		var dvParent = document.createElement('div');

		var dvFlex = document.createElement('div');
		dvFlex.setAttribute('style', 'display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;flex-flow:row wrap;flex-wrap: wrap;cellpadding:0;align-items:center;justify-content: center;align-self: flex-start;');
		dvFlex.setAttribute('id', 'meta-data-browse-Layout');
		dvParent.appendChild(dvFlex);
		
		iContainerW = $('#metaExploreHeader').width();

		for(var i = 0; i < meta_data.length; i++) {
		//meta_data.forEach(function(element) {

			var bFavGrp = false, bFavDx = false;
			var bClosed = getConnectedInstanceDxgroupAttribute (g_Meta_dxObjGrp,meta_data[i].groupid,'explorer.hide',false);

			for(var f = 0; f < myFav.length; f++) {
				if ( (myFav[f].instanceid == getConnectedInstanceAttributeValue('instanceid')) && (myFav[f].objName == g_Meta_dxObjGrp) && (myFav[f].id == meta_data[i].groupid) ){
					bFavGrp = true;
					break;
				}
				if ( (myFav[f].instanceid == getConnectedInstanceAttributeValue('instanceid')) && (myFav[f].objName == g_Meta_dxObject) && (myFav[f].id == meta_data[i].id) ){
					bFavDx = true;
					break;
				}
				
			}

			if (meta_data[i].group != lsGroup){

				if (Intr != undefined){
					/* 'FILLER' row */
					var Intr = document.createElement('tr');
					Intb.appendChild(Intr);

					var Intd = document.createElement('td');
					Intd.setAttribute('style', "padding:2px;height:14px;");
					Intd.setAttribute('colspan',3);
					Intr.appendChild(Intd);
				}

				var dvObj = document.createElement('div');
				dvObj.setAttribute('class', 'dxPanel');
				dvObj.setAttribute('style', 'align-self:flex-start;width:' + Math.floor(parseFloat(((iContainerW)/g_Meta_GROUP_COLUMNS)-(g_Meta_GROUP_COLUMNS*6))).toFixed(0) + 'px'); //(1/g_Meta_GROUP_COLUMNS)
				dvFlex.appendChild(dvObj);

				var table = document.createElement('table');
				table.setAttribute('style', 'background-Color:#ffffff;padding:0;width:100%');
				table.setAttribute('class', 'dxGroup');
				dvObj.appendChild(table);

				var tr = document.createElement('tr');
				table.appendChild(tr);

				var td = document.createElement('td');
				td.setAttribute('style', 'background-Color:#ffffff;vertical-align:top;width:100%;');
				tr.appendChild(td)
				iCols += 1;


				lsGroup = meta_data[i].group;

				var divGrp = document.createElement('div');
				divGrp.classList.add('Group') ;
				divGrp.setAttribute('id', meta_data[i].groupid);
				divGrp.setAttribute('data-name', lsGroup);
				divGrp.setAttribute('data-dx',getMetaDataDxList(meta_data.slice(0),meta_data[i].groupid));
				td.appendChild(divGrp)

				var Intb = document.createElement('table');
				Intb.setAttribute('style', "width:100%");
				divGrp.appendChild(Intb);
				var Intr = document.createElement('tr');
				Intb.appendChild(Intr);
				var Intd = document.createElement('td');
				Intd.setAttribute('class', "material-selector");
				Intr.appendChild(Intd);

				var Intd = document.createElement('td');
				Intd.setAttribute('style', "padding:1px");
				Intr.appendChild(Intd);
				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons star');
				if (bFavGrp){
					$(imgMI).addClass('favourite');
				}

				imgMI.setAttribute('onclick', 'ToggleFavouriteGroup(this,"' + meta_data[i].groupid + '","'+lsGroup+'");');
				imgMI.innerHTML = ((bFavGrp) ? 'star' : 'star_border');
				Intd.appendChild(imgMI);

				var Intd = document.createElement('td');
				Intd.setAttribute('style', "padding:0 0 0 2px;font-size:inherit;width:98%;") ;
				Intr.appendChild(Intd);

				var lblGrp = document.createElement('label');
				lblGrp.setAttribute('onclick', 'ToggleHideDxGroup($("#explorer-icon-toggle-close-' + meta_data[i].groupid + '")[0],"' + meta_data[i].groupid + '")');
				lblGrp.setAttribute('onselectstart','return false');
				lblGrp.setAttribute('class','groupLabel');
				Intd.appendChild(lblGrp);
				var txt = document.createTextNode((lsGroup).toUpperCase());
				lblGrp.appendChild(txt);

				if (meta_data[i].compulsory){
					var compStr = document.createElement('span');
					compStr.setAttribute('style', "padding:2px 0 0 6px;font-size:11px;color:red;letter-spacing:1;") ;
					compStr.innerHTML = '(compulsory)';
					Intd.appendChild(compStr);
				}

				var Intd = document.createElement('td');
				Intd.setAttribute('style', "padding:1px");
				Intr.appendChild(Intd);
				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons material-medium timeline');
				imgMI.setAttribute('onclick', 'g_dxGid = "' + meta_data[i].groupid + '";g_ouGSname = ((g_Meta_dxObject == "organisationUnitGroups") ? "' + lsGroup + '" : g_ouGSname); loadMarquee(((g_Meta_dxObject == "indicators") ? 2 : (g_Meta_dxObject == "dataElements") ? 3 : 1));');
				imgMI.innerHTML = 'play_circle_outline';
				Intd.appendChild(imgMI);

				var Intd = document.createElement('td');
				Intd.setAttribute('style', "padding:1px");
				Intr.appendChild(Intd);
				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons material-medium timeline');
				imgMI.setAttribute('onclick', 'loadmetaExploreCollectionTimelines(this)'); //"' + meta_data[i].groupid + '"
				imgMI.innerHTML = 'timeline';
				Intd.appendChild(imgMI);

				var Intd = document.createElement('td');
				Intd.setAttribute('style', "padding:1px");
				Intr.appendChild(Intd);
				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons material-medium grid');
				//imgMI.setAttribute('onclick', 'g_dxGid = "' + meta_data[i].groupid + '";loadMarquee((g_Meta_dxObject == "indicators") ? 2 : 3);');
				imgMI.innerHTML = 'grid_on';
				Intd.appendChild(imgMI);

				var Intd = document.createElement('td');
				Intd.setAttribute('style', "padding:1px 1px 1px 8px");
				Intr.appendChild(Intd);
				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons material-medium close');
				imgMI.setAttribute('id', 'explorer-icon-toggle-close-' + meta_data[i].groupid);
				imgMI.setAttribute('onclick', 'ToggleHideDxGroup(this,"' + meta_data[i].groupid + '");');
				imgMI.innerHTML = ((bClosed) ? 'keyboard_arrow_down' : 'keyboard_arrow_up');
				Intd.appendChild(imgMI);

				var dvItems = document.createElement('div');
				dvItems.setAttribute('id', 'dxcontainer-' + meta_data[i].groupid);
				if (bClosed){
					dvItems.setAttribute('style', 'display:none;');
				}
				td.appendChild(dvItems);
			}

			var Intb = document.createElement('table');
			Intb.setAttribute('style', "width:100%;margin:0;border-top:1px solid #f5f5f5;border-margin:4px;");
			//Intb.setAttribute('onmouseover', "$(this).addClass('dxRowItem');");
			//Intb.setAttribute('onmouseout', "$(this).removeClass('dxRowItem');");
			dvItems.appendChild(Intb);

			var Intr = document.createElement('tr');
			Intr.setAttribute('class', 'dxExplorerItem');
			Intb.appendChild(Intr);

			var Intd = document.createElement('td');
			Intd.setAttribute('style', "padding: 2px 2px 2px 4px;height:28px;vertical-align:middle;text-align:left;");
			Intr.appendChild(Intd);


				var tblInA = document.createElement('table');
				//tblInA.setAttribute('style', "width:100%;");
				Intd.appendChild(tblInA);

				var trInA = document.createElement('tr');
				tblInA.appendChild(trInA);

				var tdInA = document.createElement('td');
				tdInA.setAttribute('style', "width:20px;padding:0 2px 0 0");
				trInA.appendChild(tdInA);

				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons material-small');
				imgMI.setAttribute('style', "font-size:18px;color:#257BB9;opacity:0.25;");
				imgMI.setAttribute('onclick', 'ToggleFavouriteDxItem(this,"'+meta_data[i].id+'","'+meta_data[i].name+'")');

				if (bFavDx){
					$(imgMI).addClass('favourite');
				}
				imgMI.innerHTML = ((bFavDx) ? 'star' : 'star_border');
				tdInA.appendChild(imgMI);

				var tdInA = document.createElement('td');
				trInA.appendChild(tdInA);

				var litmA = document.createElement('a');
				litmA.classList.add('main-content-definition') ;
				litmA.title = meta_data[i].description;
				litmA.id = meta_data[i].id;
				tdInA.appendChild(litmA);
				var txt = document.createTextNode(meta_data[i].name);
				litmA.href = "javascript: ZoomDxDD('" + meta_data[i].id + "')";
				litmA.appendChild(txt);

				var tdInA = document.createElement('td');
				tdInA.setAttribute('style', "width:17px;");
				trInA.appendChild(tdInA);

				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons material-small material-meta-dx');
				imgMI.setAttribute('style', "padding: 2px 2px 2px 12px;");
				imgMI.setAttribute('onclick', 'loadmetaExploreItemTimelines("' + meta_data[i].id + '","' + meta_data[i].groupid + '")');
				imgMI.innerHTML = 'timeline';
				tdInA.appendChild(imgMI);

				var tdInA = document.createElement('td');
				tdInA.setAttribute('style', "width:17px;");
				trInA.appendChild(tdInA);

				var imgMI = document.createElement('i');
				imgMI.setAttribute('class', 'material-icons material-small material-meta-dx');
				imgMI.setAttribute('style', "padding: 2px 2px 2px 6px;");
				imgMI.setAttribute('onclick', 'openZscoreMap("' + meta_data[i].id + '")');
				imgMI.innerHTML = 'layers';
				tdInA.appendChild(imgMI);


			var Intd = document.createElement('td');
			Intd.setAttribute('style', "padding:2px;min-width:100px;max-width:30%;text-align:right;");
			Intd.id = 'dx_sparkbox_' + meta_data[i].id;
			Intr.appendChild(Intd);

			var Intd = document.createElement('td');
			Intd.setAttribute('style', "padding:2px 4px 2px 2px;width:60px;text-align:right;font-size:12px;font-weight:400;");
			Intd.id = 'dx_sparkbox_text_' + meta_data[i].id;
			Intr.appendChild(Intd);

		}

		if (Intb != undefined){

			/* 'FILLER' row */
			var Intr = document.createElement('tr');
			Intb.appendChild(Intr);

			var Intd = document.createElement('td');
			Intd.setAttribute('style', "padding:2px;height:14px;");
			Intd.setAttribute('colspan',3);
			Intr.appendChild(Intd);

		}

		$(((g_Meta_dxObject == 'indicators') ? '#IndCount' : ((g_Meta_dxObject == 'dataElements') ? '#DeCount' : '#OuCount'))).html(meta_data.length);

		document.getElementById(sDestination).innerHTML = dvParent.innerHTML;

		$('.page-2').scroll(function(){

		  var sticky = $('.stickyHeader'),
			  scrollTop = $('.page-2').scrollTop(),
			  offset = $( ".stickyHeader").offset();

		  if (scrollTop > 0){
			if ( sticky.hasClass('fixed') ){
				// do nothing
			} else {
				sticky.css("left",offset.left + 'px');
				sticky.addClass('fixed');
				$( "#meta-data-browse").css('padding-top',$( ".stickyHeader").height());			
			}
		  } else {
			$(".fixed").css("left",0 + 'px');
			sticky.removeClass('fixed');
			$( "#meta-data-browse").css('padding-top',2);
		  }

		});

		refreshDeterminedMetaExploreAnalyticsBlocks();

	}

	function loadmetaExploreCollectionTimelines(thisObj){

		var grp = thisObj.parentElement.parentElement.parentElement.parentElement.parentElement;
		var id = grp.id;
		var dxUID = grp.getAttribute('data-dx');
		var DxGdata = getCurrentInstanceAttribute(g_Meta_dxObjGrp);
		var Sys = getCurrentInstanceAttribute('system');
		var ArrDx = dxUID.split(';');

		for (var i = 0; i < ArrDx.length; i++){
			$('#dx_sparkbox_' + ArrDx[i])[0].innerHTML = '<div style="font-size:11px;color:#DDD;text-align:right;vertical-align:middle;width:16px;height:16px" class="infiniteSpinner">&nbsp;</div>';
		}

		if (dxUID.length > 0){
			dxUID = dxUID.slice(0,-1);
			var myDataURL = (atob(g_sourceDB) + '/api/' + ((getConnectedInstanceAttributeValue('system').version > '2.24') ? '25/' : '') + 'analytics.json?dimension=pe:' +g_pe+';'+ getPeriodTrendItems(g_pe) + ';' + g_peCompare+';'+getPeriodTrendItems(g_peCompare) + '&dimension=dx:' + dxUID + '&filter=ou:' + g_ou + '&displayProperty=NAME&outputIdScheme=UID'+((getConnectedInstanceAttributeValue('system').version > '2.24') ? '&includeNumDen=true' : ''));

			$.ajax({
				url: myDataURL,headers: { "Authorization": 'Basic ' + g_dpk},
				success : function(data){
					createSparklineObjects(data,DxGdata,id,g_Meta_dxObject);
				},
				error: function (xhr, ajaxOptions, thrownError) {
					//setConnectedInstanceAttributeValue('marquee error returning data: ' + xhr.statusText);
					//$('#marqueeContainer')[0].innerHTML = getConnectedInstanceAttributeValue('connectionstatus');
				},
				timeout: 60000 //15sec
			});
			
		} 

	}

	function openZscoreMap(dxUid){

		var Inst = getCurrentInstanceAttribute('organisationUnits');
		var sUrl = 'templates/leaflet_zscore.htm?source=' + getCurrentInstance().uid + '&ou=' + Inst.id + '&dx=' + dxUid + '&pe=' + g_pe + '&oulevel=3&pname=' + Inst.name;

		console.log(sUrl);
		
		/*w2popup.load({ 
			url		  : sUrl, 
			width     : 1000,
			height    : 10000,
			overflow  : 'hidden',
			color     : '#333',
			speed     : '0.3',
			opacity   : '1',
			modal     : false,
			showClose : true,
			showMax   : true
		})*/

		window.open (sUrl);

	}

	function loadmetaExploreItemTimelines(dxId,grpId){

		var DxGdata = getCurrentInstanceAttribute(g_Meta_dxObjGrp);
		var Sys = getCurrentInstanceAttribute('system');

		$('#dx_sparkbox_' + dxId)[0].innerHTML = '<div style="font-size:11px;color:#DDD;text-align:right;vertical-align:middle;width:16px;height:16px" class="infiniteSpinner">&nbsp;</div>';

		var myDataURL = (atob(g_sourceDB) + '/api/' + ((getConnectedInstanceAttributeValue('system').version > '2.24') ? '25/' : '') + 'analytics.json?dimension=pe:' +g_pe+';'+ getPeriodTrendItems(g_pe) + ';' + g_peCompare+';'+getPeriodTrendItems(g_peCompare) + '&dimension=dx:' + dxId + '&filter=ou:' + g_ou + '&displayProperty=NAME&outputIdScheme=UID'+((getConnectedInstanceAttributeValue('system').version > '2.24') ? '&includeNumDen=true' : ''));

		$.ajax({
			url: myDataURL,headers: { "Authorization": 'Basic ' + g_dpk},
			success : function(data){
				createSparklineObjects(data,DxGdata,grpId,g_Meta_dxObject);
			},
			error: function (xhr, ajaxOptions, thrownError) {
				//setConnectedInstanceAttributeValue('marquee error returning data: ' + xhr.statusText);
				//$('#marqueeContainer')[0].innerHTML = getConnectedInstanceAttributeValue('connectionstatus');
			},
			timeout: 60000 //15sec
		});

	}

	function createSparklineObjects(data,dxGrpData,grpFilterId,refObj){
	
		if (dxGrpData.length <= 0){

			// *** no Grouping structures 
			console.log('no Grouping structures');

		} else {

			if (data.rows.length == 0){

				// *** no analytics Data (' + g_pe + ' or ' + g_peCompare + ')'
				
				for (var i = 0; i < data.metaData.dx.length; i++){
					$('#dx_sparkbox_' + data.metaData.dx[i])[0].innerHTML = '<div style="font-size:11px;color:#DDD;text-align:right;vertical-align:middle;">no data</div>';
				}

			} else {
			
				for (var i = 0; i < dxGrpData.length; i++){

					if (grpFilterId.length) {

						if ( (dxGrpData[i].id == grpFilterId) && (dxGrpData[i][refObj].length)) {

							for (var dx = 0; dx < data.metaData.dx.length; dx++){

								for (var p = 0; p < dxGrpData[i][refObj].length; p++){

									if (data.metaData.dx[dx] == dxGrpData[i][refObj][p].id){

										var currData = analyticsHistoryData(dxGrpData[i][refObj][p],(data.rows),g_pe);
										var prevData = analyticsHistoryData(dxGrpData[i][refObj][p],(data.rows),g_peCompare);
										setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.history.data.ou:' + g_ou + '.pe.'+g_peTypeOut+'.'+g_pe,currData);
										setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.history.data.ou:' + g_ou + '.pe.'+g_peTypeOut+'.'+g_peCompare,prevData);
										setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_pe,analyticsHistoryLookup(dxGrpData[i][refObj][p],(data.rows),g_pe));
										setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_peCompare,analyticsHistoryLookup(dxGrpData[i][refObj][p],(data.rows),g_peCompare));
										var InnSparkle = newSparklineDoublePayload(currData,prevData,dxGrpData[i][refObj][p],true);

									}

								}

							}

						}

					} else {
					
						for (var p = 0; p < data.metaData.dx.length; p++){
						
								var jObj = [];
								jObj.push ( {id: data.metaData.dx[p]} );

								var currData = analyticsHistoryData(jObj[0],(data.rows),g_pe);
								var prevData = analyticsHistoryData(jObj[0],(data.rows),g_peCompare);

								//setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,jObj.id,'analytics.history.data.ou:' + g_ou + '.pe.'+g_peTypeOut+'.'+g_pe,currData);
								//setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,jObj.id,'analytics.history.data.ou:' + g_ou + '.pe.'+g_peTypeOut+'.'+g_peCompare,prevData);

								//setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,jObj.id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_pe,analyticsHistoryLookup(jObj,(data.rows),g_pe));
								//setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,jObj.id,'analytics.value.pe.data.ou:' + g_ou + '.pe.'+g_peCompare,analyticsHistoryLookup(jObj,(data.rows),g_peCompare));

								var InnSparkle = newSparklineDoublePayload(currData,prevData,jObj[0],true);
						
						}
					
					
					
/*
						if (dxGrpData[i][refObj].length){

							for (var p = 0; p < dxGrpData[i][refObj].length; p++){

								//var InnHTML = analyticsHistoryHTML(dxGrpData[i][refObj][p],data,g_pe);
								var InnData = analyticsHistoryData(dxGrpData[i][refObj][p],(data.rows),g_pe);
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.history.data.ou:' + g_ou + '.pe.'+g_pe,InnData);
								
								//var InnHTML = analyticsHistoryHTML(dxGrpData[i][refObj][p],data,g_peCompare);
								var InnData = analyticsHistoryData(dxGrpData[i][refObj][p],(data.rows),g_peCompare);
								setConnectedInstanceDxanalyticAttribute(g_Meta_dxObjGrp,dxGrpData[i].id,refObj,dxGrpData[i][refObj][p].id,'analytics.history.data.ou:' + g_ou + '.pe.'+g_peCompare,InnData);

							}

						}
*/
					}

				}

			}

		}

	}

	function newSparklineSinglePayload(dataObj,dxObj){

		var data1 = [], gS = 0;

		for (var i = 0; i < dxObj.attributeValues.length; i++){
			if (dxObj.attributeValues[i].attribute.name == 'GrowthSentiment'){
				gS = dxObj.attributeValues[i].value;
			}
		}

		//min: ((gS < 0) ? '#00ff00' : '#ff0000' )
		//max: ((gS < 0) ? '#ff0000' : '#00ff00' )
	
		for (var r = 0; r < dataObj.length; r++){
			data1.push (dataObj[r].value);
		}
		$('#dx_sparkbox_' + dxObj.id).sparkline(data1, {height: g_sparklineHeight,width: g_sparklineWidth,changeRangeMin: -10, chartRangeMax: 10, minSpotColor: ((gS < 0) ? '#00ff00' : '#ff0000' ), maxSpotColor: ((gS < 0) ? '#ff0000' : '#00ff00' ),lineColor: "green" });
	}

	function newSparklineDoublePayload(currData,prevData,dxObj,bOverlap){

		var data1 = [], data2 = [], gS = 0;
		var sType = 'line';

		Array.prototype.max = function() {
		  return Math.max.apply(null, this);
		};

		Array.prototype.min = function() {
		  return Math.min.apply(null, this);
		};
		
		//alert("Max value is: "+data1.max()+"\nMin value is: "+ data1.min());

		for (var i = 0; i < dxObj.attributeValues.length; i++){
			if (dxObj.attributeValues[i].attribute.name == 'GrowthSentiment'){
				gS = dxObj.attributeValues[i].value;
			}
		}

		if (bOverlap){

			for (var r = 0; r < currData.length; r++){
				data1.push (currData[r].value);
			}
			for (var r = 0; r < prevData.length; r++){
				data2.push (prevData[r].value);
			}

			$('#dx_sparkbox_' + dxObj.id).sparkline(data2, {height: g_sparklineHeight,width: g_sparklineWidth,changeRangeMin: -10, chartRangeMax: 10,lineColor: "#DDD", fillColor: "#f5f5f5", minSpotColor: '', maxSpotColor: '', spotColor: '', type: sType });
			$('#dx_sparkbox_' + dxObj.id).sparkline(data1, {changeRangeMin: -10, chartRangeMax: 10,lineColor: "rgb(140,180,190)", minSpotColor: ((gS < 0) ? '#00ff00' : '#ff0000' ) , maxSpotColor: ((gS < 0) ? '#ff0000' : '#00ff00' ), composite: true, fillColor: '', spotColor: '', type: sType });
		
		} else {
			for (var r = 0; r < prevData.length; r++){
				data1.push (prevData[r].value);
			}
			for (var r = 0; r < currData.length; r++){
				data1.push (currData[r].value);
			}

			$('#dx_sparkbox_' + dxObj.id).sparkline(data1, {height: 30,width: 200,changeRangeMin: -10, chartRangeMax: 10,lineColor: "rgb(140,180,190)", fillColor: '#f5f5f5', minSpotColor: '#ff0000', maxSpotColor: '#00ff00', composite: false, spotColor: '', type: sType });
		
		}

		paintanalyticsComparisonStrings(g_Meta_dxObject,"dx_sparkbox_text_","analytics.value.pe.data.ou:" + g_ou + ".pe."+g_pe);

	}

	function refreshDeterminedMetaExploreAnalyticsBlocks(){

		setTimeout(function () {
			paintanalyticsComparisonStrings(g_Meta_dxObject,"dx_sparkbox_","analytics.compare.pe.data.ou:"+g_ou+".pe."+g_pe+":"+g_peCompare);
		}, 500);

	}

	function ToggleFavouriteDxItem(thisObj,id,sName){

		var bAdd = (thisObj.innerHTML=="star_border");

		thisObj.innerHTML = ( (bAdd) ? "star" : "star_border" );

		if (bAdd){
			thisObj.style.opacity = 0.85;
			addFavourite(thisObj,g_Meta_dxObject,id,sName);
		} else {
			thisObj.style.opacity = 0.25;
			removeFavourite(thisObj,g_Meta_dxObject,id);
		}

	}

	function ToggleFavouriteGroup(thisObj,id,sName){

		var bAdd = (thisObj.innerHTML=="star_border");
		var grp = thisObj.parentElement.parentElement.parentElement.parentElement.parentElement;

		thisObj.innerHTML = ( (bAdd) ? "star" : "star_border" );

		if (bAdd){
			//$(thisObj).removeClass('star');
			addFavourite(thisObj,g_Meta_dxObjGrp,id,sName);
		} else {
			//$(thisObj).removeClass('favourite');
			removeFavourite(thisObj,g_Meta_dxObjGrp,id);
		}

		if ( (bAdd) && (1 == 0) ){
			var grp = thisObj.parentElement.parentElement.parentElement.parentElement.parentElement;
			var dv = document.createElement('div');
			dv.setAttribute('style', 'width:100%;border:1px solid #fff;background-Color:#f5f5f5;border-radius:2px;');
			dv.id = 'sb_' + g_Meta_dxObject + '_' + grp.id;
			var tbl = document.createElement('table')
			tbl.setAttribute('style', 'width:95%;height:20px;');
			dv.appendChild(tbl);
			var tr = document.createElement('tr');
			tbl.appendChild(tr);

			var td = document.createElement('td');
			td.setAttribute('style', 'text-align:left;color:' + sInnerCol);
			tr.appendChild(td);

			var imgMI = document.createElement('i');
			imgMI.setAttribute('class', 'material-icons material-small');
			imgMI.innerHTML = sInnerIcon;
			td.appendChild(imgMI);

			var td = document.createElement('td');
			td.setAttribute('style', 'width:174px;color:#000;overflow: hidden;text-overflow:ellipsis;font-size:12px;');
			tr.appendChild(td);
			td.innerHTML = grp.getAttribute('data-name');

			var td = document.createElement('td');
			td.setAttribute('style', 'text-align:right;');
			tr.appendChild(td);

			var imgMI = document.createElement('i');
			imgMI.setAttribute('class', 'material-icons');
			imgMI.setAttribute('style', 'color:#85655D;cursor:pointer;cursor:hand;');
			imgMI.setAttribute('onclick', 'deleteElement("sb_' + g_Meta_dxObject + '_' + grp.id + '");');
			imgMI.innerHTML = 'close';
			td.appendChild(imgMI);

			$('#dxSandbox').append(dv);
		}

	}

	function ToggleHideDxGroup(thisObj,id){

		//var bClosed = (thisObj.innerHTML=="keyboard_arrow_up");
		var bClosed = ((thisObj.innerHTML == 'keyboard_arrow_up') ? true : false);

		if (bClosed){
			$('#dxcontainer-' + id).css("display","none");
			setConnectedInstanceDxgroupAttribute(g_Meta_dxObjGrp,id,'explorer.hide',true);
			//$(thisObj).removeClass('star');
			//addFavourite(thisObj,g_Meta_dxObjGrp,id);
		} else {
			$('#dxcontainer-' + id).css("display","block");
			setConnectedInstanceDxgroupAttribute(g_Meta_dxObjGrp,id,'explorer.hide',false);
			//$(thisObj).removeClass('favourite');
			//removeFavourite(thisObj,g_Meta_dxObjGrp,id);
		}

		thisObj.innerHTML = ( (bClosed) ? "keyboard_arrow_down" : "keyboard_arrow_up" );

	}

	function ToggleHideGroup(thisObj,id){

		//var bClosed = (thisObj.innerHTML=="keyboard_arrow_up");
		var bClosed = (($('#explorerExpandCollapseInner').html() == 'keyboard_arrow_up') ? true : false);

		//g_Meta_dxObjGrp = var ObjType = ((g_Meta_dxObject == 'indicators') ? 'indicatorGroups' : ((g_Meta_dxObject == 'dataElements') ? 'dataElementGroups' : 'organisationUnitGroups'));
		thisObj.innerHTML = ( (bClosed) ? "keyboard_arrow_down" : "keyboard_arrow_up" );

		if (bClosed){
			$('#dxcontainer-' + id).css("display","none");
			setConnectedInstanceDxgroupAttribute(g_Meta_dxObjGrp,id,'explorer.hide',true);
			//$(thisObj).removeClass('star');
			//addFavourite(thisObj,g_Meta_dxObjGrp,id);
		} else {
			$('#dxcontainer-' + id).css("display","block");
			setConnectedInstanceDxgroupAttribute(g_Meta_dxObjGrp,id,'explorer.hide',false);
			//$(thisObj).removeClass('favourite');
			//removeFavourite(thisObj,g_Meta_dxObjGrp,id);
		}

	}

	function deleteElement(id){
		var myEl = document.getElementById(id); 
		myEl.parentElement.removeChild(myEl);
	}

	function cycleObjClass(thisObj){

		var Arritem = ['filter-object-indicators','filter-object-dataElements']; //,'filter-object-organisationUnits'];

		thisObj.className = 'object-filter-selected'; //((thisObj.className == 'object-filter') ? 'object-filter-selected' : 'object-filter');
		
		for (var i = 0; i < Arritem.length; i++) {
			if (Arritem[i] != thisObj.id){
				document.getElementById(Arritem[i]).className = 'object-filter'
			}
		}

		//document.getElementById(((thisObj.id == 'filter-object-indicators') ? 'filter-object-dataElements' : 'filter-object-indicators')).className = 'object-filter'; //((thisObj.className == 'object-filter') ? 'object-filter-selected' : 'object-filter');
	}

	function cycleMetaExploreGrpClass(thisObj){
		thisObj.className = ((thisObj.className == 'group-filter') ? 'group-filter-selected' : 'group-filter');
		document.getElementById(((thisObj.id == 'metaFilter-group-localGroups') ? 'metaFilter-group-dataSets' : 'metaFilter-group-localGroups')).className = ((thisObj.className == 'group-filter') ? 'group-filter-selected' : 'group-filter');
	}

	function cycleInstrGrpClass(thisObj){
		thisObj.className = ((thisObj.className == 'group-filter') ? 'group-filter-selected' : 'group-filter');
		document.getElementById(((thisObj.id == 'instrFilter-group-All') ? 'instrFilter-group-Favourites' : 'instrFilter-group-All')).className = ((thisObj.className == 'group-filter') ? 'group-filter-selected' : 'group-filter');
	}

		function ZoomDxDD(thisId){

			if (g_Meta_dxObject == 'indicators'){
				var sInnerUrl = (atob(g_sourceDB) + '/api/indicators/' + thisId + '.json?fields=id,name,shortName,description,numerator,numeratorDescription,denominator,denominatorDescription,attributeValues[value,attribute[name]],displayDescription,indicatorType[name],indicatorGroups[name],lastUpdated,created');
			} else {
				var sInnerUrl = (atob(g_sourceDB) + '/api/dataElements/' + thisId + '.json?fields=id,name,shortName,domainType,type,attributeValues[value,attribute[name]],dataElementGroups[name],lastUpdated,created');
			}

			var sHeaders = { "Authorization": 'Basic ' + g_dpk};
			var bCrossD = true; //crossDomain: bCrossD,

			var sInnerJ = $.ajax({
				url:sInnerUrl, 
				headers: sHeaders, 
				async: false,
				success: function(innerdata) {

					function LookupAttributeValue(jsonAttributeValues,attrName){

						var ReturnVal = '';

						for (var i = 0; i < jsonAttributeValues.length; i++) {
							if (jsonAttributeValues[i].attribute.name == attrName){
								if ((jsonAttributeValues[i].value).toString().indexOf(';') < 0){
									ReturnVal = (jsonAttributeValues[i].value).toString();
								} else {
									var AttrVal = (jsonAttributeValues[i].value).toString().split(';');
									var ReturnVal = [];
									for (var p = 0; p < AttrVal.length; p++) {
										ReturnVal.push ( (AttrVal[p]).replace(/"/g,'') );
									}
								}
							}	
						}
						return ReturnVal;
					}

					function PresentDxDefinitionPopup(varJSON){

						var myContainer = document.createElement('div');
						var tbl = document.createElement('table');
						var bgCol = '';

						tbl.setAttribute('style', 'background-Color:#ffffff;border:1px solid #E3E3E3;width:100%;border-collapse:separate;');
						tbl.classList.add("rounded");
						myContainer.appendChild(tbl);

							var tr = document.createElement('tr');
							tbl.appendChild(tr);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:center;font-weight:400;font-size:16px;background-Color:#1f7995;color:#fff;letter-spacing: 1px;padding:2px;border-bottom:1px solid #E3E3E3;border-left:#1px solid 1f7995;border-right:#1px solid 1f7995;');
							td.setAttribute('colspan', 2);
							tr.appendChild(td);

							var txt = document.createTextNode(getConnectedInstanceAttributeValue('name'));
							td.appendChild(txt);

							var tr = document.createElement('tr');
							tbl.appendChild(tr);


							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#ffffff;font-family:Roboto,Arial;font-size:9pt;width:200px;');
							tr.appendChild(td);

							var txt = document.createTextNode(' UID ');
							td.appendChild(txt);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:6px;background-Color:#ffffff;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
							tr.appendChild(td);

							var txt = document.createTextNode(varJSON.id);
							td.appendChild(txt);


							var tr = document.createElement('tr');
							tbl.appendChild(tr);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:800;padding:6px 10px;background-Color:#f5f5f5;font-family:Roboto,Arial;font-size:12pt');
							tr.appendChild(td);

							var txt = document.createTextNode('Name ');
							td.appendChild(txt);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:800;padding:6px;background-Color:#f5f5f5;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:12pt;');
							tr.appendChild(td);

							var txt = document.createTextNode(varJSON.name);
							td.appendChild(txt);


							var tr = document.createElement('tr');
							tbl.appendChild(tr);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#ffffff;font-family:Roboto,Arial;font-size:9pt');
							tr.appendChild(td);

							var txt = document.createTextNode(' Short Name ');
							td.appendChild(txt);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#ffffff;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
							tr.appendChild(td);

							var txt = document.createTextNode(varJSON.shortName);
							td.appendChild(txt);
							
							if (g_Meta_dxObject == 'indicators'){

								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#f5f5f5;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(' Numerator ');
								td.appendChild(txt);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#f5f5f5;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(((varJSON.numeratorDescription != undefined) ? varJSON.numeratorDescription : ''));
								td.appendChild(txt);


								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#ffffff;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(' Denominator ');
								td.appendChild(txt);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#ffffff;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(((varJSON.denominatorDescription != undefined) ? varJSON.denominatorDescription : ''));
								td.appendChild(txt);


								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#f5f5f5;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(' Type ');
								td.appendChild(txt);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#f5f5f5;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(((varJSON.indicatorType.name != undefined) ? varJSON.indicatorType.name : ''));
								td.appendChild(txt);

								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#ffffff;font-family:Roboto,Arial;font-size:9pt;');
								tr.appendChild(td);

								var txt = document.createTextNode(' Definition ');
								td.appendChild(txt);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:8px 4px 8px 4px;background-Color:#ffffff;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt;');
								tr.appendChild(td);

								var txt = document.createTextNode(((varJSON.description != undefined) ? varJSON.description : ''));
								td.appendChild(txt);

								
							} else {

								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#f5f5f5;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(' Type ');
								td.appendChild(txt);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#f5f5f5;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(((varJSON.type != undefined) ? varJSON.type : ''));
								td.appendChild(txt);

							}

							if (g_Meta_dxObject == 'indicators'){

								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#f5f5f5;font-family:Roboto,Arial;font-size:9pt;');
								tr.appendChild(td);

								var txt = document.createTextNode(' Annualized ');
								td.appendChild(txt);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#f5f5f5;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt;');
								tr.appendChild(td);

								var txt = document.createTextNode(((varJSON.annualized) ? 'Yes' : 'No'));
								td.appendChild(txt);


								if (varJSON.indicatorGroups.length){

									var tr = document.createElement('tr');
									tbl.appendChild(tr);

									var td = document.createElement('td');
									td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#ffffff;font-family:Roboto,Arial;font-size:9pt');
									tr.appendChild(td);

									var txt = document.createTextNode(' Indicator Group ');
									td.appendChild(txt);

									var td = document.createElement('td');
									td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#ffffff;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
									tr.appendChild(td);

									var txt = document.createTextNode(varJSON.indicatorGroups[0].name);
									td.appendChild(txt);

								}

							} else {

								if (varJSON.dataElementGroups.length){


									var tr = document.createElement('tr');
									tbl.appendChild(tr);

									var td = document.createElement('td');
									td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#ffffff;font-family:Roboto,Arial;font-size:9pt');
									tr.appendChild(td);

									var txt = document.createTextNode(' Element Group ');
									td.appendChild(txt);

									var td = document.createElement('td');
									td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#ffffff;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt');
									tr.appendChild(td);

									var txt = document.createTextNode(varJSON.dataElementGroups[0].name);
									td.appendChild(txt);

								}

							}
/*
							if (varJSON.attributeValues.length){

								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:3px 10px;background-Color:#F9F9F9;font-family:Roboto,Arial;font-size:9pt');
								td.setAttribute('colspan', 2);
								tr.appendChild(td);

								var txt = document.createTextNode(' attributes ');
								td.appendChild(txt);

							}
*/
							for (var z = 0; z <  varJSON.attributeValues.length; z++) {
							
								var tr = document.createElement('tr');
								tbl.appendChild(tr);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:right;font-weight:400;padding:3px 10px;background-Color:#F9F9F9;font-family:Roboto,Arial;font-size:9pt');
								tr.appendChild(td);

								var txt = document.createTextNode(' ' + varJSON.attributeValues[z].attribute.name + ' ');
								td.appendChild(txt);

								var td = document.createElement('td');
								td.setAttribute('style', 'text-align:left;font-weight:400;padding:4px;background-Color:#F9F9F9;border-left:1px solid #DBDBDB;font-family:Roboto,Arial;font-size:9pt;overflow:hidden;text-overflow:ellipsis;');
								tr.appendChild(td);

								var txt = document.createTextNode(((varJSON.attributeValues[z].value != undefined) ? varJSON.attributeValues[z].value : ''));
								td.appendChild(txt);

							}


							var myDiv = document.createElement('div');
							myDiv.setAttribute('style', 'padding:20px 0 0 0;');
							myContainer.appendChild(myDiv);

							var tbl = document.createElement('table');
							myDiv.appendChild(tbl);

							var tr = document.createElement('tr');
							tbl.appendChild(tr);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:800;padding:3px 10px;background-Color:#ffffff;border:1px solid #ffffff;font-family:Roboto,Arial;font-size:10pt;width:200px;');
							tr.appendChild(td);

							var txt = document.createTextNode(' Meta Data Summary ');
							td.appendChild(txt);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:800;padding:3px 10px;background-Color:#ffffff;border:1px solid #ffffff;font-family:Roboto,Arial;font-size:10pt;');
							tr.appendChild(td);

							var tr = document.createElement('tr');
							tbl.appendChild(tr);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:6px 0 0 10px;background-Color:#ffffff;border:1px solid #ffffff;font-family:Roboto,Arial;font-size:9pt;color:#416271;');
							tr.appendChild(td);

							var dtmUpdate = new Date(varJSON.created);
							var txt = document.createTextNode(' Date Created: ' + dtmUpdate.getFullYear() + '/' + (((dtmUpdate.getMonth()+1) < 10) ? ('0' + (dtmUpdate.getMonth()+1)) : (dtmUpdate.getMonth()+1)) + '/' + (((dtmUpdate.getDate()) < 10) ? ('0' + (dtmUpdate.getDate())) : (dtmUpdate.getDate())) );
							td.appendChild(txt);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:6px 0 0 10px;background-Color:#ffffff;border:1px solid #ffffff;font-family:Roboto,Arial;font-size:9pt;color:#416271;');
							tr.appendChild(td);

							var dtmUpdate = new Date(varJSON.lastUpdated);
							var txt = document.createTextNode(' Last Edit: ' + dtmUpdate.getFullYear() + '/' + (((dtmUpdate.getMonth()+1) < 10) ? ('0' + (dtmUpdate.getMonth()+1)) : (dtmUpdate.getMonth()+1)) + '/' + (((dtmUpdate.getDate()) < 10) ? ('0' + (dtmUpdate.getDate())) : (dtmUpdate.getDate())) );
							td.appendChild(txt);


							var tr = document.createElement('tr');
							tbl.appendChild(tr);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:6px 0 0 10px;background-Color:#ffffff;border:1px solid #ffffff;font-family:Roboto,Arial;font-size:9pt;color:#416271;');
							//td.setAttribute('colspan',2)
							tr.appendChild(td);

							var dtmUpdate = new Date();
							var txt = document.createTextNode(' Retrieved: ' + dtmUpdate.getFullYear() + '/' + (((dtmUpdate.getMonth()+1) < 10) ? ('0' + (dtmUpdate.getMonth()+1)) : (dtmUpdate.getMonth()+1)) + '/' + (((dtmUpdate.getDate()) < 10) ? ('0' + (dtmUpdate.getDate())) : (dtmUpdate.getDate())) );
							td.appendChild(txt);

							var td = document.createElement('td');
							td.setAttribute('style', 'text-align:left;font-weight:400;padding:6px 0 0 10px;background-Color:#ffffff;border:1px solid #ffffff;font-family:Roboto,Arial;font-size:9pt;color:#416271;');
							//td.setAttribute('colspan',2)
							tr.appendChild(td);

							var txt = document.createTextNode(' Source: ' + getConnectedInstanceAttributeValue('address'));
							td.appendChild(txt);

						return myContainer.innerHTML;

					}

					w2popup.open({
						title     : '<div class="Group" style="border-bottom:0;border-right:0;background-Color:transparent;">Data Definition</div>',
						body      : '<div style="padding:25px;">' + PresentDxDefinitionPopup(innerdata) + '</div>',
						buttons   : '<button class="btn" onclick="w2popup.close();">Close </button>',
						width     : 800, //window.innerWidth,
						height    : 600, //window.innerHeight,
						overflow  : 'hidden',
						color     : '#333',
						speed     : '0.3',
						opacity   : '0.5',
						modal     : true,
						showClose : true,
						showMax   : false,
						onOpen    : function (event) { console.log('open'); },
						onClose   : function (event) { console.log('close'); },
						onMax     : function (event) { console.log('max'); },
						onMin     : function (event) { console.log('min'); },
						onKeydown : function (event) { console.log('keydown'); }
					});

				}
			}).responseText;

		}

	function initialiseInstanceLayout(){

		if ( ($('.page-1')[0].childNodes[0].innerHTML).toString().trim().length == 0 ){

			var Inst = myAppData[0].instances;

			var dvParent = document.createElement('div');
			var cnt = document.createElement('center');
			dvParent.appendChild(cnt);

			var dvInstanceContainer = document.createElement('div');
			dvInstanceContainer.setAttribute('style', 'min-width:800px;max-width:1200px;text-align:center;padding:25px 0px 25px 0px;margin:0;');
			cnt.appendChild(dvInstanceContainer);

			var dv = document.createElement('dv');
			dv.setAttribute('style', 'width:100%;text-align:left;padding:25px;');
			dvInstanceContainer.appendChild(dv);

				var lbl = document.createElement('label');
				lbl.setAttribute('style', 'opacity:0.9;font-weight:400;font-size:13px;vertical-align:middle;color:#000000;width:inherit;');
				dv.appendChild(lbl);

				var txt = document.createTextNode('The following servers are available:');
				lbl.appendChild(txt);


			var dv = document.createElement('dv');
			dv.setAttribute('style', 'margin:0 10px 0 10px;');
			dvInstanceContainer.appendChild(dv);

			var tbl = document.createElement('table');
			tbl.setAttribute('style', 'width:100%;border-radius:4px;background-Color:#fff;');
			dv.appendChild(tbl);

			var tr = document.createElement('tr');
			tr.setAttribute('style', 'height:50px;');
			tbl.appendChild(tr);

			var td = document.createElement('td');
			td.setAttribute('style', 'padding:4px;width:31px;border-left:1px solid #fff;border-top:1px solid #fff;background-Color:#fff;');
			tr.appendChild(td);
/*
				var MIkey = document.createElement('i');
				MIkey.setAttribute('class', "material-icons material-medium instance-refresh");
				MIkey.setAttribute('style', 'position:relative;font-size:24px;');
				MIkey.setAttribute('onclick', "javascript:pingInstances(true)");
				MIkey.innerHTML = 'refresh';
				td.appendChild(MIkey);
*/
			var td = document.createElement('td');
			td.setAttribute('style', 'padding:8px 8px 8px 4px;width:380px;border-radius:4px 0 0 0;border-left:1px solid #E9E9E9;border-top:1px solid #E9E9E9;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;');
			tr.appendChild(td);
			
			var txt = document.createTextNode(' ');
			td.appendChild(txt);

			/*var btn = document.createElement('a');
			btn.setAttribute('href', "javascript:pingInstances()");
			btn.setAttribute('class', "enterprise-server-button");
			//MIkey.innerHTML = 'Ping Servers';
			td.appendChild(btn);*/

				var tblIn = document.createElement('table');
				tblIn.setAttribute('style', 'width:100%');
				td.appendChild(tblIn);

				var trIn = document.createElement('tr');
				tblIn.appendChild(trIn);

				var tdIn = document.createElement('td');
				tdIn.setAttribute('style', 'font-weight:400;font-size:16px;color:#1f7995;letter-spacing: 1px;padding: 0 0 0 6px;text-align:left;');
				trIn.appendChild(tdIn);

				var txt = document.createTextNode('Server');
				tdIn.appendChild(txt);

			var td = document.createElement('td');
			td.setAttribute('style', 'width:100px;text-align:left;font-size:12px;color:#1f7995;border-top:1px solid #E9E9E9;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;');
			td.setAttribute('colspan', 1);
			tr.appendChild(td);
			var txt = document.createTextNode('framework');
			td.appendChild(txt);

			var td = document.createElement('td');
			td.setAttribute('style', 'width:50px;text-align:center;font-size:12px;width:40px;color:#1f7995;border-top:1px solid #E9E9E9;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;');
			td.setAttribute('colspan', 1);
			tr.appendChild(td);
			var txt = document.createTextNode('account');
			td.appendChild(txt);

			var td = document.createElement('td');
			td.setAttribute('style', 'border-radius:0 4px 0 0;max-width:50%;font-weight:400;padding:4px 10px 4px 4px;font-size:12px;color:#1f7995;border-top:1px solid #E9E9E9;border-right:1px solid #E9E9E9;border-bottom:1px solid #edf2f6;background-Color:#f7f7f7;text-align:center;');
			td.setAttribute('colspan', 1);
			tr.appendChild(td);

				var MIkey = document.createElement('i');
				MIkey.setAttribute('class', "material-icons material-medium instance-refresh");
				MIkey.setAttribute('style', 'position:relative;font-size:24px;');
				MIkey.setAttribute('onclick', "javascript:pingInstances(true)");
				MIkey.innerHTML = 'refresh';
				td.appendChild(MIkey);

			/*var txt = document.createTextNode('status');
			td.appendChild(txt);*/

			Inst.forEach(function(element) {

				var tr = document.createElement('tr');
				tr.setAttribute('class', 'instance-tr');
				tr.setAttribute('id', 'instance-tr-' + element.instanceid);
				tbl.appendChild(tr);

				var td = document.createElement('td');
				td.setAttribute('style', 'width:400px;overflow:hidden;border-left:1px solid #fff;border-top:1px solid #fff;');
				//td.setAttribute('class', 'instance-td');
				td.setAttribute('colspan', 2);
				tr.appendChild(td);


					var tblIn = document.createElement('table');
					tblIn.setAttribute('style', "width:100%;");
					td.appendChild(tblIn);

					var trIn = document.createElement('tr');
					tblIn.appendChild(trIn);

					var tdIn = document.createElement('td');
					tdIn.setAttribute('id', 'instance_icon_holder' + element.instanceid);
					tdIn.setAttribute('style', 'padding:4px;width:32px;text-align:center;background-Color:#fff');
					tdIn.setAttribute('onmouseover', "evalInstanceMousover(" + element.instanceid + ");");
					tdIn.setAttribute('onmouseout', "evalInstanceMousout(" + element.instanceid + ");");
					tdIn.setAttribute('onclick', "evalInstanceEvent(" + element.instanceid + ");");
					trIn.appendChild(tdIn);

					var chkIc = document.createElement('i');
					chkIc.setAttribute('id', 'instance_icon_' + element.instanceid);
					chkIc.setAttribute('class', "material-icons material-instance-disabled");
					chkIc.innerHTML = 'remove';
					tdIn.appendChild(chkIc);

					var tdIn = document.createElement('td');
					tdIn.setAttribute('style', 'padding:4px;width:135px;border-left:1px solid #E9E9E9;');
					tdIn.setAttribute('class', 'instance-td');
					trIn.appendChild(tdIn);

					var tdC = document.createElement('div');
					tdC.setAttribute('id', 'instance_name_' + element.instanceid);
					tdC.setAttribute('style', 'text-align:left;font-weight:400;font-size:13px;vertical-align:middle;color:#000000;width:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;');
					tdC.setAttribute('class', 'material-instance-disabled');
					tdIn.appendChild(tdC);

					var txt = document.createTextNode((element.name).toString().trim());
					tdC.appendChild(txt);

					var tdIn = document.createElement('td');
					tdIn.setAttribute('style', 'padding:4px;width:242;');
					tdIn.setAttribute('class', 'instance-td');
					trIn.appendChild(tdIn);

					var tdC = document.createElement('div');
					tdC.setAttribute('style', 'text-align:left;cursor:default;padding:2px;font-weight:400;font-size:13px;vertical-align:middle;color:#669999;width:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0.85');
					tdC.setAttribute('id', 'instance_address_' + element.instanceid);
					tdC.setAttribute('title', element.address);

					tdIn.appendChild(tdC);

					var txt = document.createTextNode(element.address);
					tdC.appendChild(txt);


				var td = document.createElement('td');
				td.setAttribute('style', 'border-top:1px solid #edf2f6;');
				td.setAttribute('class', 'instance-td');
				tr.appendChild(td);

				var tdC = document.createElement('div');
				tdC.setAttribute('style', 'font-weight:400;font-size:12px;vertical-align:middle;color:#525252;width:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0.65;text-align:left;');
				tdC.setAttribute('id', 'instance_type_' + element.instanceid);
				tdC.innerHTML = (element.instancetype.name + ((element.system != undefined) ?  ((element.system.version != undefined) ? ' ' + element.system.version + '': '') : ''));
				td.appendChild(tdC);

				var td = document.createElement('td');
				td.setAttribute('style', 'padding:4px;width:40px;border-left:1px solid #edf2f6;border-right:1px solid #edf2f6;background-Color:#f7f7f7;');
				td.setAttribute('class', 'instance-td');
				tr.appendChild(td);

					var tblIn = document.createElement('table');
					tblIn.setAttribute('style', "width:100%;");
					td.appendChild(tblIn);
					var trIn = document.createElement('tr');
					tblIn.appendChild(trIn);
					var tdIn = document.createElement('td');
					tdIn.setAttribute('style', 'width:20px;');
					trIn.appendChild(tdIn);

					var tdC = document.createElement('div');
					tdC.setAttribute('style', 'font-weight:400;vertical-align:middle;width:inherit;white-space:nowrap;overflow:hidden;opacity:0.75');
					tdIn.appendChild(tdC);

					var MIkey = document.createElement('i');
					MIkey.setAttribute('class', "material-icons material-secured-list");
					MIkey.setAttribute('id', 'instance-secure-token-' + element.instanceid);
					MIkey.innerHTML = 'security' //linked
					tdC.appendChild(MIkey);

					if (element.token) {
						MIkey.setAttribute('style','display:block');
					} else {
						MIkey.setAttribute('style','display:none');
					}

					var tdIn = document.createElement('td');
					tdIn.setAttribute('style', 'width:22px;padding:0 5px 0 5px');
					trIn.appendChild(tdIn);

					var MIkey = document.createElement('i');
					MIkey.setAttribute('class', "material-icons material-small material-inst-item");
					MIkey.setAttribute('id', 'instance-secure-edit-' + element.instanceid);
					MIkey.innerHTML = 'edit';
					MIkey.setAttribute('onclick', 'manageinstanceKey(' + element.instanceid + ',0)');
					tdIn.appendChild(MIkey);


				var td = document.createElement('td');
				td.setAttribute('style', 'font-weight:400;padding:4px 4px 4px 6px;font-size:12px;color:#525252;opacity:0.65;text-align:left;border-right:1px solid #E9E9E9;');
				td.setAttribute('id', 'instance_status_' + element.instanceid);
				td.setAttribute('class', 'instance-td');
				tr.appendChild(td);

				var MIkey = document.createElement('label');
				td.appendChild(MIkey);
				var txt = document.createTextNode((element.connectionstatus).toString().trim()); //.replace('success','check')
				MIkey.appendChild(txt);
			});

			var tr = document.createElement('tr');
			tr.setAttribute('style', 'height:50px;');
			tbl.appendChild(tr);

			var td = document.createElement('td');
			tr.appendChild(td);

			var td = document.createElement('td');
			td.setAttribute('style', 'border-radius:0 0 6px 6px;font-weight:400;padding:10px 10px 10px 8px;font-size:16px;color:#1f7995;letter-spacing: 1px;width:400px;border-left:1px solid #E9E9E9;border-bottom:1px solid #E9E9E9;border-right:1px solid #E9E9E9;');
			td.setAttribute('colspan', 4);
			tr.appendChild(td);


			$('.page-1')[0].childNodes[0].innerHTML = dvParent.innerHTML;

			refreshInstanceList();

			g_bInstancesLoaded = true;

		}

	}
	
	function shuffleLiveInstances(){

		var Inst = myAppData[0].instances;

		Inst.forEach(function(ins) {
			if ( (ins.active < 1) || (ins.pingstatuscode <= 0) ){
				shuffleInstanceTillBottom(ins.instanceid);
			}
		});

	}
	
	function shuffleInstanceTillBottom(id){
		
		var row = $('#instance-tr-' + id)[0];
		var nextRow = get_nextsibling ( get_nextsibling( row ));
	
		while ( nextRow != null ) {
			MoveInstanceRowDown(id);
			var nextRow = get_nextsibling ( get_nextsibling( row ));
		}
	
	}

	function MoveInstanceRowUp(id) {

		var table, row = $('#instance-tr-' + id)[0];

		// find the parent tr ( the row element )
		while ( row != null ) {
			if ( row.nodeName == 'TR' ) {
				break;
			}
			row = row.parentNode;
		}
		// the parent of the row is the table body
		table = row.parentNode;
		// insert the row before it's previevs siblings
		table.insertBefore ( row, get_previoussibling( row ) );
	}

	function MoveInstanceRowDown(id) {
		var table, row = $('#instance-tr-' + id)[0];

		while ( row != null ) {
			if ( row.nodeName == 'TR' ) {
				break;
			}
			row = row.parentNode;
		}
		table = row.parentNode;
		// you have to find the second next siblings to append before
		// NOTE: if the second parameter of the 'insertBefore' function is null
		//       it will append the row to the table! 
		table.insertBefore ( row, get_nextsibling ( get_nextsibling( row ) ) );
	}

	function get_previoussibling(n) {
		var x = n.previousSibling;
		while (x.nodeType != 1) {
			x = x.previousSibling;
		}
		return x;
	}
	function get_nextsibling(n) {
		var x = n.nextSibling;
		if (x != null){
		while (x.nodeType != 1) {
			x = x.nextSibling;
		}
		}
		return x;
	}

	function evalInstanceMousover(id){

		var pStatusCode = getInstanceAttribute('pingstatuscode',id);

		switch (pStatusCode) {
			case -2:
				//do something: timeout
				$('#instance_icon_' + id).css("opacity",0.25);
				break;
			case -1:
				//do something: offline
				$('#instance_icon_' + id).css("opacity",0.25);
				break;
			case 0:
				//do something: connecting
				$('#instance_icon_' + id).css("opacity",0.5);
				break;
			case 1:
				//do something: online
				$('#instance_icon_' + id).css("opacity",0.85);
				break;
			default:
				break;
		}

	}

	function evalInstanceMousout(id){

		var pStatusCode = getInstanceAttribute('pingstatuscode',id);

		switch (pStatusCode) {
			case -2:
				//do something: timeout
				$('#instance_icon_' + id).css("opacity",0.25);
				break;
			case -1:
				//do something: offline
				$('#instance_icon_' + id).css("opacity",0.25);
				break;
			case 0:
				//do something: connecting
				$('#instance_icon_' + id).css("opacity",0.5);
				break;
			case 1:
				//do something: online
				$('#instance_icon_' + id).css("opacity",1);
				break;
			default:
				break;
		}
	}

	function evalInstanceEvent(id){
		var element = getInstance(id);
		if (element.connected == 1){
			// do nothing
		} else {
			switch (element.pingstatuscode) {
				case -2:
					//do something: timeout
					break;
				case -1:
					//do something: offline
					break;
				case 0:
					//do something: connecting
					break;
				case 1:
					//do something: online
					if ( (element.token == undefined) && (element.instanceaccess.length == 0) ) {
						//w2alert ('You must link your account to be able to access this server instance ');
						manageinstanceKey(id,1);
					} else {
						InitialiseInstance($('#instance_icon_holder' + id)[0].childNodes[0], id);
					}
					break;
				default:
					break;
			}
		}
	}

	function pingInstances(screenRefresh){

		var Inst = myAppData[0].instances;

		Inst.forEach(function(element) {
			if (element.active != 0){
				if (screenRefresh) $('#instance_status_' + element.instanceid)[0].innerHTML = '<table><tr><td>...</td></tr></table>'; //
				new ping(element, function (status, e) {
					//console.log(status);
				});
			}
		});

		if (screenRefresh) setTimeout(function () { refreshInstanceList() }, 1500 );

	}
	
	function setPingCycle(){

		if (g_pingOn){
			if (g_pingTime > 0){
				g_pingTobj = setInterval(function () { pingInstances(g_bInstancesLoaded) }, g_pingTime);
			}
		}
	}

	function ping(obj,callback) {

		if (!this.inUse) {
			this.start = new Date().getTime();
			this.inUse = true;
			this.id = obj.instanceid;
			this.ip = obj.address;
			this.pingstatus = 'connecting';
			obj.pingstatuscode = 0;
			this.callback = callback;
			var _that = this;
			var _img = this.img = new Image();
			_img.onload = function () {
				_that.inUse = false;
				if (obj.connected > 0){
					obj.pingicon = 'play_circle_filled';
					obj.pingstatus = 'connected';
				} else {
					obj.pingicon = 'play_circle_outline';
					obj.pingstatus = '';
				}
				obj.pingstatuscode = 1;
			};
			_img.onerror = function (e) {
				if (_that.inUse) {
					_that.inUse = false;
					obj.pingicon = 'not_interested';
					obj.pingstatus = 'offline';
					obj.pingstatuscode = -1;
				}
			};
			_img.src = (obj.address + "/dhis-web-commons/security/logo_front.png");
			this.timer = setTimeout(function () {
				if (_that.inUse) {
					_that.inUse = false;
					obj.pingicon = 'highlight_off';
					obj.pingstatus = 'timeout';
					obj.pingstatuscode = -2;
				}
			}, 1500);
		}

	}
	
	function refreshInstanceList(){

		var Inst = myAppData[0].instances;

		Inst.forEach(function(element) {

			$('#instance_icon_' + element.instanceid).removeClass(); //should clear all without an explicit value
			$('#instance_icon_' + element.instanceid).addClass('material-icons');
			$('#instance_icon_' + element.instanceid).addClass('material-instance-disabled');
			$('#instance_icon_' + element.instanceid).addClass('material-instance');
			$('#instance_icon_' + element.instanceid)[0].innerHTML = 'remove';

			if (element.active > 0){

				$('#instance_name_' + element.instanceid).css("opacity",1);
				$('#instance_address_' + element.instanceid).css("opacity",1);
				$('#instance_type_' + element.instanceid).css("opacity",1);
				$('#instance_icon_' + element.instanceid)[0].innerHTML = (( element.pingicon != undefined) ? element.pingicon : 'remove') ;
				$('#instance_type_' + element.instanceid)[0].innerHTML = (element.instancetype.name + ((element.system != undefined) ?  ((element.system.version != undefined) ? ' ' + element.system.version + '': '') : ''));

				switch (element.pingstatuscode) {
					case -2:
						//do something: timeout
						//$('#instance_icon_' + element.instanceid).addClass('material-connecting-error'); //material-connecting-error	
						$('#instance_icon_' + element.instanceid).addClass('material-instance-disabled'); //material-connecting-error
						$('#instance_name_' + element.instanceid).css("opacity",0.5);
						$('#instance_address_' + element.instanceid).css("opacity",0.5);
						$('#instance_type_' + element.instanceid).css("opacity",0.5);
						$('#instance-secure-edit-'+ element.instanceid).css("display",'none');
						break;
					case -1:
						//do something: offline
						//$('#instance_icon_' + element.instanceid).addClass('material-connecting-error'); //material-connecting-error
						$('#instance_icon_' + element.instanceid).addClass('material-instance-disabled'); //material-connecting-error
						$('#instance_name_' + element.instanceid).css("opacity",0.5);
						$('#instance_address_' + element.instanceid).css("opacity",0.5);
						$('#instance_type_' + element.instanceid).css("opacity",0.5);
						$('#instance-secure-edit-'+ element.instanceid).css("display",'none');
						break;
					case 0:
						//do something: connecting
						$('#instance_icon_' + element.instanceid).removeClass('material-instance-disabled');
						$('#instance_icon_' + element.instanceid).addClass('material-connecting');
						$('#instance-secure-edit-'+ element.instanceid).css("display",'block');
						break;
					case 1:
						//do something: online
						if (element.connected > 0){
							$('#instance_icon_' + element.instanceid).removeClass('material-instance-disabled');
							$('#instance_icon_' + element.instanceid).addClass('material-instance-connected');
						} else {
							if ( (element.token == undefined) && (element.instanceaccess.length == 0) ) {
								$('#instance_icon_' + element.instanceid).addClass('instance-protected');
							} else {
								$('#instance_icon_' + element.instanceid).addClass('instance-ready');
							}
						}
						$('#instance-secure-edit-'+ element.instanceid).css("display",'block');
						break;
					default:
						break;
				}

			} else {
				$('#instance_icon_' + element.instanceid).addClass('material-instance-disabled');
				$('#instance_name_' + element.instanceid).css("opacity",0.5);
				$('#instance_address_' + element.instanceid).css("opacity",0.5);
				$('#instance_type_' + element.instanceid).css("opacity",0.5);
				$('#instance-secure-edit-'+ element.instanceid).css("display",'none');
			}
			$('#instance_status_' + element.instanceid)[0].innerHTML = (( element.pingstatus != undefined) ? element.pingstatus : '') ;
			$('#instance-secure-token-'+ element.instanceid).css("display",( (element.token != undefined) ? 'block' : 'none') );
		})
		
		shuffleLiveInstances();

	}

	function manageinstanceKey(id,statusCode){

		if (!w2ui['myVault'+id]) 
		{
			var myToken = getInstanceAttribute('token',id);

			$().w2form({
				name: 'myVault'+id,
				style: 'border:0px;background-color:#fff;',
				formHTML: '<div class="w2ui-page page-0">'+
				'    <div>'+
				'         <table style="width:100%;background-Color:#fff;padding:5px 10px 10px 5px;border-bottom:2px solid #edf2f6;">' +
				'		   <tr>' +
				'		       <td style="text-align:left;vertical-align:left;padding:4px 4px 4px 8px;font-weight:400;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">'+
				'			     <span style="color:#000;opacity:0.75;font-weight:800;">' + getInstanceAttribute('name',id) + '</span>' + 
				'		       </td>'+
				'		   </tr>'+
				'		   <tr>'+
				'		       <td style="text-align:left;vertical-align:left;padding:4px 4px 4px 8px;font-weight:400;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">'+
				'			     <span style="color:#367ea6;width:inherit;">' + getInstanceAttribute('address',id) + '</span>'+
				'		       </td>'+
				'		   </tr>'+
				'         </table>'+
				'	 </div>'+
                '    <div style="height:120px;padding:20px 50px 20px 0;">'+
				'     <div class="w2ui-field">'+
                '        <label style=""><i style="color:#1f7995;" class="material-icons material-medium-fixed">perm_identity</i></label>'+
                '        <div>'+
                '           <input name="username" type="text" maxlength="100" style="font-size:14px;width:180px;height:22px;padding:6px 6px;margin:4px 0;border:1px solid #c0c0c0; border-radius:2px;"/>'+
                '        </div>'+
                '     </div>'+
                '     <div class="w2ui-field">'+
				'        <!-- <label style="font-size:13px;"><i style="color:#1f7995;" class="material-icons material-medium-fixed">security</i></label> --> '+
                '        <div>'+
                '            <input name="password" type="password" maxlength="100" style="font-size:14px;width:180px;height:22px;padding:6px 6px;margin:4px 0;border:1px solid #c0c0c0; border-radius:2px;"/>'+
                '        </div>'+
                '     </div>'+
				'    </div>'+
                '</div>'+
                '<div class="w2ui-buttons" style="text-align:center;">'+ ((myToken) ? '<button class="w2ui-btn" name="save">Save</button>' : '<button class="w2ui-btn" name="save">Create Linked Account</button>')+
				'    '+ ((myToken) ? '    <button class="w2ui-btn" name="remove">Remove</button>' : '')+ /*<button class="w2ui-btn" name="cancel">Cancel</button>*/
                '</div>',
				fields: getFields(),
				record: { 
					username    : ((myToken) ? atob(blowfish.decrypt(myToken.message, blowfish.encrypt(myAppData[0].user.id, getInstanceAttribute('uid',id), {outputType: 1, cipherMode: 5}), {outputType: 0, cipherMode: 3})).split(':')[0] : ''),
					password    : ((myToken) ? atob(blowfish.decrypt(myToken.message, blowfish.encrypt(myAppData[0].user.id, getInstanceAttribute('uid',id), {outputType: 1, cipherMode: 5}), {outputType: 0, cipherMode: 3})).split(':')[1] : ''),
				},
				actions: {
					"save": function () { 

						if (this.validate()){

							var urlTest = (getInstanceAttribute('address',id) + '/api/me.json?fields=*');
							var secTest = btoa(w2ui['myVault'+id].record.username + ':' + w2ui['myVault'+id].record.password);
							
							console.log(urlTest);
							console.log(secTest);

							w2popup.message({ 
								width   : 400, 
								height  : 180,
								html    : '<div id="savingPrompt" class="rounded" style="background-Color:#ffffff;width:100%;height:100%;padding:10% 10% 10% 10%;vertical-align:middle;text-align:center;"><p>&nbsp;</p><img src="img/loading.gif" style="width:40px;height:40px;"><p>&nbsp;</p>Verifying credentials...</div>'
							});

							 $.ajax({
								url: urlTest,headers: { "Authorization": 'Basic ' + secTest},
								success : function(dataSuccess){

									var myEntry = [];
									var myKey1 = blowfish.encrypt(myAppData[0].user.id, getInstanceAttribute('uid',id), {outputType: 1, cipherMode: 5})
									var myKey2 = btoa(w2ui['myVault'+id].record.username + ':' + w2ui['myVault'+id].record.password);
									var myKey3 = blowfish.encrypt(myKey2, myKey1, {outputType: 0, cipherMode: 3})

									w2popup.close();

									myEntry.uid = getInstanceAttribute('uid',id);
									myEntry.userInst = myKey1;
									myEntry.merged = myKey3;

									saveLinkedAccount( JSON.stringify(JSON.parse('{"uid": "' + getInstanceAttribute('uid',id) + '", "userInst": "' + myKey1 + '", "merged": "' + myKey3 + '"}')) , id);

								},
								error: function (xhr, ajaxOptions, thrownError) {
									w2popup.close();
									console.log('Error:  Unable to verify user credentials');
									w2alert('<div style="font-weight:800; padding: 20px; color: #800000; text-align: center"><i style="font-size:32px;" class="material-icons">error</i></div><br>'+
												  '<div class="w2ui-centered"style="padding:60px 0 0 0;">Unable to verify user credentials</div>','Error');
								}
							});

						}

					},
					"cancel": function (){
						w2popup.close()
					},
					"remove": function (){

						w2popup.message({ 
							width   : 400, 
							height  : 180,
							html    : '<div id="removingPrompt" class="rounded" style="background-Color:#ffffff;width:100%;height:100%;padding:10% 10% 10% 10%;vertical-align:middle;text-align:center;"><p>&nbsp;</p><img src="img/loading.gif" style="width:40px;height:40px;"><p>&nbsp;</p>Removing linked account...</div>'
						});
						removeLinkedAccount(id);
					}
				}
			});
		}
		
		var iconStyle = ((statusCode==1) ? 'color:#8A1246;font-size:20px' : 'color:#1f7995;');
		var iconLabel = ((statusCode==1) ? 'security' : 'link');
		var popupMessage = ((statusCode==1) ? '<span style="color:#8A1246;font-weight:800;">LIMITED ACCESS</span><span style="color:#000;opacity:0.75;font-weight:400;">: Registered accounts holders only</span>' : 'Link user account');

		$().w2popup('open', {
			title   : '<table style="text-align:left;background-Color:inherit;color:#000"><tr><td class="popup-security-title" style="vertical-align:top;"><i style="' + iconStyle + '" class="material-icons ">' + iconLabel + '</i></td><td style="vertical-align:top;padding:0 0 0 4px;">' + popupMessage + '</td></tr></table>',
			body    : '<div id="formVault" style="width:100%;height:100%;background-Color:#fff;"></div>',
			style   : 'padding: 15px 0px 0px 0px',
			width   : 500,
			height  : 350, 
			showMax : false,
			onToggle: function (event) {
				$(w2ui['myVault'+id].box).hide();
				event.onComplete = function () {
					$(w2ui['myVault'+id].box).show();
					w2ui.myVault.resize();
				}
			},
			onOpen: function (event) {
				event.onComplete = function () {
					$('#w2ui-popup #formVault').w2render('myVault'+id);
				}
			}
		});

		function saveLinkedAccount(thisObj,thisId) {

			w2popup.open({
				body: '<div id="savingPrompt" class="rounded" style="background-Color:#ffffff;width:100%;height:100%;padding:10% 10% 10% 10%;vertical-align:middle;text-align:center;"><p>&nbsp;</p><img src="img/loading.gif" style="width:40px;height:40px;"><p>&nbsp;</p>saving...</div>',
				onClose   : function (event) { refreshInstanceList(); }
			});
			var myPostURL = (g_prtcl + '://' + g_PGurl + '/trxpost');
			var myRecord = JSON.parse(thisObj);
			var myUID = generateUID(11);

			var saveRec = {
				uid: myUID,
				status: 0,
				type: 'userInstanceAccount',
				data: JSON.stringify(myRecord)
			}

			$.post(myPostURL, saveRec)
				.done(function(msg){ 
					w2popup.title = 'SAVED';
					document.getElementById('savingPrompt').innerHTML= '<div id="saved" style="vertical-align:middle;text-align:center;">'+
						'<table style="width:100%;height:100%;"><tr><td class="" style="text-align:center;width:120px;height:120px"><i class="material-icons" style="font-size:60px;color:#09B82E">thumb_up</i></td><tr>'+
						'<tr><td style="padding:15px;">&nbsp;</td></tr>'+
						'<tr><td style="padding:15px;">' + 'User account linked' + '</td></tr></table>';
					setTimeout(function () { w2popup.close(); IntialiseMyConnectorTokens(); setTimeout(function () { refreshInstanceList() }, 2000) }, 3000);
				})
				.fail(function(xhr, status, error) {
					// error handling
					w2popup.title = 'ERROR (' + error + ')';
					document.getElementById('savingPrompt').innerHTML= '<div id="notsaved" style="vertical-align:middle;text-align:center;">'+
						'<table style="width:100%;height:100%;"><tr><td class="" style="text-align:center;width:120px;height:120px"><i class="material-icons" style="font-size:60px;color:#FF0000">thumb_down</i></td><tr>'+
						'<tr><td style="padding:15px;">&nbsp;</td></tr>'+
						'<tr><td style="padding:15px;">' + 'Error occurred, please try linking your account again' + '</td></tr></table>';
					setTimeout(function () { w2popup.close(); manageinstanceKey(thisId,0) }, 4000);
				});

		}

		function removeLinkedAccount(thisId) {

			w2popup.open({
				body: '<div id="removingPrompt" class="rounded" style="background-Color:#ffffff;width:100%;height:100%;padding:10% 10% 10% 10%;vertical-align:middle;text-align:center;"><p>&nbsp;</p><img src="img/loading.gif" style="width:40px;height:40px;"><p>&nbsp;</p>removing...</div>',
				onClose   : function (event) { refreshInstanceList(); }
			});
			var myPostURL = (g_prtcl + '://' + g_PGurl + '/trxpost');
			var myRecord = JSON.stringify(JSON.parse('{"uid": "' + blowfish.encrypt(myAppData[0].user.id, getInstanceAttribute('uid',id), {outputType: 1, cipherMode: 5}) + '"}'));
			var myUID = generateUID(11);

			var saveRec = {
				uid: myUID,
				status: 0,
				type: 'userInstanceAccountDrop',
				data: (myRecord)
			}

			$.post(myPostURL, saveRec)
				.done(function(msg){ 
					w2popup.title = 'REMOVED';
					document.getElementById('removingPrompt').innerHTML= '<div id="" style="vertical-align:middle;text-align:center;">'+
						'<table style="width:100%;height:100%;"><tr><td class="" style="text-align:center;width:120px;height:80px"><i class="material-icons" style="font-size:60px;color:#1A80FF">thumb_up</i></td><tr>'+
						'<tr><td style="padding:15px;">' + 'Linked account removed' + '</td></tr></table>';
					setTimeout(function () { w2popup.close(); setInstanceAttribute('token',thisId,[]); IntialiseMyConnectorTokens(); setTimeout(function () { refreshInstanceList() }, 2000) }, 3000);
				})
				.fail(function(xhr, status, error) {
					// error handling
					w2popup.title = 'ERROR (' + error + ')';
					document.getElementById('removingPrompt').innerHTML= '<div id="notsaved" style="vertical-align:middle;text-align:center;">'+
						'<table style="width:100%;height:100%;"><tr><td class="" style="text-align:center;width:120px;height:120px"><i class="material-icons" style="font-size:60px;color:#FF0000">thumb_down</i></td><tr>'+
						'<tr><td style="padding:15px;">&nbsp;</td></tr>'+
						'<tr><td style="padding:15px;">' + 'Error occurred, please try again' + '</td></tr></table>';
					setTimeout(function () { w2popup.close(); manageinstanceKey(thisId,0) }, 4000);
				});

		}

	}

	function getFields(){

		var flds = [];

		flds.push ( { field: 'username', type: 'text', html: { caption: 'username', page: 0, column: 0, attr: 'style="width:200px;"' }, required: true } ); 
		flds.push ( { field: 'password',  type: 'password', html: { caption: 'password', page: 0, column: 0, attr: 'style="width:200px;"' }, required: true } );

		return flds;

	}


function getmapLeftMenuContent(){

	var myLeftContent = document.createElement('div');
	var myContainer = document.createElement('div');
	myContainer.setAttribute('style', 'height:100%;padding:0;overflows:hidden;width:280px;');
	
	myLeftContent.appendChild(myContainer);

	var tbl = document.createElement('table');
	tbl.setAttribute('style', 'background-Color:#ffffff;padding:0;');
	myContainer.appendChild(tbl);

	var tr = document.createElement('tr');
	tr.setAttribute('style', '');
	tbl.appendChild(tr);

	var td = document.createElement('td');
	td.setAttribute('style', 'text-align:center;font-size:8pt;height:100%;padding:0;background-Color:#ffffff;font-family: Roboto');
	td.setAttribute('colspan', 2);
	tr.appendChild(td);

	var dvMTL = document.createElement('div');
	dvMTL.setAttribute('style', 'text-align:left;font-size:8pt;vertical-align:top;overflow:auto;background-Color:#ffffff;font-family:inherit;'); //border:1px solid #C0C0C0;
	dvMTL.setAttribute('id', 'menutopleft');
	td.appendChild(dvMTL);


	/* TOP SECTION: start */

	var dv = document.createElement('div');
	dv.setAttribute('style', 'overflow-y:auto;'); //text-shadow: -1px 0 #F5F5F5, 0 1px #F5F5F5, 1px 0 #F5F5F5, 0 -1px #F5F5F5;
	dvMTL.appendChild(dv);

		var tbl1 = document.createElement('table');
		tbl1.setAttribute('style', 'width:280px;height:100%;background-Color:#ffffff;font-weight:400;font-family:inherit;color:#000000;');
		tbl1.setAttribute('id', 'tblLeftMenu');
		dvMTL.appendChild(tbl1);

		Inst = myAppData[0].instances;
		
		Inst.forEach(function(element) {
			
			if (element.favourites != undefined){

				if (element.favourites.length){
				

					var Favs = element.favourites;
					
					Favs.forEach(function(fav) {

						var tr1 = document.createElement('tr');
						tr1.setAttribute('class', 'mnuSubGrp');
						tbl1.appendChild(tr1);

						var td1 = document.createElement('td');
						td1.setAttribute('class', 'mnuSubGrp');
						td1.setAttribute('style', 'padding:1px;');
						td1.setAttribute('title', element.name +': ' + fav.name);
						td1.setAttribute('onclick', 'ToggleFloatMenuGroup(document.getElementById("imggrp1sub' + element.instanceid+fav.id+ '"),"grp1sub' + element.instanceid+fav.id+ '");');
						tr1.appendChild(td1);

							var tblIn = document.createElement('table');
							tblIn.setAttribute('style', 'text-align:left;vertical-align:top;text-align:left;width:100%;');
							td1.appendChild(tblIn);
							var trlIn = document.createElement('tr');
							tblIn.appendChild(trlIn);
							var tdlIn = document.createElement('td');
							tdlIn.setAttribute('style', "width:20px;");
							trlIn.appendChild(tdlIn);

							/*var chkIc = document.createElement('i');
							chkIc.setAttribute('class', "material-icons favourite");
							chkIc.setAttribute('style', "opacity:0.75;font-size:18px;");
							chkIc.innerHTML = 'star';
							tdlIn.appendChild(chkIc);*/

							var img = document.createElement('img');
							img.setAttribute('src', 'img/' + ( (fav.collection == 'indicators') ? 'ind.png' : 'de.png' ) );
							tdlIn.appendChild(img);

							var tdlIn = document.createElement('td');
							tdlIn.setAttribute('style', 'text-align:left;font-size:14px;vertical-align:middle;padding:4px 2px 2px 2px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;');
							tdlIn.setAttribute('title', element.name +': ' + fav.name);
							trlIn.appendChild(tdlIn);

							var txt = document.createTextNode(element.name +': ' + fav.name);
							tdlIn.appendChild(txt);


						var td1 = document.createElement('td');
						td1.setAttribute('class', 'mnuSubGrpArrow');
						tr1.appendChild(td1);

						var img = document.createElement('img');
						img.setAttribute('src', 'img/down.png');
						img.setAttribute('id', 'imggrp1sub' + element.instanceid+fav.id+ '');
						img.classList.add("clicker");
						img.classList.add("up");
						img.setAttribute('onclick', 'ToggleFloatMenuGroup(this,"grp1sub' + element.instanceid+fav.id +'");');
						td1.appendChild(img);

						dxCol = getInstanceDxgroupAttribute(element.instanceid,fav.objName,fav.id,fav.collection,'')

						dxCol.forEach(function(dx) {

							var tr1 = document.createElement('tr');
							tr1.classList.add("grp1");
							tr1.classList.add("grp1sub" + element.instanceid+fav.id);
							tbl1.appendChild(tr1);

							var td1 = document.createElement('td');
							td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 6px;vertical-align:top;');
							td1.setAttribute('colspan', '3');
							tr1.appendChild(td1);

							var tblIn = document.createElement('table');
							tblIn.setAttribute('style', 'text-align:left;vertical-align:top;text-align:left;');
							td1.appendChild(tblIn);
							var trlIn = document.createElement('tr');
							tblIn.appendChild(trlIn);
							var tdlIn = document.createElement('td');
							trlIn.appendChild(tdlIn);

							var rad = document.createElement('input');
							rad.setAttribute('type', 'checkbox');
							rad.setAttribute('id', dx.id);
							rad.setAttribute('name', 'dxFav.'+fav.id);
							rad.setAttribute('value', dx.id);
							rad.setAttribute('ArcGIS_MapServer_ID', getArcIDfromCriteriaDx(dx.id));
							rad.setAttribute('ColScheme', 'SANACGrYlRd');
							rad.setAttribute('label', dx.shortName);
							rad.setAttribute('long-name', dx.name);
							rad.setAttribute('title', dx.name);
							rad.setAttribute('short-name', dx.shortName);
							rad.setAttribute('Category', fav.objName);
							rad.setAttribute('onclick','updateCriteria(this)');
							rad.checked = false;
							tdlIn.appendChild(rad);

							var tdlIn = document.createElement('td');
							trlIn.appendChild(tdlIn);

							var lbl = document.createElement('label');
							lbl.setAttribute('style', 'text-align:left;padding:0 0 0 2px;font-size:12px;vertical-align:top;text-align:left;');
							lbl.setAttribute('for',dx.id);
							tdlIn.appendChild(lbl);

							var txt = document.createTextNode(dx.shortName);
							lbl.appendChild(txt);

						})

					})

				}
				
			}

		})



		var tr1 = document.createElement('tr');
		tr1.setAttribute('style', 'display:none;');
		tr1.setAttribute('class', 'mnuSubGrp');
		tr1.setAttribute('id', 'trMenuGroupDynamic');
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrp');
		td1.setAttribute('onclick', 'ToggleFloatMenuGroup(document.getElementById("imggrp1subDynamic"),"grp1subDynamic");');
		tr1.appendChild(td1);

		
		var txt = document.createTextNode(' ');
		td1.appendChild(txt);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrpArrow');
		tr1.appendChild(td1);

		var img = document.createElement('img');
		img.setAttribute('src', 'img/down.png');
		img.setAttribute('id', 'imggrp1subDynamic');
		img.classList.add("clicker");
		img.classList.add("down");
		img.setAttribute('onclick', 'ToggleFloatMenuGroup(this,"grp1subDynamic");');

		td1.appendChild(img);
		
		var tr1 = document.createElement('tr');
		tr1.classList.add("grp1");
		tr1.classList.add("grp1subDynamic");
		tr1.setAttribute('id', 'trMenuChildItemDynamic');
		tr1.setAttribute('style', 'display:none;');
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.classList.add("mnuSubGrp");
		td1.classList.add("grp1subDynamic");
		tr1.appendChild(td1);

		var tr1 = document.createElement('tr');
		tr1.setAttribute('class', 'mnuSubGrp');
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrp');
		td1.setAttribute('onclick', 'ToggleFloatMenuGroup(document.getElementById("imggrp1Labels"),"grp1Labels");');
		tr1.appendChild(td1);

		var txt = document.createTextNode('labels');
		td1.appendChild(txt);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrpArrow');
		tr1.appendChild(td1);

		var img = document.createElement('img');
		img.setAttribute('src', 'img/down.png');
		img.setAttribute('id', 'imggrp1Labels');
		img.classList.add("clicker");
		img.classList.add("up");
		img.setAttribute('onclick', 'ToggleFloatMenuGroup(this,"grp1Labels");');
		td1.appendChild(img);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:8px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);
	

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.none');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		rad.setAttribute('checked','true');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode('none');
		lbl.appendChild(txt);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.numerator');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 4px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode('value: numerator');
		lbl.appendChild(txt);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.denominator');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 4px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode('value: denominator');
		lbl.appendChild(txt);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.value');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 4px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode('value: outcome');
		lbl.appendChild(txt);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.rank.value');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode('rank: outcome');
		lbl.appendChild(txt);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.rank.parent.value');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		lbl.setAttribute('id','labelrank.belowParent');
		td1.appendChild(lbl);

		var txt = document.createTextNode('rank: outcome (below parent)');
		lbl.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.rank.grandParent.value');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		lbl.setAttribute('id','labelrank.belowGrandParent');
		td1.appendChild(lbl);

		var txt = document.createTextNode('rank: outcome (below grandParent)');
		lbl.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.name');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 4px 0 4px;font-size:8pt;vertical-align:middle;');
		lbl.setAttribute('id', 'labelNameWithOUlevel');
		td1.appendChild(lbl);

		var txt = document.createTextNode('name:');
		lbl.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp2");
		tr1.classList.add("grp1Labels");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		tr1.appendChild(td1);

		var rad = document.createElement('input');
		rad.setAttribute('type', 'radio');
		rad.setAttribute('id', 'label.shortName');
		rad.setAttribute('name', 'label.options');
		rad.setAttribute('onclick','ToggleFeatureLabel(this)');
		td1.appendChild(rad);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 4px 0 4px;font-size:8pt;vertical-align:middle;');
		lbl.setAttribute('id', 'labelShortNameWithOUlevel');
		td1.appendChild(lbl);

		var txt = document.createTextNode('short name ');
		lbl.appendChild(txt);

		

		var tr1 = document.createElement('tr');
		tr1.setAttribute('class', 'mnuSubGrp');
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrp');
		td1.setAttribute('onclick', 'ToggleFloatMenuGroup(document.getElementById("imggrp1Options"),"grp1Options");');
		tr1.appendChild(td1);

		var txt = document.createTextNode('options');
		td1.appendChild(txt);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrpArrow');
		tr1.appendChild(td1);

		var img = document.createElement('img');
		img.setAttribute('src', 'img/down.png');
		img.setAttribute('id', 'imggrp1Options');
		img.classList.add("clicker");
		img.classList.add("up");
		img.setAttribute('onclick', 'ToggleFloatMenuGroup(this,"grp1Options");');

		td1.appendChild(img);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp1");
		tr1.classList.add("grp1Options");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:right;padding:4px 2px 2px 4px;font-size:8pt;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);
		


			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;display:block;');
			td1.appendChild(tblInner);


			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);


			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkShowNonReportingOrgUnits');
			chk.setAttribute('type', 'checkbox');
			if (g_bShowNonReportingOrgUnits){
				chk.setAttribute('checked', '');
			}
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblShowZeroOrgUnits');
			td1.setAttribute('title', 'orgunits that have ZERO denominator values, i.e. nothing collected and/or not services rendered');
			tr1.appendChild(td1);

			var txt = document.createTextNode('orgunits with no data');
			td1.appendChild(txt);

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkShowOnScreenLegend');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'ShowOnScreenLegend');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblShowOnScreenLegend');
			td1.setAttribute('title', 'Display On-Screen Legend');
			tr1.appendChild(td1);

			var txt = document.createTextNode('on-screen legend');
			td1.appendChild(txt);


			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkShowBorders');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'ShowBorders');
			chk.setAttribute('checked', true);
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblShowBorders');
			td1.setAttribute('title', 'Display boundary borders');
			tr1.appendChild(td1);

			var txt = document.createTextNode('borders');
			td1.appendChild(txt);


			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkScalePointRadiusToNumerator');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'ScalePointRadiusTo');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblScalePointRadiusToNumerator');
			td1.setAttribute('title', 'increase bubble size according to the proportion of HIV Tests Positive');
			tr1.appendChild(td1);

			var txt = document.createTextNode('point scale: numerator');
			td1.appendChild(txt);

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);


			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkScalePointRadiusToDenominator');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'ScalePointRadiusTo');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblScalePointRadiusToDenominator');
			td1.setAttribute('title', 'increase bubble size according to the proportion of HIV Tests Done');
			tr1.appendChild(td1);

			var txt = document.createTextNode('point scale: denominator');
			td1.appendChild(txt);

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);


			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkScalePointRadiusToOutcome');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'ScalePointRadiusTo');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblScalePointRadiusToOutcome');
			td1.setAttribute('title', 'increase bubble size according to the ratio of Outcome');
			tr1.appendChild(td1);

			var txt = document.createTextNode('point scale: outcome');
			td1.appendChild(txt);

			
			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;padding:4px 2px 2px 18px;font-size:8pt;');
			td1.setAttribute('colspan', '2');
			tr1.appendChild(td1);

			

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);	

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'width:40px;padding:2px 4px 2px 4px;font-size:8pt;');
			tr1.appendChild(td1);

			var txt = document.createTextNode('radius');
			td1.appendChild(txt);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;');
			tr1.appendChild(td1);

			var dv = document.createElement('div');
			dv.setAttribute('id', 'PointRadiusDefaultSize');
			dv.setAttribute('style', 'border:0;');
			td1.appendChild(dv);

			var Slider = document.createElement('input');
			Slider.setAttribute('type', 'range');
			Slider.setAttribute('id', 'PointRadiusDefaultSizeSlider');
			Slider.setAttribute('min', '1');
			Slider.setAttribute('max', '10');
			Slider.setAttribute('step', '1');
			Slider.setAttribute('value', g_iPointRadiusDefaultSize);
			Slider.setAttribute('onchange', 'updatePointRadiusDefaultSize(this.value)');
			Slider.setAttribute('style', 'width:100px;');

			dv.appendChild(Slider);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp1");
		tr1.classList.add("grp1sub");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:4px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'width:40px;padding:2px 4px 2px 4px;font-size:8pt;');
			tr1.appendChild(td1);

			var txt = document.createTextNode('opacity');
			td1.appendChild(txt);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;');
			tr1.appendChild(td1);

			var dv = document.createElement('div');
			dv.setAttribute('id', 'CurrentLayerOpacitySlider');
			dv.setAttribute('style', 'border:0;');
			td1.appendChild(dv);

			var Slider = document.createElement('input');
			Slider.setAttribute('type', 'range');
			Slider.setAttribute('id', 'currentCriteriaOpacity');
			Slider.setAttribute('min', '0');
			Slider.setAttribute('max', '1');
			Slider.setAttribute('step', '0.05');
			Slider.setAttribute('value', g_CurrentLayerOpacity[0]);
			Slider.setAttribute('title', (g_CurrentLayerOpacity[0] * 100));
			Slider.setAttribute('onchange', 'updateCriteriaOpacity(this.value)');
			Slider.setAttribute('style', 'width:100px;');

			dv.appendChild(Slider);


	/* TOP SECTION: end */
	
	/* MID SECTION: start */


	var dv = document.createElement('div');
	dv.setAttribute('style', 'text-align:left;padding:4px;font-size:8pt;vertical-align:top;'); //border:1px solid #C0C0C0;
	dv.setAttribute('id', 'menumidleft');

	td.appendChild(dv);


		var tr1 = document.createElement('tr');
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuGrp');
		td1.setAttribute('colspan', 2);
		tr1.appendChild(td1);

		var txt = document.createTextNode('SPATIAL LAYERS');
		td1.appendChild(txt);




		var tr1 = document.createElement('tr');
		tr1.setAttribute('class', 'mnuSubGrp');
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrp');
		td1.setAttribute('onclick', 'ToggleFloatMenuGroup(document.getElementById("imggrp3sub2"),"grp3sub2");');
		tr1.appendChild(td1);

		var txt = document.createTextNode('Fixed Layers');
		td1.appendChild(txt);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrpArrow');
		tr1.appendChild(td1);

		var img = document.createElement('img');
		img.setAttribute('src', 'img/down.png');
		img.setAttribute('id', 'imggrp3sub2');
		img.classList.add("clicker");
		img.classList.add("up");
		img.setAttribute('onclick', 'ToggleFloatMenuGroup(this,"grp3sub2");');

		td1.appendChild(img);

		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub2");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:8px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

		var chk = document.createElement('input');
		chk.setAttribute('type', 'checkbox');
		chk.setAttribute('name', 'spatial.OU2');
		chk.setAttribute('id', 'spatial.OU2');
		chk.setAttribute('onclick', 'UpdateSpatialLayer(this)');
		td1.appendChild(chk);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode(getConnectedInstanceOUlevelname(1));
		lbl.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub2");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

		var chk = document.createElement('input');
		chk.setAttribute('type', 'checkbox');
		chk.setAttribute('name', 'spatial.OU3');
		chk.setAttribute('id', 'spatial.OU3');
		chk.setAttribute('onclick', 'UpdateSpatialLayer(this)');
		td1.appendChild(chk);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode(getConnectedInstanceOUlevelname(2));
		lbl.appendChild(txt);

		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub2");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

		var chk = document.createElement('input');
		chk.setAttribute('type', 'checkbox');
		chk.setAttribute('name', 'spatial.OU4');
		chk.setAttribute('id', 'spatial.OU4');
		chk.setAttribute('onclick', 'UpdateSpatialLayer(this)');
		td1.appendChild(chk);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode(getConnectedInstanceOUlevelname(3));
		lbl.appendChild(txt);

		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub2");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

		var chk = document.createElement('input');
		chk.setAttribute('type', 'checkbox');
		chk.setAttribute('name', 'spatial.OU5.join');
		chk.setAttribute('id', 'spatial.OU5.join');
		chk.setAttribute('onclick', 'UpdateSpatialWard(this)');
		td1.appendChild(chk);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode(getConnectedInstanceOUlevelname(4));
		lbl.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub2");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

		var chk = document.createElement('input');
		chk.setAttribute('type', 'checkbox');
		chk.setAttribute('name', 'spatial.OU5');
		chk.setAttribute('id', 'spatial.OU5');
		chk.setAttribute('onclick', 'UpdateSpatialLayer(this)');
		td1.appendChild(chk);

		var lbl = document.createElement('label');
		lbl.setAttribute('style', 'text-align:left;padding:0 8px 0 4px;font-size:8pt;vertical-align:middle;');
		td1.appendChild(lbl);

		var txt = document.createTextNode(getConnectedInstanceOUlevelname(5));
		lbl.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub2");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:2px 2px 2px 8px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'width:40px;padding:2px 4px 2px 4px;font-size:8pt;');
			tr1.appendChild(td1);

			var txt = document.createTextNode('opacity');
			td1.appendChild(txt);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;');
			tr1.appendChild(td1);

			var dv = document.createElement('div');
			dv.setAttribute('id', 'FixedLayerOpacitySlider');
			dv.setAttribute('style', 'border:0;');
			td1.appendChild(dv);

			var Slider = document.createElement('input');
			Slider.setAttribute('type', 'range');
			Slider.setAttribute('id', 'FixedLayerOpacity');
			Slider.setAttribute('min', '0');
			Slider.setAttribute('max', '1');
			Slider.setAttribute('step', '0.05');
			Slider.setAttribute('value', g_CurrentLayerOpacity[2]);
			Slider.setAttribute('title', (g_CurrentLayerOpacity[2] * 100));
			Slider.setAttribute('onchange', 'updateFixedLayerOpacity(this.value);this.title=(this.value*100);');
			Slider.setAttribute('style', 'width:100px;');

			dv.appendChild(Slider);


		var tr1 = document.createElement('tr');
		tr1.setAttribute('class', 'mnuSubGrp');
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrp');
		td1.setAttribute('onclick', 'ToggleFloatMenuGroup(document.getElementById("imggrp3sub3"),"grp3sub3");');
		tr1.appendChild(td1);

		var txt = document.createTextNode('Calculated Layers');
		td1.appendChild(txt);

		var td1 = document.createElement('td');
		td1.setAttribute('class', 'mnuSubGrpArrow');
		tr1.appendChild(td1);

		var img = document.createElement('img');
		img.setAttribute('src', 'img/down.png');
		img.setAttribute('id', 'imggrp3sub3');
		img.classList.add("clicker");
		img.classList.add("up");
		img.setAttribute('onclick', 'ToggleFloatMenuGroup(this,"grp3sub3");');

		td1.appendChild(img);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:14px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);

			var tr1 = document.createElement('tr');
			tr1.classList.add("grp3");
			tr1.classList.add("grp3sub3");
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;width:50px');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkShowHideImpactLayer');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'chkShowHideImpactLayer');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');
			chk.disabled = false;

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:0');
			td1.setAttribute('title', 'Display ARCGIS KRIGING layer (previously known as HIV positivity hotspot layer)');
			td1.setAttribute('id', 'lblShowHideImpactLayer');
			tr1.appendChild(td1);

			var txt = document.createTextNode('impact / kriging layer');
			td1.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:right;padding:4px 2px 2px 18px;font-size:8pt;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);	

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'width:80px;padding:2px 4px 2px 4px;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var txt = document.createTextNode('opacity');
			td1.appendChild(txt);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;');
			tr1.appendChild(td1);

			var dv = document.createElement('div');
			dv.setAttribute('style', 'border:0;');
			td1.appendChild(dv);

			var Slider = document.createElement('input');
			Slider.setAttribute('type', 'range');
			Slider.setAttribute('id', 'baseImageOverlayOpacity');
			Slider.setAttribute('name', 'baseImageOverlayOpacity');
			Slider.setAttribute('min', '0');
			Slider.setAttribute('max', '1');
			Slider.setAttribute('step', '0.05');
			Slider.setAttribute('value', (g_baseImageOverlayOpacity));
			Slider.setAttribute('onchange', 'updatebaseImageOverlayOpacity(this.value)');
			Slider.setAttribute('style', 'width:60px;');
			Slider.disabled = true;

			dv.appendChild(Slider);


			

		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:right;padding:4px 0px 0px 18px;font-size:8pt;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);

			var tr1 = document.createElement('tr');
			tr1.classList.add("grp3");
			tr1.classList.add("grp3sub3");
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;width:50px');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'heatLayer.numerator');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'heatLayer.Option');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblScalePointRadiusToNumerator');
			td1.setAttribute('title', 'heatmap layer intensity scaled according to NUMERATOR density');
			tr1.appendChild(td1);

			var txt = document.createTextNode('heat layer: numerator');
			td1.appendChild(txt);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:right;padding:0px 0px 0px 18px;font-size:8pt;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);

			var tr1 = document.createElement('tr');
			tr1.classList.add("grp3");
			tr1.classList.add("grp3sub3");
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;width:50px');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'heatLayer.denominator');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'heatLayer.Option');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblScalePointRadiusToDenominator');
			td1.setAttribute('title', 'heatmap layer intensity scaled according to DENOMINATOR density');
			tr1.appendChild(td1);

			var txt = document.createTextNode('heat layer: denominator');
			td1.appendChild(txt);



		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;padding:0px 0px 0px 18px;font-size:8pt;');
			td1.setAttribute('colspan', '2');
			tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);

			var tr1 = document.createElement('tr');
			tr1.classList.add("grp3");
			tr1.classList.add("grp3sub3");
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;width:50px');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'heatLayer.value');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'heatLayer.Option');
			chk.setAttribute('onchange', 'UpdateSettings(this)');
			chk.setAttribute('style', 'width:40px;');

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:2px 2px 8px 2px');
			td1.setAttribute('id', 'lblScalePointRadiusToOutcome');
			td1.setAttribute('title', 'heatmap layer intensity scaled according to OUTCOME');
			tr1.appendChild(td1);

			var txt = document.createTextNode('heat layer: outcome');
			td1.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:right;padding:4px 2px 2px 18px;font-size:8pt;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);	

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'width:80px;padding:2px 4px 2px 4px;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var txt = document.createTextNode('intensity');
			td1.appendChild(txt);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;');
			tr1.appendChild(td1);

			var dv = document.createElement('div');
			dv.setAttribute('id', 'PointRadiusDefaultSize');
			dv.setAttribute('style', 'border:0;');
			td1.appendChild(dv);

			var Slider = document.createElement('input');
			Slider.setAttribute('type', 'range');
			Slider.setAttribute('id', 'heatRadius');
			Slider.setAttribute('name', 'heatRadius');
			Slider.setAttribute('min', '1');
			Slider.setAttribute('max', '40');
			Slider.setAttribute('step', '1');
			Slider.setAttribute('value', (g_heatRadius));
			Slider.setAttribute('onchange', 'updateHeatLayer(this.value)');
			Slider.setAttribute('style', 'width:60px;');
			Slider.disabled = true;

			dv.appendChild(Slider);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:left;padding:4px 2px 2px 18px;vertical-align:top;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);

			var tr1 = document.createElement('tr');
			tr1.classList.add("grp3");
			tr1.classList.add("grp3sub3");
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:right;font-size:8pt;width:50px');
			tr1.appendChild(td1);

			var chk = document.createElement('input');
			chk.setAttribute('id', 'chkShowHideVoronoi');
			chk.setAttribute('type', 'checkbox');
			chk.setAttribute('name', 'chkShowHideVoronoi');
			chk.setAttribute('onchange', 'UpdateVoronoi(this)');
			chk.setAttribute('style', 'width:40px;');
			chk.disabled = true;

			td1.appendChild(chk);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;font-size:8pt;width:100%;text-align:left;padding:0');
			td1.setAttribute('title', 'Voronoi partitions or polygons are created between facilities based on equal distance between nearby points. Also known as Thiessen polygons');
			td1.setAttribute('id', 'lblVoronoiMenuLeft');
			tr1.appendChild(td1);

			var txt = document.createTextNode('Voronoi / Thiessen polygons');
			td1.appendChild(txt);


		var tr1 = document.createElement('tr');
		tr1.classList.add("grp3");
		tr1.classList.add("grp3sub3");
		tbl1.appendChild(tr1);

		var td1 = document.createElement('td');
		td1.setAttribute('style', 'text-align:right;padding:4px 2px 2px 18px;font-size:8pt;');
		td1.setAttribute('colspan', '2');
		tr1.appendChild(td1);

			var tblInner = document.createElement('table');
			tblInner.setAttribute('style', 'width:100%;height:100%;background-Color:#ffffff;');
			td1.appendChild(tblInner);	

			var tr1 = document.createElement('tr');
			tblInner.appendChild(tr1);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'width:80px;padding:2px 4px 2px 4px;font-size:8pt;text-align:right;');
			tr1.appendChild(td1);

			var txt = document.createTextNode('opacity');
			td1.appendChild(txt);

			var td1 = document.createElement('td');
			td1.setAttribute('style', 'text-align:center;');
			tr1.appendChild(td1);

			var dv = document.createElement('div');
			dv.setAttribute('style', 'border:0;');
			td1.appendChild(dv);

			var Slider = document.createElement('input');
			Slider.setAttribute('type', 'range');
			Slider.setAttribute('id', 'voronoiOPACITY');
			Slider.setAttribute('name', 'voronoiOPACITY');
			Slider.setAttribute('min', '0');
			Slider.setAttribute('max', '1');
			Slider.setAttribute('step', '0.05');
			Slider.setAttribute('value', g_CurrentLayerOpacity[1]);
			Slider.setAttribute('onchange', 'updateVoronoiOPACITY(this.value)');
			Slider.setAttribute('style', 'width:60px;');
			Slider.disabled = true;

			dv.appendChild(Slider);


	/* MID SECTION: end */


	return (myLeftContent.innerHTML);

}

function getConnectedInstanceOUlevelname(ilevel){

	var OUL = getConnectedInstanceAttributeValue('organisationUnitLevels')
	
	for (var i = 0; i < OUL.length; i++){
		if (OUL[i].level == ilevel){
			return OUL[i].name;
			break;
		}
	
	}

}

function ToggleFloatMenuGroup(thisObj,classGrp){

	var clGrp = document.getElementsByClassName(classGrp);
	var bUp;

	for (var i = 0; i < thisObj.classList.length; i++) {
		if (thisObj.classList[i] == 'up'){
			bUp = true;
		}
		if (thisObj.classList[i] == 'down'){
			bUp = false;
		}
	}

	if (bUp){
		thisObj.classList.remove("up");
		thisObj.classList.add("down");
	} else {
		thisObj.classList.remove("down");
		thisObj.classList.add("up");
	}

	for (var i = 0; i < clGrp.length; i++) {
		if (clGrp[i].style.display != 'none'){
			clGrp[i].style.display = 'none';
		} else {
			clGrp[i].style.display = '';
		}
	}

}

function launchDHIS2App(thisObj){

	if (thisObj.getAttribute('data-instance') == "*"){
		window.open (getCurrentInstanceAttribute('address') + '/' + thisObj.getAttribute('data-ext'));
	} else {
		if (thisObj.getAttribute('data-instance') == getConnectedInstanceAttributeValue('instanceid')){
			window.open (getCurrentInstanceAttribute('address') + '/' + thisObj.getAttribute('data-ext'));
		}
	}
	

}

function getArcIDfromCriteriaDx(val){
	return val;
}
	function playIntro(){

		class TextScramble {
		  constructor(el) {
			this.el = el
			this.chars = '!<>-_\\/[]{}—=+*^?#________'
			this.update = this.update.bind(this)
		  }
		  setText(newText) {
			const oldText = this.el.innerText
			const length = Math.max(oldText.length, newText.length)
			const promise = new Promise((resolve) => this.resolve = resolve)
			this.queue = []
			for (let i = 0; i < length; i++) {
			  const from = oldText[i] || ''
			  const to = newText[i] || ''
			  const start = Math.floor(Math.random() * 40)
			  const end = start + Math.floor(Math.random() * 40)
			  this.queue.push({ from, to, start, end })
			}
			cancelAnimationFrame(this.frameRequest)
			this.frame = 0
			this.update()
			return promise
		  }
		  update() {
			let output = ''
			let complete = 0
			for (let i = 0, n = this.queue.length; i < n; i++) {
			  let { from, to, start, end, char } = this.queue[i]
			  if (this.frame >= end) {
				complete++
				output += to
			  } else if (this.frame >= start) {
				if (!char || Math.random() < 0.28) {
				  char = this.randomChar()
				  this.queue[i].char = char
				}
				output += `<span class="dud">${char}</span>`
			  } else {
				output += from
			  }
			}
			this.el.innerHTML = output
			if (complete === this.queue.length) {
			  this.resolve()
			} else {
			  this.frameRequest = requestAnimationFrame(this.update)
			  this.frame++
			}
		  }
		  randomChar() {
			return this.chars[Math.floor(Math.random() * this.chars.length)]
		  }
		}

		const phrases = [
		  'Neo,',
		  'sooner or later',
		  'you\'re going to realize',
		  'just as I did',
		  'that there\'s a difference',
		  'between knowing the path',
		  'and walking the path'
		]

		const el = document.querySelector('.text')
		const fx = new TextScramble(el)

		let counter = 0
		const next = () => {
		  fx.setText(phrases[counter]).then(() => {
			setTimeout(next, 800)
		  })
		  counter = (counter + 1) % phrases.length
		}

		next();

	}

	function generateUID(iLen) { // Public Domain/MIT
		var sReturn = "";
		var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

		for( var i=0; i < iLen; i++ )
			sReturn += possible.charAt(Math.floor(Math.random() * possible.length));

		return sReturn;
	}

	function loadSVGHierarchyStructure(){

		var InnS = getOUlevelSVGurl();

		$('#instanceName')[0].innerHTML = '[' + getConnectedInstanceAttributeValue('name') + ']';

		document.getElementById('hierarchyStructure').style.backgroundImage = 'url("data:image/svg+xml;utf8,' + InnS + '")';
		document.getElementById('hierarchyStructure').style.backgroundPosition = 'center bottom;';
		document.getElementById('hierarchyStructure').style.backgroundRepeat = 'no-repeat';

	}

	function getOUlevelSVGurl(){

		var svgInner = '';
		var ouLevels = getConnectedInstanceAttributeValue('organisationUnitLevels');
		var iLevels = ouLevels.length;

		switch (iLevels) {
			case 7:
				svgInner = "<?xml version='1.0' encoding='UTF-8' ?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' width='452' height='402'> <polygon x='1' points='1,401 401,401 200,2' style='stroke:#D0D3C0;stroke-width:2;fill:#fff;opacity:0.5;'></polygon> <line x1='171' y1='57' x2='450' y2='57' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='142' y1='114' x2='450' y2='114' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='114' y1='171' x2='450' y2='171' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='85' y1='228' x2='450' y2='228' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='57' y1='285' x2='450' y2='285' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='28' y1='342' x2='450' y2='342' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='1' y1='401' x2='450' y2='401' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <text x='200' y='35' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU1level</text> <text x='400' y='35' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU1count</text> <text x='200' y='92' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU2level</text> <text x='400' y='92' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU2count</text> <text x='200' y='149' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU3level</text> <text x='400' y='149' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU3count</text> <text x='200' y='206' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU4level</text> <text x='400' y='206' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU4count</text> <text x='200' y='263' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU5level</text> <text x='400' y='263' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU5count</text> <text x='200' y='320' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU6level</text> <text x='400' y='320' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU6count</text> <text x='200' y='377' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU7level</text> <text x='400' y='377' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU7count</text> </svg>";
				break;
			case 6:
				svgInner = "<?xml version='1.0' encoding='UTF-8' ?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' width='452' height='402'> <polygon x='1' points='1,401 401,401 200,2' style='stroke:#D0D3C0;stroke-width:2;fill:#fff;opacity:0.5;'></polygon> <line x1='168' y1='66' x2='450' y2='66' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='134' y1='133' x2='450' y2='133' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='101' y1='200' x2='450' y2='200' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='68' y1='266' x2='450' y2='266' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='34' y1='333' x2='450' y2='333' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='1' y1='401' x2='450' y2='401' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <text x='200' y='40' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU1level</text> <text x='400' y='40' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU1count</text> <text x='200' y='107' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU2level</text> <text x='400' y='107' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU2count</text> <text x='200' y='173' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU3level</text> <text x='400' y='173' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU3count</text> <text x='200' y='240' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU4level</text> <text x='400' y='240' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU4count</text> <text x='200' y='307' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU5level</text> <text x='400' y='307' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU5count</text> <text x='200' y='373' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU6level</text> <text x='400' y='373' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU6count</text> </svg>";
				break;
			case 5:
				svgInner = "<?xml version='1.0' encoding='UTF-8' ?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' width='452' height='402'> <polygon x='1' points='1,401 401,401 200,2' style='stroke:#D0D3C0;stroke-width:2;fill:#fff;opacity:0.5;'></polygon> <line x1='161' y1='80' x2='450' y2='80' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='121' y1='160' x2='450' y2='160' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='81' y1='240' x2='450' y2='240' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='41' y1='320' x2='450' y2='320' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='1' y1='401' x2='450' y2='401' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <text x='200' y='40' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU1level</text> <text x='400' y='40' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU1count</text> <text x='200' y='120' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU2level</text> <text x='400' y='120' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU2count</text> <text x='200' y='200' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU3level</text> <text x='400' y='200' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU3count</text> <text x='200' y='280' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU4level</text> <text x='400' y='280' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU4count</text> <text x='200' y='360' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU5level</text> <text x='400' y='360' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU5count</text> </svg>";
				break;
			case 4:
				svgInner = "<?xml version='1.0' encoding='UTF-8' ?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' width='452' height='402'> <polygon x='1' points='1,401 401,401 200,2' style='stroke:#D0D3C0;stroke-width:2;fill:#fff;opacity:0.5;'></polygon> <line x1='151' y1='100' x2='450' y2='100' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='101' y1='200' x2='450' y2='200' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='51' y1='300' x2='450' y2='300' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='1' y1='401' x2='450' y2='401' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <text x='200' y='57' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU1level</text> <text x='400' y='57' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU1count</text> <text x='200' y='157' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU2level</text> <text x='400' y='157' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU2count</text> <text x='200' y='257' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU3level</text> <text x='400' y='257' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU3count</text> <text x='200' y='357' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU4level</text> <text x='400' y='357' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU4count</text> </svg>";
				break;
			case 3:
				svgInner = "<?xml version='1.0' encoding='UTF-8' ?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' width='452' height='402'> <polygon x='1' points='1,401 401,401 200,2' style='stroke:#D0D3C0;stroke-width:2;fill:#fff;opacity:0.5;'></polygon> <line x1='134' y1='133' x2='450' y2='133' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='68' y1='266' x2='450' y2='266' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <line x1='1' y1='401' x2='450' y2='401' style='stroke:#D0D3C0;stroke-width:2;opacity:0.5;' /> <text x='200' y='71' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU1level</text> <text x='400' y='71' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU1count</text> <text x='200' y='207' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU2level</text> <text x='400' y='207' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU2count</text> <text x='200' y='327' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: middle'>OU3level</text> <text x='400' y='327' fill='#000' style='font-family:Roboto,Arial;font-size:14px;text-anchor: start'>OU3count</text> </svg>";
				break;
			default:
				break;
		}

		for( var i=0; i < ouLevels.length; i++ ){
			svgInner = svgInner.replace('OU' + ouLevels[i].level + 'level',ouLevels[i].name);
			svgInner = svgInner.replace('OU' + ouLevels[i].level + 'count',ouLevels[i].level);
		}

		return svgInner;

	}

</script>


<!-- WELCOME TEMPLATE -->

<div id="welcomeContentLayout" style="display:none">

<center>
<table height='100%' border=0 cellpadding=0 cellspacing=0 style='min-width:800px;max-width:1200px;background-Color:#fff;'>
<tr>
 <td style='overflow:hidden;padding:0;'>

	<div style="width:100%;border-radius:4px;color:#000;font-weight:400;padding:14px 8px 8px 12px;margin:4px;font-size:22px;letter-spacing:1px;" class=''>
		<label class="text">Welcome</label>
	</div>

	<div style='padding:15px;font-weight:400;font-size:13px;vertical-align:middle;color:#000000;width:inherit;' class='rounded'>
		This application is designed to allow users to access and view health system data collected by all reporting orgunits within your registered area.
		It is hoped that this online application will provide you with the tools you may require to scrutinize, analyze and support your health-management related decisions.
	</div>

	<div style="display:-webkit-flex;display:flex;flex-wrap:wrap;-webkit-flex-direction:row;flex-direction:row;padding:10px;border:2px solid #fff;background-Color:#fff; border-radius:4px;width:100%;height:100%;">

		<div class="panel" onclick="javascript:launchDHIS2App(this)" data-ext="dhis-web-dashboard-integration/index.html" data-instance="*">
			<!-- <i class="material-icons material-button">pregnant_woman</i> -->
			<img src='img/dhis-web-dashboard-integration.png' style=''><div>Dashboard</div>
		</div>

		<div class="panel" onclick="javascript:launchDHIS2App(this)" data-ext="dhis-web-pivot" data-instance="*">
			<!-- <i class="material-icons material-button">sentiment_neutral</i> -->
			<img src='img/dhis-web-pivot.png' style=''><div>Pivot Tables</div>
		</div>

		<div class="panel" onclick="javascript:launchDHIS2App(this)" data-ext="dhis-web-visualizer/index.html" data-instance="*">
			<!-- <i class="material-icons material-button">sentiment_satisfied</i> -->
			<img src='img/dhis-web-visualizer.png' style=''><div>Visualiser</div>
		</div>

		<div class="panel" onclick="javascript:launchDHIS2App(this)" data-ext="dhis-web-mapping" data-instance="*">
			<!-- <i class="material-icons material-button">sentiment_very_dissatisfied</i> -->
			<img src='img/dhis-web-mapping.png' style=''><div>Mapping</div>
		</div>

		<div class="panel" onclick="javascript:launchDHIS2App(this)" data-ext="api/apps/Focus-for-Impact/index.html" data-instance="15">
			<!-- <i class="material-icons material-button">sentiment_very_dissatisfied</i> -->
			<img src='img/GIS.png' style='width:48px;height:48px;'><div>Focus for Impact</div>
		</div>

		<div class="panel">
			<i class="material-icons material-button">timeline</i>
		</div>

		<div class="panel">
			<i class="material-icons material-button">verified_user</i>
		</div>

		<div class="panel">
			<i class="material-icons material-button">equalizer</i>
		</div>

		<div class="panel">
			<i class="material-icons material-button">school</i>
		</div>

		<div class="panel" onmousedown="$(this).addClass('div.panel-down');" onmouseup="$(this).removeClass('div.panel-down');">
			<i class="material-icons material-button">layers</i>
		</div>

		<div class="panel">
			<i class="material-icons material-button">local_hospital</i>
		</div>

		<div class="panel">
			<i class="material-icons material-button">local_hotel</i>
		</div>

		<div class="panel">
			<i class="material-icons material-button">child_care</i>
		</div>

	</div>

 </td>
</tr>
</table>
</center>

</div>
<!--  ## END ## -->


<!-- EXPLORE TEMPLATE -->

<div id="metaExplore" style="display:none;">

	<center>

	<div id="metaExploreHeader" style="min-width:800px;max-width:1200px;min-height:100px;background-Color:#fff;z-Index:10000;padding:0;margin:0;" class="stickyHeader">

		<table border=0 cellpadding=0 cellspacing=3 style='border-bottom:1px solid #edf2f6;background-Color:#fff;width:100%;min-width:800px;border-spacing:4px;border-collapse:separate;padding:2px;'>
<!--			<tr>
				<td colspan=3 style="background-Color:#fff;padding:7px 3px 6px 4px;">
					<a id="filter-object-indicators" onclick="javascript:g_Meta_dxObject='indicators';g_Meta_dxObjGrp='indicatorGroups';intialiseMetaExplorerLayout();cycleObjClass(this);" class="object-filter-selected"><img src="img/ind.png">&nbsp;<span id='IndCount'></span> indicators</a>
					<a id="filter-object-dataElements" onclick="javascript:g_Meta_dxObject='dataElements';g_Meta_dxObjGrp='dataElementGroups';intialiseMetaExplorerLayout();cycleObjClass(this);" class="object-filter"><img src="img/de.png">&nbsp;<span id='DeCount'></span> elements</a>
-->
					<!-- <a id="filter-object-organisationUnits" onclick="javascript:g_Meta_dxObject='organisationUnitGroups';intialiseMetaExplorerLayout();cycleObjClass(this);" class="object-filter"><img src="img/ou.png">&nbsp;<span id='OuCount'></span> orgunit groups</a> -->
<!--				</td>
			</tr>	-->
			<tr>
				<td colspan=3 style="background-Color:#fff;padding:4px;">
				
					<table style="width:100%">
						<tr>
							<td style="width:25%;vertical-align:middle;">
								<div class="content-title" id="ExplorerTitle">
									Programme Explorer <!-- <img src='img/icons_light.svg' class='explorerlogo'> -->
								</div>
							</td>
							<td style="width:150px;vertical-align:middle;">

								<table>
									<tr>
										<td style="font-size:12px;color:#1f7995;line-height:18px;vertical-align:middle;padding:2px;">
											sort:
										</td>
										<td>
											<span class="yt-uix-menu yt-uix-menu-flipped">
												<button class="" type="button" style="display:inline-block;padding:4px;border:1px solid #ccc;outline:0;background-Color:#f5f5f5;font-weight:500;font-size:12px;opacity:0.85;text-decoration:none;white-space:nowrap;word-wrap:normal;line-height:normal;vertical-align:middle;cursor:pointer;border-radius:2px;width:80px;" onclick=";return false;">
													<div class="" onclick="javascript: this.innerText = ((this.innerText == 'Ascending') ? 'Descending' : 'Ascending'); g_Meta_SORT_ARRAY_DESC = ((g_Meta_SORT_ARRAY_DESC == false) ? true : false); shuffleMetaDataExplorerLayout();">Ascending</div></button>
												</div>
											</span>
										</td>
									</tr>
								</table>

							</td>
							<td style="width:150px;vertical-align:middle;">

								<table>
									<tr>
										<td style="font-size:12px;color:#1f7995;line-height:18px;vertical-align:middle;padding:2px;">
											layout:
										</td>
										<td>
											<span class="yt-uix-menu yt-uix-menu-flipped">
												<button class="" id="explorerGroupColumnCount" type="button" style="display:inline-block;padding:4px;border:1px solid #ccc;outline:0;background-Color:#f5f5f5;font-weight:500;font-size:12px;opacity:0.85;text-decoration:none;white-space:nowrap;word-wrap:normal;line-height:normal;vertical-align:middle;cursor: pointer;border-radius: 2px;width:80px;" onclick="javascript: this.innerText = ((g_Meta_GROUP_COLUMNS == 1) ? 2 : 1) + ' Cols'; g_Meta_GROUP_COLUMNS = ((g_Meta_GROUP_COLUMNS == 1) ? 2 : 1); shuffleMetaDataExplorerLayout();"></button>
											</span>
										</td>
									</tr>
								</table>

							</td>
							<td style="width:150px;vertical-align:middle;">

								<table>
									<tr>
										<td style="font-size:12px;color:#1f7995;line-height:18px;vertical-align:middle;padding:2px;">
											all:
										</td>
										<td>
											<span class="yt-uix-menu yt-uix-menu-flipped">
												<button class="" type="button" id="explorerExpandCollapse" style="display:inline-block;padding:4px;border:1px solid #ccc;outline:0;background-Color:#f5f5f5;font-weight:500;font-size:12px;opacity:0.85;text-decoration:none;white-space:nowrap;word-wrap:normal;line-height:normal;vertical-align:middle;text-align:center;cursor: pointer;border-radius: 2px;width:30px;" onclick="shuffleMetaDataExplorerExpandCollapse()">
													<i class="material-icons material-medium close" id="explorerExpandCollapseInner" style="position:relative;top:-3px;height:14px;width:22px;">keyboard_arrow_up</i>
												</button>
												</div>
											</span>
										</td>
									</tr>
								</table>

							</td>
							<td style="width:20px;">&nbsp;</td>

							<td style="">
								<input type="text" id="searchMetaExplore" name="searchMetaExplore" class="metaSearch" placeholder="Search.." onkeyup="generateMetaDataLayout('meta-data-browse');" onfocus="this.style.width = '100%'" onfocusout="this.style.width = '130px'">
							</td>
							<td style="width:20px;">&nbsp;</td>
						</tr>
					</table>

				</td>
			</tr>
			<tr>
				<td colspan=3 style="background-Color:#fff;padding: 4px 4px 8px 4px;">
					<!-- <a id="metaFilter-group-dataSets" onclick="javascript:g_Meta_dxGroup='dataSets';intialiseMetaExplorerLayout();cycleMetaExploreGrpClass(this);" class="group-filter">Data Sets</a> -->
					<!-- <a id="metaFilter-group-localGroups" onclick="javascript:g_Meta_dxGroup='localGroups';intialiseMetaExplorerLayout();cycleMetaExploreGrpClass(this);" class="group-filter-selected">Local Groups</a> -->
					<a id="filter-object-indicators" onclick="javascript:g_Meta_dxObject='indicators';g_Meta_dxObjGrp='indicatorGroups';intialiseMetaExplorerLayout();cycleObjClass(this);" class="object-filter-selected"><img src="img/ind.png">&nbsp;<span id='IndCount'></span> indicators</a>
					<a id="filter-object-dataElements" onclick="javascript:g_Meta_dxObject='dataElements';g_Meta_dxObjGrp='dataElementGroups';intialiseMetaExplorerLayout();cycleObjClass(this);" class="object-filter"><img src="img/de.png">&nbsp;<span id='DeCount'></span> elements</a>

				</td>
			</tr>
		</table>

	</div>
	
	<div id="meta-data-browse" data-source="" style="min-width:800px;max-width:1200px;min-height:100px;background-Color:#fff;z-Index:10000;padding:0;margin:0;">
	
	</div>
	
	</center>

</div>

<!--  ## END ## -->


	
<!-- PLANNING TEMPLATE -->

<div id="planningContentLayout" style="display:none">

	<div style='padding:10px 15px 15px 15px;font-weight:400;font-size:13px;vertical-align:middle;color:#000000;width:inherit;' class='rounded'>
		Data collection and management structures of <span id='instanceName'></span>:
	</div>
	
	<div id='hierarchyStructure' onmouseover='$(this).animate({width:450,height:450},250)' onmouseout='$(this).animate({width:100,height:100},250)' 
			style='width:100px;height:100px;padding:20px 8px 8px 12px;background-position:center;background-repeat:no-repeat;background-size:100%;' class='rounded'>
	</div>

</div>

<!--  ## END ## -->


<!-- INSTRUMENTS TEMPLATE -->

<div id="instrLayout" style="display:none;">

	<div style="width:100%;min-height:100px;background-Color:inherit;z-Index:10000;" class="stickyHeader">

		<table border=0 cellpadding=2 cellspacing=3 style='border:2px solid #EBF0F9; background-Color:#fff;width:100%;min-width:800px;border-spacing:4px;border-collapse:separate;border-radius:4px;padding: 2px 2px 4px 2px'>
			<tr>
				<td colspan=3 style="background-Color:#fff;padding:4px;">
				
					<table style="width:100%">
						<tr>
							<td style="width:25%;vertical-align:middle;">
								<div class="content-title" id="instrTitle">
									Instruments
								</div>
							</td>
							<td style="width:20px;">&nbsp;</td>
						</tr>
					</table>

				</td>
			</tr>
			<tr>
				<td colspan=3  id='instrSubOpts' style="background-Color:#fff;padding: 14px 4px 8px 4px;border-top:1px solid #edf2f6;">
					<a id="instrFilter-group-All" onclick="javascript:g_instr_dxGroup='All';cycleInstrGrpClass(this);" class="group-filter-selected">All</a>
					<a id="instrFilter-group-favourites" onclick="javascript:g_instr_dxGroup='Favourites';cycleInstrGrpClass(this);" class="group-filter">Favourites</a>
				</td>
			</tr>
		</table>

	</div>

</div>

<!--  ## END ## -->



</body>
</html>